// Vencord bad3277
// Standalone: true
// Platform: Universal
// Updater Disabled: false
"use strict";var ei=Object.create;var je=Object.defineProperty;var ti=Object.getOwnPropertyDescriptor;var ri=Object.getOwnPropertyNames;var ni=Object.getPrototypeOf,ii=Object.prototype.hasOwnProperty;var q=(e,t)=>()=>(e&&(t=e(e=0)),t);var ue=(e,t)=>{for(var r in t)je(e,r,{get:t[r],enumerable:!0})},xr=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ri(t))!ii.call(e,i)&&i!==r&&je(e,i,{get:()=>t[i],enumerable:!(n=ti(t,i))||n.enumerable});return e};var me=(e,t,r)=>(r=e!=null?ei(ni(e)):{},xr(t||!e||!e.__esModule?je(r,"default",{value:e,enumerable:!0}):r,e)),wt=e=>xr(je({},"__esModule",{value:!0}),e);var f=q(()=>{"use strict"});var Ce=q(()=>{"use strict";f()});var bt,Sr,Be,Ur=q(()=>{"use strict";f();bt=Symbol("SettingsStore.isProxy"),Sr=Symbol("SettingsStore.getRawTarget"),Be=class{pathListeners=new Map;prefixListeners=new Map;globalListeners=new Set;proxyContexts=new WeakMap;proxyHandler=(()=>{let t=this;return{get(r,n,i){if(n===bt)return!0;if(n===Sr)return r;let o=Reflect.get(r,n,i),a=t.proxyContexts.get(r);if(a==null)return o;let{root:s,path:l}=a;if(!(n in r)&&t.getDefaultValue!=null&&(o=t.getDefaultValue({target:r,key:n,root:s,path:l})),typeof o=="object"&&o!==null&&!o[bt]){let c=`${l}${l&&"."}${n}`;return t.makeProxy(o,s,c)}return o},set(r,n,i){if(i?.[bt]&&(i=i[Sr]),r[n]===i)return!0;if(!Reflect.set(r,n,i))return!1;let o=t.proxyContexts.get(r);if(o==null)return!0;let{root:a,path:s}=o,l=`${s}${s&&"."}${n}`;return t.notifyListeners(l,i,a),!0},deleteProperty(r,n){if(!Reflect.deleteProperty(r,n))return!1;let i=t.proxyContexts.get(r);if(i==null)return!0;let{root:o,path:a}=i,s=`${a}${a&&"."}${n}`;return t.notifyListeners(s,void 0,o),!0}}})();constructor(t,r={}){this.plain=t,this.store=this.makeProxy(t),Object.assign(this,r)}makeProxy(t,r=t,n=""){return this.proxyContexts.set(t,{root:r,path:n}),new Proxy(t,this.proxyHandler)}notifyPrefixListeners(t,r,n){for(let i=1;i<=r.length;i++){let o=r.slice(0,i).join(".");this.prefixListeners.get(o)?.forEach(a=>a(n,t))}}notifyListeners(t,r,n){let i=t.split(".");if(i.length>3&&i[0]==="plugins"){let o=i.slice(0,3),a=o.join("."),s=o.reduce((l,c)=>l[c],n);this.globalListeners.forEach(l=>l(n,a)),this.pathListeners.get(a)?.forEach(l=>l(s))}else this.globalListeners.forEach(o=>o(n,t));this.pathListeners.get(t)?.forEach(o=>o(r)),this.notifyPrefixListeners(t,i,r)}setData(t,r){if(this.readOnly)throw new Error("SettingsStore is read-only");if(this.plain=t,this.store=this.makeProxy(t),r){let n=t,i=r.split(".");for(let o of i){if(!n){console.warn(`Settings#setData: Path ${r} does not exist in new data. Not dispatching update`);return}n=n[o]}this.pathListeners.get(r)?.forEach(o=>o(n)),this.notifyPrefixListeners(r,i,n)}this.markAsChanged()}addGlobalChangeListener(t){this.globalListeners.add(t)}addChangeListener(t,r){let n=this.pathListeners.get(t)??new Set;n.add(r),this.pathListeners.set(t,n)}addPrefixChangeListener(t,r){let n=this.prefixListeners.get(t)??new Set;n.add(r),this.prefixListeners.set(t,n)}removeGlobalChangeListener(t){this.globalListeners.delete(t)}removeChangeListener(t,r){let n=this.pathListeners.get(t);n&&(n.delete(r),n.size||this.pathListeners.delete(t))}removePrefixChangeListener(t,r){let n=this.prefixListeners.get(t);n&&(n.delete(r),n.size||this.prefixListeners.delete(t))}markAsChanged(){this.globalListeners.forEach(t=>t(this.plain,""))}}});function Tt(e,t){for(let r in t){let n=t[r];typeof n=="object"&&!Array.isArray(n)?(e[r]??={},Tt(e[r],n)):e[r]??=n}return e}var Rr=q(()=>{"use strict";f()});var Fr,ve,Je,Ee,ye,De,Et,xt,Cr,Ye,Pe=q(()=>{"use strict";f();Fr=require("electron"),ve=require("path"),Je=process.env.VENCORD_USER_DATA_DIR??(process.env.DISCORD_USER_DATA_DIR?(0,ve.join)(process.env.DISCORD_USER_DATA_DIR,"..","VencordData"):(0,ve.join)(Fr.app.getPath("userData"),"..","Vencord")),Ee=(0,ve.join)(Je,"settings"),ye=(0,ve.join)(Je,"themes"),De=(0,ve.join)(Ee,"quickCss.css"),Et=(0,ve.join)(Ee,"settings.json"),xt=(0,ve.join)(Ee,"native-settings.json"),Cr=["https:","http:","steam:","spotify:","com.epicgames.launcher:","tidal:","itunes:"],Ye=process.argv.includes("--vanilla")});function Dr(e,t){try{return JSON.parse((0,xe.readFileSync)(t,"utf-8"))}catch(r){return r?.code!=="ENOENT"&&console.error(`Failed to read ${e} settings`,r),{}}}var St,xe,j,oi,Pr,se,fe=q(()=>{"use strict";f();Ce();Ur();Rr();St=require("electron"),xe=require("fs");Pe();(0,xe.mkdirSync)(Ee,{recursive:!0});j=new Be(Dr("renderer",Et));j.addGlobalChangeListener(()=>{try{(0,xe.writeFileSync)(Et,JSON.stringify(j.plain,null,4))}catch(e){console.error("Failed to write renderer settings",e)}});St.ipcMain.on("VencordGetSettings",e=>e.returnValue=j.plain);St.ipcMain.handle("VencordSetSettings",(e,t,r)=>{j.setData(t,r)});oi={plugins:{},customCspRules:{}},Pr=Dr("native",xt);Tt(Pr,oi);se=new Be(Pr);se.addGlobalChangeListener(()=>{try{(0,xe.writeFileSync)(xt,JSON.stringify(se.plain,null,4))}catch(e){console.error("Failed to write native settings",e)}})});async function Ir(e,t){try{var r=await fetch(e,t)}catch(i){throw i instanceof Error&&i.cause&&(i=i.cause),new Error(`${t?.method??"GET"} ${e} failed: ${i}`)}if(r.ok)return r;let n=`${t?.method??"GET"} ${e}: ${r.status} ${r.statusText}`;try{let i=await r.text();n+=`
${i}`}catch{}throw new Error(n)}async function $r(e,t){return(await Ir(e,t)).json()}async function Xe(e,t){let n=await(await Ir(e,t)).arrayBuffer();return Buffer.from(n)}var ci,Ct=q(()=>{"use strict";f();ci=require("original-fs")});var Ne,Dt=q(()=>{f();Ne="bad3277"});var ke,Pt=q(()=>{f();ke="supahfox/Vencord"});var Qe,Lt=q(()=>{"use strict";f();Dt();Pt();Qe=`Vencord/${Ne}${ke?` (https://github.com/${ke})`:""}`});function ze(e){return async function(){try{return{ok:!0,value:await e(...arguments)}}catch(t){return{ok:!1,error:t instanceof Error?{...t,message:t.message,name:t.name,stack:t.stack}:t}}}}var _r,Or=q(()=>{"use strict";f();_r=["patcher.js","preload.js","renderer.js","renderer.css"]});var pi={};async function Nr(e){return $r(ui+e,{headers:{Accept:"application/vnd.github+json","User-Agent":Qe}})}async function fi(){return await zr()?(await Nr(`/compare/${Ne}...HEAD`)).commits.map(r=>({hash:r.sha.slice(0,7),author:r.author.login,message:r.commit.message.split(`
`)[0]})):[]}async function zr(){let e=await Nr("/releases/latest");return e.name.slice(e.name.lastIndexOf(" ")+1)===Ne?!1:(e.assets.forEach(({name:r,browser_download_url:n})=>{_r.some(i=>r.startsWith(i))&&kt.push([r,n])}),!0)}async function di(){let e=await Promise.all(kt.map(async([t,r])=>{let n=await Xe(r);return[(0,Br.join)(__dirname,t),n]}));return await Promise.all(e.map(async([t,r])=>(0,Mr.writeFile)(t,r))),kt=[],!0}var Ve,Mr,Br,ui,kt,Vr=q(()=>{"use strict";f();Ct();Ce();Lt();Ve=require("electron"),Mr=require("fs/promises"),Br=require("path");Dt();Pt();Or();ui=`https://api.github.com/repos/${ke}`,kt=[];Ve.ipcMain.handle("VencordGetRepo",ze(()=>`https://github.com/${ke}`));Ve.ipcMain.handle("VencordGetUpdates",ze(fi));Ve.ipcMain.handle("VencordUpdate",ze(zr));Ve.ipcMain.handle("VencordBuild",ze(di))});function qn(e,t,r){let n=t;if(t in e)return void r(e[n]);Object.defineProperty(e,t,{set(i){delete e[n],e[n]=i,r(i)},configurable:!0,enumerable:!1})}var jn=q(()=>{"use strict";f()});var go={};function po(e,t){let r=e.slice(4).split(".").map(Number),n=t.slice(4).split(".").map(Number);for(let i=0;i<n.length;i++){if(r[i]>n[i])return!0;if(r[i]<n[i])return!1}return!1}function ho(){if(!process.env.DISABLE_UPDATER_AUTO_PATCHING)try{let e=(0,te.dirname)(process.execPath),t=(0,te.basename)(e),r=(0,te.join)(e,".."),n=(0,X.readdirSync)(r).reduce((s,l)=>l.startsWith("app-")&&po(l,s)?l:s,t);if(n===t)return;let i=(0,te.join)(r,n,"resources"),o=(0,te.join)(i,"app.asar"),a=(0,te.join)(i,"_app.asar");if(!(0,X.existsSync)(o)||(0,X.statSync)(o).isDirectory())return;console.info("[Vencord] Detected Host Update. Repatching..."),(0,X.renameSync)(o,a),(0,X.mkdirSync)(o),(0,X.writeFileSync)((0,te.join)(o,"package.json"),JSON.stringify({name:"discord",main:"index.js"})),(0,X.writeFileSync)((0,te.join)(o,"index.js"),`require(${JSON.stringify((0,te.join)(__dirname,"patcher.js"))});`)}catch(e){console.error("[Vencord] Failed to repatch latest host update",e)}}var Jn,X,te,Yn=q(()=>{"use strict";f();Jn=require("electron"),X=require("original-fs"),te=require("path");Jn.app.on("before-quit",ho)});var wo={};var Z,Te,mo,vo,hr,yo,Kn=q(()=>{"use strict";f();jn();Z=me(require("electron")),Te=require("path");fe();Pe();console.log("[Vencord] Starting up...");mo=require.main.filename,vo=require.main.path.endsWith("app.asar")?"_app.asar":"app.asar",hr=(0,Te.join)((0,Te.dirname)(mo),"..",vo),yo=require((0,Te.join)(hr,"package.json"));require.main.filename=(0,Te.join)(hr,yo.main);Z.app.setAppPath(hr);if(Ye)console.log("[Vencord] Running in vanilla mode. Not loading Vencord");else{let e=j.store;if(process.platform==="win32"&&(Yn(),e.winCtrlQ)){let i=Z.Menu.buildFromTemplate;Z.Menu.buildFromTemplate=function(o){if(o[0]?.label==="&File"){let{submenu:a}=o[0];Array.isArray(a)&&a.push({label:"Quit (Hidden)",visible:!1,acceleratorWorksWhenHidden:!0,accelerator:"Control+Q",click:()=>Z.app.quit()})}return i.call(this,o)}}class t extends Z.default.BrowserWindow{constructor(o){if(o?.webPreferences?.preload&&o.title){let a=o.webPreferences.preload;o.webPreferences.preload=(0,Te.join)(__dirname,"preload.js"),o.webPreferences.sandbox=!1,o.webPreferences.backgroundThrottling=!1,e.frameless?o.frame=!1:process.platform==="win32"&&e.winNativeTitleBar&&delete o.frame,e.transparent&&(o.transparent=!0,o.backgroundColor="#00000000"),e.disableMinSize&&(o.minWidth=0,o.minHeight=0),process.platform==="darwin"&&e.macosVibrancyStyle&&(o.backgroundColor="#00000000",e.macosVibrancyStyle&&(o.vibrancy=e.macosVibrancyStyle)),process.env.DISCORD_PRELOAD=a,super(o),e.disableMinSize&&(this.setMinimumSize=(l,c)=>{})}else super(o)}}Object.assign(t,Z.default.BrowserWindow),Object.defineProperty(t,"name",{value:"BrowserWindow",configurable:!0});let r=require.resolve("electron");delete require.cache[r].exports,require.cache[r].exports={...Z.default,BrowserWindow:t},qn(global,"appSettings",i=>{i.set("DANGEROUS_ENABLE_DEVTOOLS_ONLY_ENABLE_IF_YOU_KNOW_WHAT_YOURE_DOING",!0)}),process.env.DATA_DIR=(0,Te.join)(Z.app.getPath("userData"),"..","Vencord");let n=Z.app.commandLine.appendSwitch;Z.app.commandLine.appendSwitch=function(...i){if(i[0]==="disable-features"){let o=new Set((i[1]??"").split(","));o.add("WidgetLayering"),o.add("UseEcoQoSForBackgroundProcess"),i[1]+=[...o].join(",")}return n.apply(this,i)},Z.app.commandLine.appendSwitch("disable-renderer-backgrounding"),Z.app.commandLine.appendSwitch("disable-background-timer-throttling"),Z.app.commandLine.appendSwitch("disable-backgrounding-occluded-windows")}console.log("[Vencord] Loading original Discord app.asar");require(require.main.filename)});f();var Re=require("electron"),Xn=require("path"),gr=require("url");f();fe();var Ut=require("electron"),Le=["connect-src"],Q=[...Le,"img-src"],kr=["style-src","font-src"],W=[...Q,...kr],Lr=[...W,"script-src","worker-src"],Ft={"http://localhost:*":W,"http://127.0.0.1:*":W,"localhost:*":W,"127.0.0.1:*":W,"*.github.io":W,"github.com":W,"raw.githubusercontent.com":W,"*.gitlab.io":W,"gitlab.com":W,"*.codeberg.page":W,"codeberg.org":W,"*.githack.com":W,"jsdelivr.net":W,"fonts.googleapis.com":kr,"i.imgur.com":Q,"i.ibb.co":Q,"i.pinimg.com":Q,"*.tenor.com":Q,"files.catbox.moe":W,"cdn.discordapp.com":W,"media.discordapp.net":Q,"cdnjs.cloudflare.com":Lr,"cdn.jsdelivr.net":Lr,"api.github.com":Le,"ws.audioscrobbler.com":Le,"translate-pa.googleapis.com":Le,"*.vencord.dev":Q,"manti.vendicated.dev":Q,"decor.fieryflames.dev":Le,"ugc.decor.fieryflames.dev":Q,"sponsor.ajay.app":Le,"dearrow-thumb.ajay.app":Q,"usrbg.is-hardly.online":Q,"icons.duckduckgo.com":Q},Rt=(e,t)=>Object.keys(e).find(r=>r.toLowerCase()===t),si=e=>{let t={};return e.split(";").forEach(r=>{let[n,...i]=r.trim().split(/\s+/g);n&&!Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=i)}),t},ai=e=>Object.entries(e).filter(([,t])=>t?.length).map(t=>t.flat().join(" ")).join("; "),li=e=>{let t=Rt(e,"content-security-policy-report-only");t&&delete e[t];let r=Rt(e,"content-security-policy");if(r){let n=si(e[r][0]),i=(o,...a)=>{n[o]??=[...n["default-src"]??[]],n[o].push(...a)};i("style-src","'unsafe-inline'"),i("script-src","'unsafe-inline'","'unsafe-eval'");for(let o of["style-src","connect-src","img-src","font-src","media-src","worker-src"])i(o,"blob:","data:","vencord:","vesktop:");for(let[o,a]of Object.entries(se.store.customCspRules))for(let s of a)i(s,o);for(let[o,a]of Object.entries(Ft))for(let s of a)i(s,o);e[r]=[ai(n)]}};function Ar(){Ut.session.defaultSession.webRequest.onHeadersReceived(({responseHeaders:e,resourceType:t},r)=>{if(e&&(t==="mainFrame"&&li(e),t==="stylesheet")){let n=Rt(e,"content-type");n&&(e[n]=["text/css"])}r({cancel:!1,responseHeaders:e})}),Ut.session.defaultSession.webRequest.onHeadersReceived=()=>{}}f();f();Vr();f();Ce();var ir=require("electron");f();var It={};ue(It,{fetchTrackData:()=>gi});f();Lt();var Gr=require("child_process"),Wr=require("util"),Hr=(0,Wr.promisify)(Gr.execFile);async function At(e){let{stdout:t}=await Hr("osascript",e.map(r=>["-e",r]).flat());return t}var ne=null;async function hi({id:e,name:t,artist:r,album:n}){if(e===ne?.id){if("data"in ne)return ne.data;if("failures"in ne&&ne.failures>=5)return null}try{let i=new URL("https://itunes.apple.com/search");i.searchParams.set("term",`${t} ${r} ${n}`),i.searchParams.set("media","music"),i.searchParams.set("entity","song");let o=await fetch(i,{headers:{"user-agent":Qe}}).then(s=>s.json()).then(s=>s.results.find(l=>l.collectionName===n)||s.results[0]),a=await fetch(o.artistViewUrl).then(s=>s.text()).then(s=>{let l=s.match(/<meta property="og:image" content="(.+?)">/);return l?l[1].replace(/[0-9]+x.+/,"220x220bb-60.png"):void 0}).catch(()=>{});return ne={id:e,data:{appleMusicLink:o.trackViewUrl,songLink:`https://song.link/i/${new URL(o.trackViewUrl).searchParams.get("i")}`,albumArtwork:o.artworkUrl100.replace("100x100","512x512"),artistArtwork:a}},ne.data}catch(i){return console.error("[AppleMusicRichPresence] Failed to fetch remote data:",i),ne={id:e,failures:(e===ne?.id&&"failures"in ne?ne.failures:0)+1},null}}async function gi(){try{await Hr("pgrep",["^Music$"])}catch{return null}if(await At(['tell application "Music"',"get player state","end tell"]).then(u=>u.trim())!=="playing")return null;let t=await At(['tell application "Music"',"get player position","end tell"]).then(u=>Number.parseFloat(u.trim())),r=await At(['set output to ""','tell application "Music"',"set t_id to database id of current track","set t_name to name of current track","set t_album to album of current track","set t_artist to artist of current track","set t_duration to duration of current track",'set output to "" & t_id & "\\n" & t_name & "\\n" & t_album & "\\n" & t_artist & "\\n" & t_duration',"end tell","return output"]),[n,i,o,a,s]=r.split(`
`).filter(u=>!!u),l=Number.parseFloat(s),c=await hi({id:n,name:i,artist:a,album:o});return{name:i,album:o,artist:a,playerPosition:t,duration:l,...c}}var $t={};ue($t,{initDevtoolsOpenEagerLoad:()=>mi});f();function mi(e){let t=()=>e.sender.executeJavaScript("Vencord.Plugins.plugins.ConsoleShortcuts.eagerLoad(true)");e.sender.isDevToolsOpened()?t():e.sender.once("devtools-opened",()=>t())}var qr={};f();fe();var tt=require("electron"),et=[];function Zr(){let e=[];for(let t=et.length-1;t>=0;t--){let{processId:r,routingId:n}=et[t],i=tt.webFrameMain.fromId(r,n);if(!i){et.splice(t,1);continue}e.push(i)}return e}tt.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(r,{frame:n})=>{n?.once("dom-ready",()=>{if(n.url.startsWith("https://open.spotify.com/embed/")){Zr();let{routingId:i,processId:o}=n;et.push({routingId:i,processId:o});let a=j.store.plugins?.FixSpotifyEmbeds;if(!a?.enabled)return;n.executeJavaScript(`
                    globalThis._vcVolume = ${a.volume/100};
                    const original = Audio.prototype.play;
                    Audio.prototype.play = function() {
                        this.volume = _vcVolume;
                        return original.apply(this, arguments);
                    }
                `)}})}),j.addChangeListener("plugins.FixSpotifyEmbeds.volume",r=>{try{Zr().forEach(n=>n.executeJavaScript(`globalThis._vcVolume = ${r/100}`))}catch(n){console.error("FixSpotifyEmbeds: Failed to update volume",n)}})});var Jr={};f();fe();var jr=require("electron");jr.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(r,{frame:n})=>{n?.once("dom-ready",()=>{if(n.url.startsWith("https://www.youtube.com/")){if(!j.store.plugins?.FixYoutubeEmbeds?.enabled)return;n.executeJavaScript(`
                new MutationObserver(() => {
                    if(
                        document.querySelector('div.ytp-error-content-wrap-subreason a[href*="www.youtube.com/watch?v="]')
                    ) location.reload()
                }).observe(document.body, { childList: true, subtree:true });
                `)}})})});var _t={};ue(_t,{resolveRedirect:()=>yi});f();var Yr=require("https"),vi=/^https:\/\/(spotify\.link|s\.team)\/.+$/;function Kr(e){return new Promise((t,r)=>{let n=(0,Yr.request)(new URL(e),{method:"HEAD"},i=>{t(i.headers.location?Kr(i.headers.location):e)});n.on("error",r),n.end()})}async function yi(e,t){return vi.test(t)?Kr(t):t}var Ot={};ue(Ot,{makeDeeplTranslateRequest:()=>wi});f();async function wi(e,t,r,n){let i=t?"https://api.deepl.com/v2/translate":"https://api-free.deepl.com/v2/translate";try{let o=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`DeepL-Auth-Key ${r}`},body:n}),a=await o.text();return{status:o.status,data:a}}catch(o){return{status:-1,data:String(o)}}}var Mt={};ue(Mt,{readRecording:()=>bi});f();var Xr=require("electron"),rt=require("fs/promises"),Ge=require("path");async function bi(e,t){t=(0,Ge.normalize)(t);let r=(0,Ge.basename)(t),n=(0,Ge.normalize)(Xr.app.getPath("userData")+"/");if(!/^\d*recording\.ogg$/.test(r)||!t.startsWith(n))return null;try{let i=await(0,rt.readFile)(t);return(0,rt.rm)(t).catch(()=>{}),new Uint8Array(i.buffer)}catch{return null}}var Bt={};ue(Bt,{sendToOverlay:()=>Ti});f();var en=require("dgram"),Qr;function Ti(e,t){t.messageType=t.type;let r=JSON.stringify(t);Qr??=(0,en.createSocket)("udp4"),Qr.send(r,42069,"127.0.0.1")}var rn={};f();fe();var tn=require("electron");f();var Nt=`"use strict";const hiddenCSS=["#__ffYoutube1","#__ffYoutube2","#__ffYoutube3","#__ffYoutube4","#feed-pyv-container","#feedmodule-PRO","#homepage-chrome-side-promo","#merch-shelf","#offer-module",'#pla-shelf > ytd-pla-shelf-renderer[class="style-scope ytd-watch"]',"#pla-shelf","#premium-yva","#promo-info","#promo-list","#promotion-shelf","#related > ytd-watch-next-secondary-results-renderer > #items > ytd-compact-promoted-video-renderer.ytd-watch-next-secondary-results-renderer","#search-pva","#shelf-pyv-container","#video-masthead","#watch-branded-actions","#watch-buy-urls","#watch-channel-brand-div","#watch7-branded-banner","#YtKevlarVisibilityIdentifier","#YtSparklesVisibilityIdentifier",".carousel-offer-url-container",".companion-ad-container",".GoogleActiveViewElement",'.list-view[style="margin: 7px 0pt;"]',".promoted-sparkles-text-search-root-container",".promoted-videos",".searchView.list-view",".sparkles-light-cta",".watch-extra-info-column",".watch-extra-info-right",".ytd-carousel-ad-renderer",".ytd-compact-promoted-video-renderer",".ytd-companion-slot-renderer",".ytd-merch-shelf-renderer",".ytd-player-legacy-desktop-watch-ads-renderer",".ytd-promoted-sparkles-text-search-renderer",".ytd-promoted-video-renderer",".ytd-search-pyv-renderer",".ytd-video-masthead-ad-v3-renderer",".ytp-ad-action-interstitial-background-container",".ytp-ad-action-interstitial-slot",".ytp-ad-image-overlay",".ytp-ad-overlay-container",".ytp-ad-progress",".ytp-ad-progress-list",'[class*="ytd-display-ad-"]','[layout*="display-ad-"]','a[href^="http://www.youtube.com/cthru?"]','a[href^="https://www.youtube.com/cthru?"]',"ytd-action-companion-ad-renderer","ytd-banner-promo-renderer","ytd-compact-promoted-video-renderer","ytd-companion-slot-renderer","ytd-display-ad-renderer","ytd-promoted-sparkles-text-search-renderer","ytd-promoted-sparkles-web-renderer","ytd-search-pyv-renderer","ytd-single-option-survey-renderer","ytd-video-masthead-ad-advertiser-info-renderer","ytd-video-masthead-ad-v3-renderer","YTM-PROMOTED-VIDEO-RENDERER"],hideElements=()=>{const e=hiddenCSS;if(!e)return;const t=e.join(", ")+" { display: none!important; }",r=document.createElement("style");r.textContent=t,document.head.appendChild(r)},observeDomChanges=e=>{new MutationObserver(r=>{e(r)}).observe(document.documentElement,{childList:!0,subtree:!0})},hideDynamicAds=()=>{const e=document.querySelectorAll("#contents > ytd-rich-item-renderer ytd-display-ad-renderer");e.length!==0&&e.forEach(t=>{if(t.parentNode&&t.parentNode.parentNode){const r=t.parentNode.parentNode;r.localName==="ytd-rich-item-renderer"&&(r.style.display="none")}})},autoSkipAds=()=>{if(document.querySelector(".ad-showing")){const e=document.querySelector("video");e&&e.duration&&(e.currentTime=e.duration,setTimeout(()=>{const t=document.querySelector("button.ytp-ad-skip-button");t&&t.click()},100))}},overrideObject=(e,t,r)=>{if(!e)return!1;let n=!1;for(const o in e)e.hasOwnProperty(o)&&o===t?(e[o]=r,n=!0):e.hasOwnProperty(o)&&typeof e[o]=="object"&&overrideObject(e[o],t,r)&&(n=!0);return n},jsonOverride=(e,t)=>{const r=JSON.parse;JSON.parse=(...n)=>{const o=r.apply(this,n);return overrideObject(o,e,t),o},Response.prototype.json=new Proxy(Response.prototype.json,{async apply(...n){const o=await Reflect.apply(...n);return overrideObject(o,e,t),o}})};jsonOverride("adPlacements",[]),jsonOverride("playerAds",[]),hideElements(),hideDynamicAds(),autoSkipAds(),observeDomChanges(()=>{hideDynamicAds(),autoSkipAds()});
`;tn.app.on("browser-window-created",(e,t)=>{t.webContents.on("frame-created",(r,{frame:n})=>{n?.once("dom-ready",()=>{j.store.plugins?.YoutubeAdblock?.enabled&&(n.url.includes("youtube.com/embed/")?n.executeJavaScript(Nt):n.parent?.url.includes("youtube.com/embed/")&&n.parent.executeJavaScript(Nt))})})});var tr={};ue(tr,{cancelUpload:()=>$i,clearProgress:()=>He,getLatestProgress:()=>Ii,getPendingNotifications:()=>Ai,pickAndUploadFile:()=>Pi,uploadFileBuffer:()=>Di,uploadFileCustomNative:()=>er,uploadFileTo0x0StNative:()=>Qt,uploadFileToBuzzheavierNative:()=>Xt,uploadFileToCatboxNative:()=>qt,uploadFileToFileIoNative:()=>Ci,uploadFileToFilebinNative:()=>Kt,uploadFileToGofileNative:()=>Zt,uploadFileToLitterboxNative:()=>jt,uploadFileToTempShNative:()=>Jt,uploadFileToTmpFilesNative:()=>Yt,uploadFileToTransferShNative:()=>Fi});f();var Ae=me(require("crypto")),Ze=require("electron"),z=me(require("fs")),ct=me(require("http")),Se=me(require("https")),ln=me(require("os")),Gt=me(require("path")),nt={errors:0,info:1,debug:2},zt="errors",Wt=["Catbox","Litterbox","0x0.st"],nn="GoFile",de=1*1024*1024,on={none:10*1024*1024,basic:50*1024*1024,full:500*1024*1024};function Ht(e){return e.toLowerCase().endsWith(".exe")}function cn(e,t){return Ht(e)&&Wt.includes(t)?(g.info(`[BigFileUpload] ${t} doesn't support EXE files, using ${nn} instead`),nn):t}function un(e){let t=Number(e);return Number.isFinite(t)&&t>0?t:3e5}var st={embeddr:[".mp4",".mov",".mkv"],x266:[".mp4",".mov",".mkv",".webm",".avi",".flv"],nfp:[".mp4",".mov",".webm",".avi"]};function Ei(e,t){let r=e.toLowerCase();return(st[t||"x266"]||st.x266).some(i=>r.endsWith(i))}function ot(e,t){let r=t||"x266";if(!Ei(e,r)){let n=st[r]||st.x266;return g.debug(`[BigFileUpload] Skipping embed service - URL must end with ${n.join(", ")}: ${e}`),e}switch(r){case"x266":return"https://x266.mov/e/"+e;case"nfp":return"https://discord.nfp.is/?v="+encodeURIComponent(e);case"embeddr":default:return"https://embeddr.top/"+e}}function fn(e){if(e==="localhost"||e==="localhost.localdomain")return!0;let t=e.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/);if(t){let[,r,n,i]=t.map(Number);if(r===127||r===10||r===172&&n>=16&&n<=31||r===192&&n===168||r===169&&n===254||r===0||r===255)return!0}return!!(e==="::1"||e==="[::1]"||e.startsWith("fe80:")||e.startsWith("[fe80:")||e.startsWith("fc")||e.startsWith("[fc")||e.startsWith("fd")||e.startsWith("[fd"))}function dn(e){if(!e||typeof e!="string")return!1;try{let t=new URL(e);return t.protocol!=="http:"&&t.protocol!=="https:"?(g.warn(`[BigFileUpload] Invalid URL protocol: ${t.protocol}`),!1):!t.hostname||t.hostname.length<3?(g.warn(`[BigFileUpload] Invalid URL hostname: ${t.hostname}`),!1):fn(t.hostname)?(g.warn(`[BigFileUpload] Blocked private/reserved IP in URL: ${t.hostname}`),!1):/^\d+$/.test(t.hostname)?(g.warn(`[BigFileUpload] Blocked numeric-only hostname: ${t.hostname}`),!1):t.hostname.includes(".")?!0:(g.warn(`[BigFileUpload] Invalid hostname (no TLD): ${t.hostname}`),!1)}catch{return g.warn(`[BigFileUpload] Invalid URL format: ${e.substring(0,100)}`),!1}}var xi=new Set(["host","connection","upgrade","proxy-authorization","proxy-connection","te","trailer","transfer-encoding","keep-alive","expect","cookie","set-cookie","authorization","www-authenticate","x-forwarded-for","x-forwarded-host","x-forwarded-proto","x-real-ip","forwarded"]);function Vt(e){let t={};for(let[r,n]of Object.entries(e)){let i=r.toLowerCase().trim();if(xi.has(i)){g.warn(`[BigFileUpload] Blocked dangerous header: ${r}`);continue}!r||r.trim()===""||(typeof n=="string"&&!n.includes(`
`)&&!n.includes("\r")?t[r]=n:g.warn(`[BigFileUpload] Blocked header with invalid value: ${r}`))}return t}function at(e,t){if(!e||e.trim()==="")return t;try{return JSON.parse(e)}catch{return g.warn(`[BigFileUpload] Failed to parse JSON: ${e.substring(0,100)}`),t}}function sn(e,t){let r=e;for(let n of t){if(r==null)return;let i=n.match(/^([^[]+)\[(\d+)\]$/);if(i){let[,o,a]=i;if(o&&(r=r[o],r==null))return;r=r[parseInt(a,10)]}else/^\d+$/.test(n)&&Array.isArray(r)?r=r[parseInt(n,10)]:r=r[n]}return r}function Si(e,t,r,n){let i=e.trim();if(t==="JSON"||t==="Text"&&i.startsWith("{")||i.startsWith("["))try{let s=JSON.parse(i);if(r.length>0){let c=sn(s,r);if(typeof c=="string"&&c.length>0)return it(c,n)}let l=[["url"],["link"],["href"],["file"],["download"],["data","url"],["data","link"],["data","file"],["result","url"],["result","link"],["response","url"],["response","link"],["files","0","url"],["files","0","link"],["image","url"],["image","link"],["upload","url"],["upload","link"]];for(let c of l){let u=sn(s,c);if(typeof u=="string"&&(u.startsWith("http")||u.startsWith("/")))return g.debug(`[BigFileUpload] Auto-detected URL at path: ${c.join(".")}`),it(u,n)}if(typeof s=="string"&&(s.startsWith("http")||s.startsWith("/")))return it(s,n);throw new Error("Could not find URL in JSON response. Try specifying a URL path.")}catch(s){if(t==="JSON")throw s}if(i.startsWith("http://")||i.startsWith("https://")){let s=i.split(/[\r\n]/)[0].trim();if(s.startsWith("http"))return s}let o=/https?:\/\/[^\s<>"')\]]+/gi,a=i.match(o);if(a&&a.length>0){let s=a.reduce((l,c)=>l.length>=c.length?l:c);return g.debug(`[BigFileUpload] Extracted URL from text response: ${s}`),s}return i.startsWith("/")&&n?it(i,n):i}function it(e,t){if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;if(t)try{let r=new URL(t);return e.startsWith("/")?`${r.protocol}//${r.host}${e}`:new URL(e,t).href}catch{}return e}var g={info:(...e)=>{nt[zt]>=nt.info&&console.log(...e)},debug:(...e)=>{nt[zt]>=nt.debug&&console.debug(...e)},warn:(...e)=>console.warn(...e),error:(...e)=>console.error(...e)};function pn(e){zt=e??"errors"}async function ie(e,t){let r=ln.default.tmpdir(),i=`vencord-upload-${`${Date.now()}-${Ae.default.randomBytes(8).toString("hex")}`}-${t}`,o=Gt.default.join(r,i);return await z.default.promises.writeFile(o,Buffer.from(e)),o}async function an(e){return e.length===0?null:new Promise(t=>{let r=!1,n=e.length;for(let i of e)i.then(o=>{!r&&o!==null?(r=!0,t(o)):(n--,n===0&&!r&&t(null))}).catch(()=>{n--,n===0&&!r&&t(null)})})}async function N(e){try{await z.default.promises.unlink(e),g.debug(`[BigFileUpload] Temp file deleted: ${e}`)}catch(t){let r=t instanceof Error?t.message:String(t);g.debug(`[BigFileUpload] Failed to delete temp file ${e}: ${r}`)}}async function Ui(){return"https://upload.gofile.io/uploadfile"}function hn(e,t,r,n={},i,o,a=3e5){let s=!1;return new Promise((l,c)=>{let u=new URL(e),m=u.protocol==="https:",E=m?Se.default:ct.default;if(!z.default.existsSync(t)){c(new Error(`File not found: ${t}`));return}let P=z.default.statSync(t).size;if(P===0){c(new Error(`File is empty (0 bytes): ${t}`));return}try{z.default.accessSync(t,z.default.constants.R_OK)}catch{c(new Error(`File is not readable: ${t}`));return}let D={hostname:u.hostname,port:u.port||(m?443:80),path:u.pathname+u.search,method:"PUT",headers:{"Content-Type":"application/octet-stream","Content-Length":P,...n}};m&&(D.agent=new Se.default.Agent({keepAlive:!0,timeout:3e4,rejectUnauthorized:!0}));let A=Date.now(),k=Date.now(),p=0,x=setInterval(()=>{Date.now()-k>3e5&&(clearInterval(x),T.destroy(),c(new Error("Upload stalled - no progress for 5 minutes")))},1e4),T=E.request(D,w=>{let v="",b=!1;w.socket.setTimeout(6e4),w.on("data",h=>{if(v.length+h.length>de){b||(g.warn(`[BigFileUpload] Response exceeded ${de} bytes, truncating`),b=!0);return}v+=h}),w.on("end",()=>{if(clearInterval(x),o&&K.delete(o),o&&H.has(o)){H.delete(o),c(new Error("Upload cancelled by user"));return}if(b){c(new Error(`Response exceeded maximum size (${de} bytes) and was truncated. The upload may have succeeded but the response could not be processed.`));return}if(w.statusCode&&w.statusCode>=200&&w.statusCode<300)o&&H.delete(o),l(v);else{let h=`HTTP ${w.statusCode}: ${w.statusMessage}`;w.statusCode===500?h="HTTP 500: Server Internal Error - The upload service is experiencing issues. Try using a different uploader (temp.sh, Catbox, 0x0.st, or file.io).":w.statusCode===502||w.statusCode===503||w.statusCode===504?h=`HTTP ${w.statusCode}: Service Unavailable - The upload service is temporarily down or overloaded. Try using a different uploader.`:w.statusCode===429?h="HTTP 429: Rate Limited - Too many requests. Please wait before trying again.":w.statusCode===413&&(h="HTTP 413: File Too Large - The file exceeds the service's size limit."),v&&v.length>0&&v.length<500&&(h+=`
Server response: ${v}`),c(new Error(h))}})});T.setTimeout(a),T.on("timeout",()=>{clearInterval(x),o&&K.delete(o),T.destroy(),c(new Error("Request timeout - The server took too long to respond."))}),T.on("error",w=>{if(clearInterval(x),o&&K.delete(o),s)c(new Error("Upload cancelled by user"));else{let v=w.message||String(w);if(v.includes("ECONNRESET")||v.includes("Client network socket disconnected")){let b=e.includes("0x0.st")?"0x0.st":e.includes("tmpfiles.org")?"tmpfiles.org":e.includes("catbox")?"Catbox/Litterbox":"the upload service",h="";e.includes("catbox")||e.includes("litterbox")?h="Please try using: 0x0.st, tmpfiles.org, temp.sh, file.io, or transfer.sh instead.":e.includes("0x0.st")||e.includes("tmpfiles")?h="Please try using: Catbox, Litterbox, temp.sh, file.io, or transfer.sh instead.":h="Please try using a different uploader service.",c(new Error(`Connection blocked to ${b} - This could mean:
1. Your network/firewall is blocking SSL/TLS connections to this service
2. The service is blocked by your ISP or organization
3. There's a proxy interfering with the connection

Try using a VPN, proxy, or connecting from a different network.

`+h))}else if(v.includes("ETIMEDOUT"))c(new Error("Connection timed out - The upload service did not respond in time. Try again or use a different uploader."));else if(v.includes("ENOTFOUND"))c(new Error("Service not found - Cannot reach the upload service. Check your internet connection."));else if(v.includes("EPIPE")||v.includes("ECONNABORTED"))c(new Error("Connection aborted - The server terminated the connection. This may be due to file size limits or server issues. Try a different uploader."));else if(v.includes("self signed certificate")||v.includes("SELF_SIGNED")||v.includes("UNABLE_TO_VERIFY_LEAF_SIGNATURE")||v.includes("DEPTH_ZERO_SELF_SIGNED_CERT")){let b=e.includes("0x0.st")?"0x0.st":e.includes("tmpfiles.org")?"tmpfiles.org":e.includes("catbox")?"Catbox/Litterbox":e.includes("temp.sh")?"temp.sh":e.includes("filebin.net")?"filebin.net":e.includes("buzzheavier")?"buzzheavier.com":e.includes("gofile")?"GoFile":"the upload service";c(new Error(`SSL certificate error with ${b} - You may be behind a corporate firewall or proxy that uses self-signed certificates. The plugin will try alternative uploaders automatically.`))}else c(w)}});let d=()=>{if(o&&H.has(o))return;let w=(Date.now()-A)/1e3,v=p/w/1024/1024,b=p/P*100,h=w>0?(P-p)/(p/w):0;i&&!i.isDestroyed()&&o&&($={uploadId:o,fileName:r,loaded:p,total:P,percent:b,speed:v,eta:h})},y=z.default.createReadStream(t,{highWaterMark:256*1024}),L=0;y.on("data",w=>{if(s){y.destroy();return}let v=T.write(w);p+=w.length,k=Date.now();let b;P>100*1024*1024?b=5*1024*1024:P>10*1024*1024?b=2*1024*1024:b=512*1024,(p-L>=b||p===w.length)&&(d(),L=p),v||(y.pause(),T.once("drain",()=>{y.resume()}))}),y.on("end",()=>{if(s){T.destroy();return}d(),T.end()}),y.on("error",w=>{clearInterval(x),T.destroy(),c(w)}),o&&K.set(o,{req:T,cleanup:()=>{s=!0,clearInterval(x);try{y.destroy()}catch{}try{T.socket&&T.socket.destroy(),T.destroy()}catch{}}})})}function Ri(e,t,r,n,i,o={},a,s,l=3e5){let c=!1;return new Promise((u,m)=>{let E=new URL(e),U=E.protocol==="https:",P=U?Se.default:ct.default;if(fn(E.hostname)){m(new Error(`Custom uploader: Blocked request to private/reserved IP: ${E.hostname}`));return}if(!z.default.existsSync(t)){m(new Error(`File not found: ${t}`));return}let A=z.default.statSync(t).size;if(A===0){m(new Error(`File is empty (0 bytes): ${t}`));return}try{z.default.accessSync(t,z.default.constants.R_OK)}catch{m(new Error(`File is not readable: ${t}`));return}let k=Vt(o),p={hostname:E.hostname,port:E.port||(U?443:80),path:E.pathname+E.search,method:i,headers:{"Content-Type":n||"application/octet-stream","Content-Length":A,"User-Agent":"Vencord-BigFileUpload/1.0",...k}};U&&(p.agent=new Se.default.Agent({keepAlive:!0,timeout:3e4,rejectUnauthorized:!0}));let x=Date.now(),T=Date.now(),d=0,y=setInterval(()=>{Date.now()-T>3e5&&(clearInterval(y),L.destroy(),m(new Error("Upload stalled - no progress for 5 minutes")))},1e4),L=P.request(p,h=>{let R="",G=!1;h.socket.setTimeout(6e4),h.on("data",M=>{if(R.length+M.length>de){G||(g.warn(`[BigFileUpload] Response exceeded ${de} bytes, truncating`),G=!0);return}R+=M}),h.on("end",()=>{if(clearInterval(y),s&&K.delete(s),s&&H.has(s)){H.delete(s),m(new Error("Upload cancelled by user"));return}if(G){m(new Error(`Response exceeded maximum size (${de} bytes) and was truncated.`));return}if(h.statusCode&&h.statusCode>=200&&h.statusCode<300)s&&H.delete(s),u(R);else{let M=`HTTP ${h.statusCode}: ${h.statusMessage}`;h.statusCode===500?M="HTTP 500: Server Internal Error - The custom upload service is experiencing issues.":h.statusCode===502||h.statusCode===503||h.statusCode===504?M=`HTTP ${h.statusCode}: Service Unavailable - The custom upload service is temporarily down.`:h.statusCode===429?M="HTTP 429: Rate Limited - Too many requests to the custom uploader.":h.statusCode===413&&(M="HTTP 413: File Too Large - The file exceeds the custom service's size limit."),R&&R.length>0&&R.length<500&&(M+=`
Server response: ${R}`),m(new Error(M))}})});L.setTimeout(l),L.on("timeout",()=>{clearInterval(y),s&&K.delete(s),L.destroy(),m(new Error("Request timeout - The custom uploader took too long to respond."))}),L.on("error",h=>{clearInterval(y),s&&K.delete(s),m(c?new Error("Upload cancelled by user"):h)});let w=()=>{if(s&&H.has(s))return;let h=(Date.now()-x)/1e3,R=d/h/1024/1024,G=d/A*100,M=h>0?(A-d)/(d/h):0;a&&!a.isDestroyed()&&s&&($={uploadId:s,fileName:r,loaded:d,total:A,percent:G,speed:R,eta:M})},v=z.default.createReadStream(t,{highWaterMark:256*1024}),b=0;v.on("data",h=>{if(c){v.destroy();return}let R=L.write(h);d+=h.length,T=Date.now();let G;A>100*1024*1024?G=5*1024*1024:A>10*1024*1024?G=2*1024*1024:G=512*1024,(d-b>=G||d===h.length)&&(w(),b=d),R||(v.pause(),L.once("drain",()=>{v.resume()}))}),v.on("end",()=>{if(c){L.destroy();return}w(),L.end()}),v.on("error",h=>{clearInterval(y),L.destroy(),m(h)}),s&&K.set(s,{req:L,cleanup:()=>{c=!0,clearInterval(y);try{v.destroy()}catch{}try{L.socket&&L.socket.destroy(),L.destroy()}catch{}}})})}function pe(e,t,r,n,i,o,a={},s,l,c=3e5){let u=!1;return new Promise((m,E)=>{let U=`----WebKitFormBoundary${Ae.default.randomBytes(16).toString("hex")}`,P=new URL(e),D=P.protocol==="https:",A=D?Se.default:ct.default;if(!z.default.existsSync(t)){E(new Error(`File not found: ${t}`));return}let p=z.default.statSync(t).size;if(p===0){E(new Error(`File is empty (0 bytes): ${t}`));return}try{z.default.accessSync(t,z.default.constants.R_OK)}catch{E(new Error(`File is not readable: ${t}`));return}let x=[];for(let[S,_]of Object.entries(o))S&&S.trim()!==""&&x.push(Buffer.from(`--${U}\r
Content-Disposition: form-data; name="${S}"\r
\r
${_}\r
`));x.push(Buffer.from(`--${U}\r
Content-Disposition: form-data; name="${i}"; filename="${r}"\r
Content-Type: ${n||"application/octet-stream"}\r
\r
`));let T=Buffer.concat(x),d=Buffer.from(`\r
--${U}--\r
`),y=T.length+p+d.length,L={hostname:P.hostname,port:P.port||(D?443:80),path:P.pathname+P.search,method:"POST",headers:{"Content-Type":`multipart/form-data; boundary=${U}`,"Content-Length":y,...a}};D&&(L.agent=new Se.default.Agent({keepAlive:!0,timeout:3e4,rejectUnauthorized:!0}));let w=Date.now(),v=Date.now(),b=0,h=setInterval(()=>{Date.now()-v>3e5&&(clearInterval(h),R.destroy(),E(new Error("Upload stalled - no progress for 5 minutes")))},1e4),R=A.request(L,S=>{let _="",B=!1;S.socket.setTimeout(6e4),S.on("data",V=>{if(_.length+V.length>de){B||(g.warn(`[BigFileUpload] Response exceeded ${de} bytes, truncating`),B=!0);return}_+=V}),S.on("end",()=>{if(clearInterval(h),l&&K.delete(l),l&&H.has(l)){H.delete(l),E(new Error("Upload cancelled by user"));return}if(B){E(new Error(`Response exceeded maximum size (${de} bytes) and was truncated. The upload may have succeeded but the response could not be processed.`));return}if(S.statusCode&&S.statusCode>=200&&S.statusCode<300)l&&H.delete(l),m(_);else{let V=`HTTP ${S.statusCode}: ${S.statusMessage}`;S.statusCode===500?V="HTTP 500: Server Internal Error - The upload service is experiencing issues. This is a server-side problem, not a client error.":S.statusCode===502||S.statusCode===503||S.statusCode===504?V=`HTTP ${S.statusCode}: Service Unavailable - The upload service is temporarily down or overloaded.`:S.statusCode===429?V="HTTP 429: Rate Limited - Too many requests. Please wait before trying again.":S.statusCode===413?V="HTTP 413: File Too Large - The file exceeds the service's size limit.":S.statusCode&&S.statusCode>=400&&S.statusCode<500&&(V=`HTTP ${S.statusCode}: Client Error - ${S.statusMessage}`),_&&_.length>0&&_.length<500&&(V+=`
Server response: ${_}`),E(new Error(V))}})});R.setTimeout(c),R.on("timeout",()=>{clearInterval(h),l&&K.delete(l),R.destroy(),E(new Error("Request timeout - The server took too long to respond."))}),R.on("error",S=>{if(clearInterval(h),l&&K.delete(l),u)E(new Error("Upload cancelled by user"));else{let _=S.message||String(S);if(_.includes("ECONNRESET")||_.includes("Client network socket disconnected")){let B=e.includes("0x0.st")?"0x0.st":e.includes("tmpfiles.org")?"tmpfiles.org":e.includes("catbox")?"Catbox/Litterbox":"the upload service",V="";e.includes("catbox")||e.includes("litterbox")?V="Please try using: 0x0.st, tmpfiles.org, temp.sh, file.io, or transfer.sh instead.":e.includes("0x0.st")||e.includes("tmpfiles")?V="Please try using: Catbox, Litterbox, temp.sh, file.io, or transfer.sh instead.":V="Please try using a different uploader service.",E(new Error(`Connection blocked to ${B} - This could mean:
1. Your network/firewall is blocking SSL/TLS connections to this service
2. The service is blocked by your ISP or organization
3. There's a proxy interfering with the connection

Try using a VPN, proxy, or connecting from a different network.

`+V))}else if(_.includes("ETIMEDOUT"))E(new Error("Connection timed out - The upload service did not respond in time. Try again or use a different uploader."));else if(_.includes("ENOTFOUND"))E(new Error("Service not found - Cannot reach the upload service. Check your internet connection."));else if(_.includes("EPIPE")||_.includes("ECONNABORTED"))E(new Error("Connection aborted - The server terminated the connection. This may be due to file size limits or server issues. Try a different uploader."));else if(_.includes("self signed certificate")||_.includes("SELF_SIGNED")||_.includes("UNABLE_TO_VERIFY_LEAF_SIGNATURE")||_.includes("DEPTH_ZERO_SELF_SIGNED_CERT")){let B=e.includes("0x0.st")?"0x0.st":e.includes("tmpfiles.org")?"tmpfiles.org":e.includes("catbox")?"Catbox/Litterbox":e.includes("temp.sh")?"temp.sh":e.includes("filebin.net")?"filebin.net":e.includes("buzzheavier")?"buzzheavier.com":e.includes("gofile")?"GoFile":"the upload service";E(new Error(`SSL certificate error with ${B} - You may be behind a corporate firewall or proxy that uses self-signed certificates. The plugin will try alternative uploaders automatically.`))}else E(S)}});let G=()=>{if(l&&H.has(l))return;let S=(Date.now()-w)/1e3,_=b/S/1024/1024,B=b/y*100,V=S>0?(y-b)/(b/S):0;s&&!s.isDestroyed()&&l&&($={uploadId:l,fileName:r,loaded:b,total:y,percent:B,speed:_,eta:V})};R.write(T),b+=T.length,v=Date.now();let M=z.default.createReadStream(t,{highWaterMark:256*1024}),Oe=0,re=0;M.on("data",S=>{if(u){M.destroy();return}let _=R.write(S);b+=S.length,re+=S.length,v=Date.now();let B;p>100*1024*1024?B=5*1024*1024:p>10*1024*1024?B=2*1024*1024:B=512*1024,(re-Oe>=B||re===S.length)&&(G(),Oe=re),_||(M.pause(),R.once("drain",()=>{M.resume()}))}),M.on("end",()=>{if(u){R.destroy();return}R.write(d),b+=d.length,v=Date.now(),G(),p<1024*1024?setTimeout(()=>{R.end()},100):R.end()}),M.on("error",S=>{clearInterval(h),R.destroy(),E(S)}),l&&K.set(l,{req:R,cleanup:()=>{u=!0,clearInterval(h);try{M.destroy()}catch{}try{R.socket&&R.socket.destroy(),R.destroy()}catch{}}})})}async function Zt(e,t,r,n,i,o=3e5){let a,s=!1;try{if(typeof t=="string"?a=t:(a=await ie(t,r),s=!0),!a)throw new Error("Failed to resolve file path for GoFile upload");let l={};n&&(l.token=n);let c=await Ui(),u=await pe(c,a,r,"application/octet-stream","file",l,{"User-Agent":"VencordBigFileUpload/1.0"},e.sender,i,o),m=JSON.parse(u);return s&&await N(a),m}catch(l){throw s&&a&&await N(a),l}}async function qt(e,t,r,n,i,o,a,s=3e5){let l,c=!1;try{if(typeof r=="string"?l=r:(l=await ie(r,n),c=!0),!l)throw new Error("Failed to resolve file path for Catbox upload");let u={reqtype:"fileupload"},m=o?.trim();m&&(u.userhash=m);let E=await pe(t,l,n,i,"fileToUpload",u,{"User-Agent":"VencordBigFileUpload/1.0"},e.sender,a,s);return c&&await N(l),E}catch(u){throw c&&l&&await N(l),u}}async function jt(e,t,r,n,i,o,a=3e5){let s,l=!1;try{if(typeof t=="string"?s=t:(s=await ie(t,r),l=!0),!s)throw new Error("Failed to resolve file path for Litterbox upload");let u=await pe("https://litterbox.catbox.moe/resources/internals/api.php",s,r,n,"fileToUpload",{reqtype:"fileupload",time:i},{"User-Agent":"VencordBigFileUpload/1.0"},e.sender,o,a);return l&&await N(s),u}catch(c){throw l&&s&&await N(s),c}}async function Fi(e,t,r,n,i,o,a=3e5){let s,l=!1;try{if(typeof t=="string"?s=t:(s=await ie(t,r),l=!0),!s)throw new Error("Failed to resolve file path for transfer.sh upload");let c={"User-Agent":"Vencord-BigFileUpload/1.0"};n&&n.trim()!==""&&(c["Max-Days"]=n),i&&i.trim()!==""&&(c["Max-Downloads"]=i);let u=await hn(`https://transfer.sh/${encodeURIComponent(r)}`,s,r,c,e.sender,o,a);return l&&await N(s),u.trim()}catch(c){throw l&&s&&await N(s),c}}async function Jt(e,t,r,n,i=3e5){let o,a=!1;try{if(typeof t=="string"?o=t:(o=await ie(t,r),a=!0),!o)throw new Error("Failed to resolve file path for temp.sh upload");let s=await pe("https://temp.sh/upload",o,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},e.sender,n,i);return a&&await N(o),s.trim()}catch(s){throw a&&o&&await N(o),s}}async function Yt(e,t,r,n,i=3e5){let o,a=!1;try{if(typeof t=="string"?o=t:(o=await ie(t,r),a=!0),!o)throw new Error("Failed to resolve file path for tmpfiles.org upload");let s=await pe("https://tmpfiles.org/api/v1/upload",o,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},e.sender,n,i),l=JSON.parse(s);if(l.status==="success"&&l.data?.url){a&&await N(o);let c=l.data.url;return c.includes("tmpfiles.org/")&&!c.includes("/dl/")&&(c=c.replace(/tmpfiles\.org\/(\d+)/,"tmpfiles.org/dl/$1")),c}else throw new Error(`tmpfiles.org upload failed: ${s}`)}catch(s){throw a&&o&&await N(o),s}}async function Kt(e,t,r,n,i=3e5){let o,a=!1;try{if(typeof t=="string"?o=t:(o=await ie(t,r),a=!0),!o)throw new Error("Failed to resolve file path for filebin.net upload");let s=Ae.default.randomBytes(6).toString("hex");return await pe(`https://filebin.net/${s}/${encodeURIComponent(r)}`,o,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},e.sender,n,i),a&&await N(o),`https://filebin.net/${s}/${encodeURIComponent(r)}`}catch(s){throw a&&o&&await N(o),s}}async function Xt(e,t,r,n,i=3e5){let o,a=!1;try{if(typeof t=="string"?o=t:(o=await ie(t,r),a=!0),!o)throw new Error("Failed to resolve file path for buzzheavier.com upload");let s=await hn(`https://w.buzzheavier.com/${encodeURIComponent(r)}`,o,r,{"User-Agent":"VencordBigFileUpload/1.0"},e.sender,n,i);a&&await N(o);try{let l=JSON.parse(s);if(l.code===201&&l.data?.id)return`https://buzzheavier.com/${l.data.id}`;throw new Error(`Unexpected buzzheavier.com response: ${s}`)}catch{return s.trim()}}catch(s){throw a&&o&&await N(o),s}}async function Ci(e,t,r,n,i,o=3e5){let a,s=!1;try{if(typeof t=="string"?a=t:(a=await ie(t,r),s=!0),!a)throw new Error("Failed to resolve file path for file.io upload");let l="https://file.io/";n&&n.trim()!==""&&(l+=`?expires=${encodeURIComponent(n)}`);let c=await pe(l,a,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},e.sender,i,o),u=JSON.parse(c);if(u.success&&u.link)return s&&await N(a),u.link;throw new Error(`file.io upload failed: ${c}`)}catch(l){throw s&&a&&await N(a),l}}async function Qt(e,t,r,n,i,o=3e5){let a,s=!1;try{if(typeof t=="string"?a=t:(a=await ie(t,r),s=!0),!a)throw new Error("Failed to resolve file path for 0x0.st upload");let l={};n&&n.trim()!==""&&(l.expires=n);let c=await pe("https://0x0.st",a,r,"application/octet-stream","file",l,{"User-Agent":"VencordBigFileUpload/1.0"},e.sender,i,o);return s&&await N(a),c.trim()}catch(l){throw s&&a&&await N(a),l}}async function er(e,t,r,n,i,o,a,s,l,c,u,m,E,U=3e5){let P,D=!1,A=m||"POST",k=E||"MultipartFormData";try{if(typeof r=="string"?P=r:(P=await ie(r,n),D=!0),!P)throw new Error("Failed to resolve file path for custom upload");let p;if(k==="Binary"){g.info(`[BigFileUpload] Custom uploader using ${A} with binary body`);let T=Vt(s);p=await Ri(t,P,n,i,A,T,e.sender,u,U)}else{g.info("[BigFileUpload] Custom uploader using POST with multipart form data");let T={};for(let[y,L]of Object.entries(a))y&&y.trim()!==""&&(T[y]=L);let d=Vt(s);delete d["Content-Type"],delete d["content-type"],p=await pe(t,P,n,i,o,T,{...d,"User-Agent":"Vencord-BigFileUpload/1.0"},e.sender,u,U)}let x=Si(p,l,c,t);return D&&await N(P),x}catch(p){throw D&&P&&await N(P),p}}async function Di(e,t,r,n,i){pn(i.loggingLevel);let o=un(i.uploadTimeout);g.info(`[BigFileUpload NATIVE] uploadFileBuffer called for: ${r} (type: ${n})`),g.info(`[BigFileUpload NATIVE] Received uploader setting: "${i.fileUploader}"`);try{let a=t.byteLength;g.info(`[BigFileUpload] Uploading from buffer: ${r} (${(a/1024/1024).toFixed(1)}MB)`);let s=["Catbox","Litterbox","0x0.st","tmpfiles.org","GoFile","buzzheavier.com","temp.sh","filebin.net"],l=i.fileUploader||"Catbox",c=cn(r,l);g.info(`[BigFileUpload NATIVE] Primary uploader will be: ${c}`);let u=[c],m=c==="Custom";if(i.disableFallbacks===!0)g.info(`[BigFileUpload] Fallbacks disabled by user setting - only using ${c}`);else if(m)g.info(`[BigFileUpload] ${c} is exclusive - no fallback uploaders will be used`);else{let p=Ht(r);for(let x of s)x!==c&&!(p&&Wt.includes(x))&&u.push(x)}g.info(`[BigFileUpload] Will try uploaders in order: ${u.join(", ")}`);let U=`upload-${Ae.default.randomUUID()}`;g.debug(`[BigFileUpload NATIVE] Upload ID: ${U}`),H.delete(U),$={uploadId:U,fileName:r,fileSize:a,loaded:0,total:a,percent:0,speed:0,eta:0},ae=Date.now();let P=async(p,x=!1)=>{let T;switch(p){case"GoFile":{let d=await Zt(e,t,r,i.gofileToken,x?void 0:U,o);if(d.status==="ok"&&d.data){let y=d.data.downloadPage||(d.data.code?`https://gofile.io/d/${d.data.code}`:void 0);if(!y)throw new Error(`GoFile response missing download URL: ${JSON.stringify(d)}`);T=y}else throw new Error(`GoFile upload failed: ${d.error||JSON.stringify(d)}`);break}case"Catbox":{T=await qt(e,"https://catbox.moe/user/api.php",t,r,n||"application/octet-stream",i.catboxUserHash||"",x?void 0:U,o);break}case"Litterbox":{T=await jt(e,t,r,n||"application/octet-stream",i.litterboxTime||"1h",x?void 0:U,o);break}case"temp.sh":{T=await Jt(e,t,r,x?void 0:U,o);break}case"0x0.st":{T=await Qt(e,t,r,i.zeroX0Expires,x?void 0:U,o);break}case"tmpfiles.org":{T=await Yt(e,t,r,x?void 0:U,o);break}case"filebin.net":{T=await Kt(e,t,r,x?void 0:U,o);break}case"buzzheavier.com":{T=await Xt(e,t,r,x?void 0:U,o);break}case"Custom":{if(!i.customUploaderRequestURL||i.customUploaderRequestURL.trim()==="")throw new Error("Custom uploader not configured - skipping to next uploader");if(x)throw new Error("Custom uploader cannot be retried in background");let d=at(i.customUploaderArgs,{}),y=at(i.customUploaderHeaders,{}),L=(i.customUploaderURL||"").split(".").filter(w=>w);T=await er(e,i.customUploaderRequestURL,t,r,n||"application/octet-stream",i.customUploaderFileFormName||"file",d,y,i.customUploaderResponseType||"Text",L,U,i.customUploaderRequestMethod,i.customUploaderBodyType,o);break}default:throw new Error(`Unknown uploader: ${p}`)}if(!dn(T))throw new Error(`Invalid URL received from ${p}: ${T.substring(0,100)}`);return T},D=[],A=null,k=[];for(let p of u){let x=k.length+1,T=u.length;if(g.info(`[BigFileUpload] Trying uploader: ${p} (attempt ${x}/${T})`),x===1?g.info(`[BigFileUpload] Starting upload to ${p}`):g.info(`[BigFileUpload] Retrying with ${p} (attempt ${x}/${T})`),D.length>0){let d=await an(D.map(y=>y.promise));if(d){g.info(`[BigFileUpload] \u2705 Background retry succeeded with ${d.uploader}!`);let y=d.url;return i.useEmbedsVideo==="Yes"&&(y=ot(d.url,i.embedService)),i.autoFormat==="Yes"&&(y=`[${r}](${y})`),{success:!0,url:y,fileName:r,fileSize:a,uploadId:U,actualUploader:d.uploader,attemptedUploaders:[...k,d.uploader]}}}try{g.debug(`[BigFileUpload NATIVE] Trying ${p}`);let d=await P(p,!1),y=d;return i.useEmbedsVideo==="Yes"&&(y=ot(d,i.embedService)),i.autoFormat==="Yes"&&(y=`[${r}](${y})`),g.info(`[BigFileUpload] \u2705 Upload successful with ${p}! File: ${r} (${(a/1024/1024).toFixed(2)}MB) \u2192 ${d}`),{success:!0,url:y,fileName:r,fileSize:a,uploadId:U,actualUploader:p,attemptedUploaders:[...k,p]}}catch(d){let y=d instanceof Error?d.message:String(d);if(y.toLowerCase().includes("upload cancelled by user"))return g.info("[BigFileUpload] Upload cancelled by user, aborting retries"),He(),{success:!1,error:"Upload cancelled by user",attemptedUploaders:k};g.error(`[BigFileUpload] Upload failed with ${p}:`,d),A=new Error(`[${p}] ${y}`),k.push(p),g.debug(`[BigFileUpload] Error details for ${p}: ${y}`);let L=y;y.length>100&&(L=y.substring(0,100)+"...");let w=k.length>=u.length;if(e.sender&&!e.sender.isDestroyed())if(w)lt(e,{type:"failure",message:`${p} failed: ${L}`});else{let v=u[k.length];lt(e,{type:"failure",message:`${p} failed: ${L}. Trying ${v}...`})}if(p!=="Custom"&&!D.some(v=>v.uploader===p)){g.info(`[BigFileUpload] Starting background retry for ${p}`);let v=(async()=>{await new Promise(b=>setTimeout(b,1e3));try{let b=await P(p,!0);return g.info(`[BigFileUpload] Background retry succeeded for ${p}`),{url:b,uploader:p}}catch(b){return g.debug(`[BigFileUpload] Background retry failed for ${p}:`,b),null}})();D.push({uploader:p,promise:v})}if(!w){let v=u[k.length];g.warn(`[BigFileUpload] ${p} failed. Trying ${v}...`),$&&$.uploadId===U&&($={...$,loaded:0,percent:0,speed:0,eta:0},ae=Date.now())}if(y.toLowerCase().includes("read")&&y.toLowerCase().includes("image")?g.error(`[BigFileUpload] IMAGE READ ERROR from ${p}: ${y}`):y.includes("412")||y.includes("415")||y.includes("Bad file type")||y.includes("Unsupported Media Type")?g.warn(`[BigFileUpload] File type rejected by ${p}`):(y.includes("File not found")||y.includes("empty")||y.includes("not readable"))&&g.error(`[BigFileUpload] FILE ACCESS ERROR: ${y}`),w){g.info("[BigFileUpload] All primary uploaders exhausted, waiting for background retries...");let v=await Promise.race([an(D.map(b=>b.promise)),new Promise(b=>setTimeout(()=>b(null),3e4))]);if(v){g.info(`[BigFileUpload] \u2705 Background retry saved the day with ${v.uploader}!`);let b=v.url;return i.useEmbedsVideo==="Yes"&&(b=ot(v.url,i.embedService)),i.autoFormat==="Yes"&&(b=`[${r}](${b})`),{success:!0,url:b,fileName:r,fileSize:a,uploadId:U,actualUploader:v.uploader,attemptedUploaders:[...k,v.uploader]}}g.warn("[BigFileUpload] No more uploaders to try and no background retries succeeded");break}}}return g.error(`[BigFileUpload] All uploaders failed. Attempted: ${k.join(", ")}`),He(),{success:!1,error:`All upload services failed. Last error: ${A?.message||"Connection issue"}. Tried: ${k.join(", ")}`}}catch(a){return g.error("[BigFileUpload] Unexpected error in uploadFileBuffer:",a),He(),{success:!1,error:`Unexpected error: ${a instanceof Error?a.message:String(a)}. Please try again.`}}}async function Pi(e,t){pn(t.loggingLevel);let r=un(t.uploadTimeout),n=Ze.BrowserWindow.fromWebContents(e.sender),i={title:"Select file to upload",properties:["openFile","dontAddToRecent"]},{canceled:o,filePaths:a}=n?await Ze.dialog.showOpenDialog(n,i):await Ze.dialog.showOpenDialog(i);if(o||a.length===0)return{success:!1,error:"File selection cancelled"};let s=a[0],l=Gt.default.basename(s),u=(await z.default.promises.stat(s)).size;if(t.respectNitroLimit){let d=on[t.nitroTier||"none"]||on.none;if(u<=d){g.info(`[BigFileUpload] File under Nitro limit (${(u/1024/1024).toFixed(1)}MB <= ${(d/1024/1024).toFixed(0)}MB), using Discord native upload`);let y=await z.default.promises.readFile(s);return{success:!0,useNativeUpload:!0,fileName:l,fileSize:u,buffer:y.buffer.slice(y.byteOffset,y.byteOffset+y.byteLength)}}}g.info(`[BigFileUpload] Securely uploading: ${l} (${(u/1024/1024).toFixed(1)}MB)`),g.debug(`[BigFileUpload] File path (main process only): ${s}`);let m=["Catbox","Litterbox","0x0.st","tmpfiles.org","GoFile","buzzheavier.com","temp.sh","filebin.net"],E=t.fileUploader||"Catbox",U=cn(l,E),P=Ht(l),D=[U],A=U==="Custom";if(t.disableFallbacks===!0)g.info(`[BigFileUpload] Fallbacks disabled by user setting - only using ${U}`);else if(A)g.info(`[BigFileUpload] ${U} is exclusive - no fallback uploaders will be used`);else for(let d of m)d!==U&&d!=="Custom"&&!(P&&Wt.includes(d))&&D.push(d);g.info(`[BigFileUpload] Will try uploaders in order: ${D.join(", ")}`);let p=`upload-${Ae.default.randomUUID()}`;H.delete(p),$={uploadId:p,fileName:l,fileSize:u,loaded:0,total:u,percent:0,speed:0,eta:0},ae=Date.now();let x=null,T=[];for(let d of D){let y=T.length+1,L=D.length;g.info(`[BigFileUpload] Trying uploader: ${d} (attempt ${y}/${L})`),y===1?g.info(`[BigFileUpload] Starting upload to ${d}`):g.info(`[BigFileUpload] Retrying with ${d} (attempt ${y}/${L})`);try{let w;switch(d){case"GoFile":{g.debug("[BigFileUpload] Trying GoFile");let b=await Zt(e,s,l,t.gofileToken,p,r);if(b.status==="ok"&&b.data){let h=b.data.downloadPage||(b.data.code?`https://gofile.io/d/${b.data.code}`:void 0);if(!h)throw new Error(`GoFile response missing download URL: ${JSON.stringify(b)}`);w=h}else throw new Error(`GoFile upload failed: ${b.error||JSON.stringify(b)}`);break}case"Catbox":{g.debug("[BigFileUpload] Trying Catbox"),w=await qt(e,"https://catbox.moe/user/api.php",s,l,"",t.catboxUserHash||"",p,r);break}case"Litterbox":{g.debug("[BigFileUpload] Trying Litterbox"),w=await jt(e,s,l,"",t.litterboxTime||"1h",p,r);break}case"temp.sh":{g.debug("[BigFileUpload] Trying temp.sh"),w=await Jt(e,s,l,p,r);break}case"0x0.st":{g.debug("[BigFileUpload] Trying 0x0.st"),w=await Qt(e,s,l,t.zeroX0Expires,p,r);break}case"tmpfiles.org":{g.debug("[BigFileUpload] Trying tmpfiles.org"),w=await Yt(e,s,l,p,r);break}case"filebin.net":{g.debug("[BigFileUpload] Trying filebin.net"),w=await Kt(e,s,l,p,r);break}case"buzzheavier.com":{g.debug("[BigFileUpload] Trying buzzheavier.com"),w=await Xt(e,s,l,p,r);break}case"Custom":{if(!t.customUploaderRequestURL||t.customUploaderRequestURL.trim()==="")throw new Error("Custom uploader not configured - skipping to next uploader");if(d!==U)throw new Error("Custom uploader only works as primary selection");let b=at(t.customUploaderArgs,{}),h=at(t.customUploaderHeaders,{}),R=(t.customUploaderURL||"").split(".").filter(M=>M);w=await er(e,t.customUploaderRequestURL,s,l,"",t.customUploaderFileFormName||"file",b,h,t.customUploaderResponseType||"Text",R,p,t.customUploaderRequestMethod,t.customUploaderBodyType,r);break}default:throw new Error(`Unknown uploader: ${d}`)}if(!dn(w))throw new Error(`Invalid URL received from ${d}: ${w.substring(0,100)}`);let v=w;return t.useEmbedsVideo==="Yes"&&(v=ot(w,t.embedService)),t.autoFormat==="Yes"&&(v=`[${l}](${v})`),g.info(`[BigFileUpload] \u2705 Upload successful with ${d}! File: ${l} (${(u/1024/1024).toFixed(2)}MB) \u2192 ${w}`),{success:!0,url:v,fileName:l,fileSize:u,uploadId:p,actualUploader:d,attemptedUploaders:[...T,d]}}catch(w){let v=w instanceof Error?w.message:String(w);if(v.toLowerCase().includes("upload cancelled by user"))return g.info("[BigFileUpload] Upload cancelled by user, aborting"),$&&$.uploadId===p&&($=void 0,ae=0),{success:!1,error:"Upload cancelled by user",attemptedUploaders:T};g.error(`[BigFileUpload] Upload failed with ${d}:`,w),x=new Error(`[${d}] ${v}`),T.push(d);let b=v;v.length>100&&(b=v.substring(0,100)+"...");let h=T.length===D.length-1;if(e.sender&&!e.sender.isDestroyed())if(h)lt(e,{type:"failure",message:`${d} failed: ${b}`});else{let G=D[T.length];lt(e,{type:"failure",message:`${d} failed: ${b}. Trying ${G}...`})}if(d===D[D.length-1])break;let R=D[T.length];g.warn(`[BigFileUpload] ${d} failed. Will retry with ${R}`),console.warn(`[BigFileUpload] Upload failed with ${d}, retrying with ${R}...`),$&&$.uploadId===p&&($={...$,loaded:0,percent:0,speed:0,eta:0},ae=Date.now())}}return g.error(`[BigFileUpload] All uploaders failed. Attempted: ${T.join(", ")}`),He(),{success:!1,error:`All upload services failed. Last error: ${x?.message||"Connection issue"}. Tried: ${T.join(", ")}`}}var $=null,ae=0,Li=300*1e3,K=new Map,H=new Set,We=[],ki=50;function lt(e,t){let r={...t,timestamp:Date.now()};We.push(r),We.length>ki&&We.shift(),g.debug("[BigFileUpload] Notification queued:",t)}function Ai(){let e=[...We];return We.length=0,e}function Ii(){if($&&$.uploadId&&H.has($.uploadId))return $=null,ae=0,null;if($&&ae>0){let e=Date.now()-ae;if(e>Li)return g.warn(`[BigFileUpload] Clearing stale progress data (${Math.round(e/1e3)}s old)`),$=null,ae=0,null}return $&&g.debug("[NATIVE] getLatestProgress returning:",$.percent+"%"),$}function He(){$=null,ae=0}function $i(e,t){g.info(`[BigFileUpload] Cancelling upload: ${t}`),H.add(t),setTimeout(()=>{H.delete(t),g.debug(`[BigFileUpload] Cleaned up cancelled upload ID: ${t}`)},3e4),$&&$.uploadId===t&&($=null);let r=K.get(t);if(r)try{r.cleanup();try{r.req.socket&&r.req.socket.destroy(),r.req.destroy()}catch{}return K.delete(t),g.info(`[BigFileUpload] Upload ${t} cancelled successfully`),{success:!0}}catch(n){return g.error(`[BigFileUpload] Error cancelling upload ${t}:`,n),{success:!1,error:n instanceof Error?n.message:String(n)}}else return g.warn(`[BigFileUpload] No active upload found for ID: ${t}, but marked as cancelled`),{success:!0}}var rr={};ue(rr,{getImageBuffer:()=>_i});f();async function _i(e,t){let n=await(await fetch(t)).arrayBuffer();return Buffer.from(n)}var nr={};ue(nr,{getMemory:()=>Oi});f();function Oi(){let e=process.memoryUsage();return{heapUsed:e.heapUsed,heapTotal:e.heapTotal}}var gn={AppleMusicRichPresence:It,ConsoleShortcuts:$t,FixSpotifyEmbeds:qr,FixYoutubeEmbeds:Jr,OpenInApp:_t,Translate:Ot,VoiceMessages:Mt,XSOverlay:Bt,YoutubeAdblock:rn,BigFileUpload:tr,RandomGary:rr,venfetch:nr};var mn={};for(let[e,t]of Object.entries(gn)){let r=Object.entries(t);if(!r.length)continue;let n=mn[e]={};for(let[i,o]of r){let a=`VencordPluginNative_${e}_${i}`;ir.ipcMain.handle(a,o),n[i]=a}}ir.ipcMain.on("VencordGetPluginIpcMethodMap",e=>{e.returnValue=mn});fe();f();function or(e,t=300){let r;return function(...n){clearTimeout(r),r=setTimeout(()=>{e(...n)},t)}}Ce();var O=require("electron");f();var vn="PCFkb2N0eXBlIGh0bWw+PGh0bWwgbGFuZz0iZW4iPjxoZWFkPjxtZXRhIGNoYXJzZXQ9InV0Zi04Ij48dGl0bGU+VmVuY29yZCBRdWlja0NTUyBFZGl0b3I8L3RpdGxlPjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tb25hY28tZWRpdG9yQDAuNTAuMC9taW4vdnMvZWRpdG9yL2VkaXRvci5tYWluLmNzcyIgaW50ZWdyaXR5PSJzaGEyNTYtdGlKUFEyTzA0ei9wWi9Bd2R5SWdock9NemV3ZitQSXZFbDFZS2JRdnNaaz0iIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiIHJlZmVycmVycG9saWN5PSJuby1yZWZlcnJlciI+PHN0eWxlPiNjb250YWluZXIsYm9keSxodG1se3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MDt0b3A6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO21hcmdpbjowO3BhZGRpbmc6MDtvdmVyZmxvdzpoaWRkZW59PC9zdHlsZT48L2hlYWQ+PGJvZHk+PGRpdiBpZD0iY29udGFpbmVyIj48L2Rpdj48c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tb25hY28tZWRpdG9yQDAuNTAuMC9taW4vdnMvbG9hZGVyLmpzIiBpbnRlZ3JpdHk9InNoYTI1Ni1LY1U0OFRHcjg0cjd1bkY3SjVJZ0JvOTVhZVZyRWJyR2UwNFM3VGNGVWpzPSIgY3Jvc3NvcmlnaW49ImFub255bW91cyIgcmVmZXJyZXJwb2xpY3k9Im5vLXJlZmVycmVyIj48L3NjcmlwdD48c2NyaXB0PnJlcXVpcmUuY29uZmlnKHtwYXRoczp7dnM6Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbW9uYWNvLWVkaXRvckAwLjUwLjAvbWluL3ZzIn19KSxyZXF1aXJlKFsidnMvZWRpdG9yL2VkaXRvci5tYWluIl0sKCgpPT57Z2V0Q3VycmVudENzcygpLnRoZW4oKGU9Pnt2YXIgdD1tb25hY28uZWRpdG9yLmNyZWF0ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29udGFpbmVyIikse3ZhbHVlOmUsbGFuZ3VhZ2U6ImNzcyIsdGhlbWU6Z2V0VGhlbWUoKX0pO3Qub25EaWRDaGFuZ2VNb2RlbENvbnRlbnQoKCgpPT5zZXRDc3ModC5nZXRWYWx1ZSgpKSkpLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCgoKT0+e3QubGF5b3V0KCl9KSl9KSl9KSk8L3NjcmlwdD48L2JvZHk+PC9odG1sPg==";var he=require("fs"),be=require("fs/promises"),we=require("path");f();fe();Ce();var Ie=require("electron");function yn(){Ie.ipcMain.handle("VencordCspRemoveOverride",zi),Ie.ipcMain.handle("VencordCspRequestAddOverride",Ni),Ie.ipcMain.handle("VencordCspIsDomainAllowed",Vi)}function Mi(e,t){try{let{host:r}=new URL(e);if(/[;'"\\]/.test(r))return!1}catch{return!1}return!(t.length===0||t.some(r=>!W.includes(r)))}function Bi(e,t,r){let n=new URL(e).host,i=`${r} wants to allow connections to ${n}`,o=`Unless you recognise and fully trust ${n}, you should cancel this request!

You will have to fully close and restart Discord for the changes to take effect.`;if(t.length===1&&t[0]==="connect-src")return{message:i,detail:o};let a=t.filter(s=>s!=="connect-src").map(s=>{switch(s){case"img-src":return"Images";case"style-src":return"CSS & Themes";case"font-src":return"Fonts";default:throw new Error(`Illegal CSP directive: ${s}`)}}).sort().join(", ");return o=`The following types of content will be allowed to load from ${n}:
${a}

${o}`,{message:i,detail:o}}async function Ni(e,t,r,n){if(!Mi(t,r))return"invalid";let i=new URL(t).host;if(i in se.store.customCspRules)return"conflict";let{checkboxChecked:o,response:a}=await Ie.dialog.showMessageBox({...Bi(t,r,n),type:n?"info":"warning",title:"Vencord Host Permissions",buttons:["Cancel","Allow"],defaultId:0,cancelId:0,checkboxLabel:`I fully trust ${i} and understand the risks of allowing connections to it.`,checkboxChecked:!1});return a!==1?"cancelled":o?(se.store.customCspRules[i]=r,"ok"):"unchecked"}function zi(e,t){return t in se.store.customCspRules?(delete se.store.customCspRules[t],!0):!1}function Vi(e,t,r){try{let n=new URL(t).host,i=Ft[n]??se.store.customCspRules[n];return i?r.every(o=>i.includes(o)):!1}catch{return!1}}f();var Gi=/[^\S\r\n]*?\r?(?:\r\n|\n)[^\S\r\n]*?\*[^\S\r\n]?/,Wi=/^\\@/;function sr(e,t={}){return{fileName:e,name:t.name??e.replace(/\.css$/i,""),author:t.author??"Unknown Author",description:t.description??"A Discord Theme.",version:t.version,license:t.license,source:t.source,website:t.website,invite:t.invite}}function wn(e){return e.charCodeAt(0)===65279&&(e=e.slice(1)),e}function bn(e,t){if(!e)return sr(t);let r=e.split("/**",2)?.[1]?.split("*/",1)?.[0];if(!r)return sr(t);let n={},i="",o="";for(let a of r.split(Gi))if(a.length!==0)if(a.charAt(0)==="@"&&a.charAt(1)!==" "){n[i]=o.trim();let s=a.indexOf(" ");i=a.substring(1,s),o=a.substring(s+1)}else o+=" "+a.replace("\\n",`
`).replace(Wi,"@");return n[i]=o.trim(),delete n[""],sr(t,n)}Pe();f();var Tn=require("electron");function En(e){e.webContents.setWindowOpenHandler(({url:t})=>{switch(t){case"about:blank":case"https://discord.com/popout":case"https://ptb.discord.com/popout":case"https://canary.discord.com/popout":return{action:"allow"}}try{var{protocol:r}=new URL(t)}catch{return{action:"deny"}}switch(r){case"http:":case"https:":case"mailto:":case"steam:":case"spotify:":Tn.shell.openExternal(t)}return{action:"deny"}})}var Hi=(0,we.join)(__dirname,"renderer.css");(0,he.mkdirSync)(ye,{recursive:!0});yn();function ar(e,t){let r=(0,we.normalize)(e+"/"),n=(0,we.join)(e,t),i=(0,we.normalize)(n);return i.startsWith(r)?i:null}function xn(){return(0,be.readFile)(De,"utf-8").catch(()=>"")}async function Zi(){let e=await(0,be.readdir)(ye).catch(()=>[]),t=[];for(let r of e){if(!r.endsWith(".css"))continue;let n=await Sn(r).then(wn).catch(()=>null);n!=null&&t.push(bn(n,r))}return t}function Sn(e){e=e.replace(/\?v=\d+$/,"");let t=ar(ye,e);return t?(0,be.readFile)(t,"utf-8"):Promise.reject(`Unsafe path ${e}`)}O.ipcMain.handle("VencordOpenQuickCss",()=>O.shell.openPath(De));O.ipcMain.handle("VencordOpenExternal",(e,t)=>{try{var{protocol:r}=new URL(t)}catch{throw"Malformed URL"}if(!Cr.includes(r))throw"Disallowed protocol.";O.shell.openExternal(t)});O.ipcMain.handle("VencordGetQuickCss",()=>xn());O.ipcMain.handle("VencordSetQuickCss",(e,t)=>(0,he.writeFileSync)(De,t));O.ipcMain.handle("VencordGetThemesList",()=>Zi());O.ipcMain.handle("VencordGetThemeData",(e,t)=>Sn(t));O.ipcMain.handle("VencordGetThemeSystemValues",()=>{let e=O.systemPreferences.getAccentColor?.()??"";return e.length&&e[0]!=="#"&&(e=`#${e}`),{"os-accent-color":e}});O.ipcMain.handle("VencordOpenThemesFolder",()=>O.shell.openPath(ye));O.ipcMain.handle("VencordOpenSettingsFolder",()=>O.shell.openPath(Ee));O.ipcMain.handle("VencordInitFileWatchers",({sender:e})=>{let t,r;(0,be.open)(De,"a+").then(i=>{i.close(),t=(0,he.watch)(De,{persistent:!1},or(async()=>{e.postMessage("VencordQuickCssUpdate",await xn())},50))}).catch(()=>{});let n=(0,he.watch)(ye,{persistent:!1},or(()=>{e.postMessage("VencordThemeUpdate",void 0)}));e.once("destroyed",()=>{t?.close(),n.close(),r?.close()})});O.ipcMain.on("VencordGetMonacoTheme",e=>{e.returnValue=O.nativeTheme.shouldUseDarkColors?"vs-dark":"vs-light"});O.ipcMain.handle("VencordOpenMonacoEditor",async()=>{let e="Vencord QuickCSS Editor",t=O.BrowserWindow.getAllWindows().find(n=>n.title===e);if(t&&!t.isDestroyed()){t.focus();return}let r=new O.BrowserWindow({title:e,autoHideMenuBar:!0,darkTheme:!0,webPreferences:{preload:(0,we.join)(__dirname,"preload.js"),contextIsolation:!0,nodeIntegration:!1,sandbox:!1}});En(r),await r.loadURL(`data:text/html;base64,${vn}`)});O.ipcMain.handle("VencordGetRendererCss",()=>(0,be.readFile)(Hi,"utf-8"));O.ipcMain.on("VencordPreloadGetRendererJs",e=>{e.returnValue=(0,he.readFileSync)((0,we.join)(__dirname,"renderer.js"),"utf-8")});fe();Pe();f();var Wn=require("electron");f();var Fn=require("module"),qi=(0,Fn.createRequire)("/"),ft,ji=";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global";try{ft=qi("worker_threads").Worker}catch{}var Ji=ft?function(e,t,r,n,i){var o=!1,a=new ft(e+ji,{eval:!0}).on("error",function(s){return i(s,null)}).on("message",function(s){return i(null,s)}).on("exit",function(s){s&&!o&&i(new Error("exited with code "+s),null)});return a.postMessage(r,n),a.terminate=function(){return o=!0,ft.prototype.terminate.call(a)},a}:function(e,t,r,n,i){setImmediate(function(){return i(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var o=function(){};return{terminate:o,postMessage:o}},Y=Uint8Array,Ue=Uint16Array,Cn=Int32Array,ur=new Y([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fr=new Y([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Dn=new Y([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Pn=function(e,t){for(var r=new Ue(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];for(var i=new Cn(r[30]),n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)i[o]=o-r[n]<<5|n;return{b:r,r:i}},Ln=Pn(ur,2),dr=Ln.b,Yi=Ln.r;dr[28]=258,Yi[258]=28;var kn=Pn(fr,0),An=kn.b,sa=kn.r,ht=new Ue(32768);for(I=0;I<32768;++I)ge=(I&43690)>>1|(I&21845)<<1,ge=(ge&52428)>>2|(ge&13107)<<2,ge=(ge&61680)>>4|(ge&3855)<<4,ht[I]=((ge&65280)>>8|(ge&255)<<8)>>1;var ge,I,$e=(function(e,t,r){for(var n=e.length,i=0,o=new Ue(t);i<n;++i)e[i]&&++o[e[i]-1];var a=new Ue(t);for(i=1;i<t;++i)a[i]=a[i-1]+o[i-1]<<1;var s;if(r){s=new Ue(1<<t);var l=15-t;for(i=0;i<n;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],m=a[e[i]-1]++<<u,E=m|(1<<u)-1;m<=E;++m)s[ht[m]>>l]=c}else for(s=new Ue(n),i=0;i<n;++i)e[i]&&(s[i]=ht[a[e[i]-1]++]>>15-e[i]);return s}),qe=new Y(288);for(I=0;I<144;++I)qe[I]=8;var I;for(I=144;I<256;++I)qe[I]=9;var I;for(I=256;I<280;++I)qe[I]=7;var I;for(I=280;I<288;++I)qe[I]=8;var I,In=new Y(32);for(I=0;I<32;++I)In[I]=5;var I;var $n=$e(qe,9,1);var _n=$e(In,5,1),dt=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},ee=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(t&7)&r},pt=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(t&7)},On=function(e){return(e+7)/8|0},gt=function(e,t,r){return(t==null||t<0)&&(t=0),(r==null||r>e.length)&&(r=e.length),new Y(e.subarray(t,r))};var Mn=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],J=function(e,t,r){var n=new Error(t||Mn[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,J),!r)throw n;return n},Bn=function(e,t,r,n){var i=e.length,o=n?n.length:0;if(!i||t.f&&!t.l)return r||new Y(0);var a=!r,s=a||t.i!=2,l=t.i;a&&(r=new Y(i*3));var c=function(br){var Tr=r.length;if(br>Tr){var Er=new Y(Math.max(Tr*2,br));Er.set(r),r=Er}},u=t.f||0,m=t.p||0,E=t.b||0,U=t.l,P=t.d,D=t.m,A=t.n,k=i*8;do{if(!U){u=ee(e,m,1);var p=ee(e,m+1,3);if(m+=3,p)if(p==1)U=$n,P=_n,D=9,A=5;else if(p==2){var y=ee(e,m,31)+257,L=ee(e,m+10,15)+4,w=y+ee(e,m+5,31)+1;m+=14;for(var v=new Y(w),b=new Y(19),h=0;h<L;++h)b[Dn[h]]=ee(e,m+h*3,7);m+=L*3;for(var R=dt(b),G=(1<<R)-1,M=$e(b,R,1),h=0;h<w;){var Oe=M[ee(e,m,G)];m+=Oe&15;var x=Oe>>4;if(x<16)v[h++]=x;else{var re=0,S=0;for(x==16?(S=3+ee(e,m,3),m+=2,re=v[h-1]):x==17?(S=3+ee(e,m,7),m+=3):x==18&&(S=11+ee(e,m,127),m+=7);S--;)v[h++]=re}}var _=v.subarray(0,y),B=v.subarray(y);D=dt(_),A=dt(B),U=$e(_,D,1),P=$e(B,A,1)}else J(1);else{var x=On(m)+4,T=e[x-4]|e[x-3]<<8,d=x+T;if(d>i){l&&J(0);break}s&&c(E+T),r.set(e.subarray(x,d),E),t.b=E+=T,t.p=m=d*8,t.f=u;continue}if(m>k){l&&J(0);break}}s&&c(E+131072);for(var V=(1<<D)-1,mr=(1<<A)-1,mt=m;;mt=m){var re=U[pt(e,m)&V],Fe=re>>4;if(m+=re&15,m>k){l&&J(0);break}if(re||J(2),Fe<256)r[E++]=Fe;else if(Fe==256){mt=m,U=null;break}else{var vr=Fe-254;if(Fe>264){var h=Fe-257,Me=ur[h];vr=ee(e,m,(1<<Me)-1)+dr[h],m+=Me}var vt=P[pt(e,m)&mr],yt=vt>>4;vt||J(3),m+=vt&15;var B=An[yt];if(yt>3){var Me=fr[yt];B+=pt(e,m)&(1<<Me)-1,m+=Me}if(m>k){l&&J(0);break}s&&c(E+131072);var yr=E+vr;if(E<B){var wr=o-B,Qn=Math.min(B,yr);for(wr+E<0&&J(3);E<Qn;++E)r[E]=n[wr+E]}for(;E<yr;++E)r[E]=r[E-B]}}t.l=U,t.p=mt,t.b=E,t.f=u,U&&(u=1,t.m=D,t.d=P,t.n=A)}while(!u);return E!=r.length&&a?gt(r,0,E):r.subarray(0,E)};var Ki=new Y(0);var Xi=function(e,t){var r={};for(var n in e)r[n]=e[n];for(var n in t)r[n]=t[n];return r},Un=function(e,t,r){for(var n=e(),i=e.toString(),o=i.slice(i.indexOf("[")+1,i.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<n.length;++a){var s=n[a],l=o[a];if(typeof s=="function"){t+=";"+l+"=";var c=s.toString();if(s.prototype)if(c.indexOf("[native code]")!=-1){var u=c.indexOf(" ",8)+1;t+=c.slice(u,c.indexOf("(",u))}else{t+=c;for(var m in s.prototype)t+=";"+l+".prototype."+m+"="+s.prototype[m].toString()}else t+=c}else r[l]=s}return t},ut=[],Qi=function(e){var t=[];for(var r in e)e[r].buffer&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t},eo=function(e,t,r,n){if(!ut[r]){for(var i="",o={},a=e.length-1,s=0;s<a;++s)i=Un(e[s],i,o);ut[r]={c:Un(e[a],i,o),e:o}}var l=Xi({},ut[r].e);return Ji(ut[r].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,l,Qi(l),n)},to=function(){return[Y,Ue,Cn,ur,fr,Dn,dr,An,$n,_n,ht,Mn,$e,dt,ee,pt,On,gt,J,Bn,pr,Nn,zn]};var Nn=function(e){return postMessage(e,[e.buffer])},zn=function(e){return e&&{out:e.size&&new Y(e.size),dictionary:e.dictionary}},ro=function(e,t,r,n,i,o){var a=eo(r,n,i,function(s,l){a.terminate(),o(s,l)});return a.postMessage([e,t],t.consume?[e.buffer]:[]),function(){a.terminate()}};var le=function(e,t){return e[t]|e[t+1]<<8},oe=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},lr=function(e,t){return oe(e,t)+oe(e,t+4)*4294967296};function no(e,t,r){return r||(r=t,t={}),typeof r!="function"&&J(7),ro(e,t,[to],function(n){return Nn(pr(n.data[0],zn(n.data[1])))},1,r)}function pr(e,t){return Bn(e,{i:2},t&&t.out,t&&t.dictionary)}var cr=typeof TextDecoder<"u"&&new TextDecoder,io=0;try{cr.decode(Ki,{stream:!0}),io=1}catch{}var oo=function(e){for(var t="",r=0;;){var n=e[r++],i=(n>127)+(n>223)+(n>239);if(r+i>e.length)return{s:t,r:gt(e,r-1)};i?i==3?(n=((n&15)<<18|(e[r++]&63)<<12|(e[r++]&63)<<6|e[r++]&63)-65536,t+=String.fromCharCode(55296|n>>10,56320|n&1023)):i&1?t+=String.fromCharCode((n&31)<<6|e[r++]&63):t+=String.fromCharCode((n&15)<<12|(e[r++]&63)<<6|e[r++]&63):t+=String.fromCharCode(n)}};function so(e,t){if(t){for(var r="",n=0;n<e.length;n+=16384)r+=String.fromCharCode.apply(null,e.subarray(n,n+16384));return r}else{if(cr)return cr.decode(e);var i=oo(e),o=i.s,r=i.r;return r.length&&J(8),o}}var ao=function(e,t){return t+30+le(e,t+26)+le(e,t+28)},lo=function(e,t,r){var n=le(e,t+28),i=so(e.subarray(t+46,t+46+n),!(le(e,t+8)&2048)),o=t+46+n,a=oe(e,t+20),s=r&&a==4294967295?co(e,o):[a,oe(e,t+24),oe(e,t+42)],l=s[0],c=s[1],u=s[2];return[le(e,t+10),l,c,i,o+le(e,t+30)+le(e,t+32),u]},co=function(e,t){for(;le(e,t)!=1;t+=4+le(e,t+2));return[lr(e,t+12),lr(e,t+4),lr(e,t+20)]};var Rn=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(e){e()};function Vn(e,t,r){r||(r=t,t={}),typeof r!="function"&&J(7);var n=[],i=function(){for(var A=0;A<n.length;++A)n[A]()},o={},a=function(A,k){Rn(function(){r(A,k)})};Rn(function(){a=r});for(var s=e.length-22;oe(e,s)!=101010256;--s)if(!s||e.length-s>65558)return a(J(13,0,1),null),i;var l=le(e,s+8);if(l){var c=l,u=oe(e,s+16),m=u==4294967295||c==65535;if(m){var E=oe(e,s-12);m=oe(e,E)==101075792,m&&(c=l=oe(e,E+32),u=oe(e,E+48))}for(var U=t&&t.filter,P=function(A){var k=lo(e,u,m),p=k[0],x=k[1],T=k[2],d=k[3],y=k[4],L=k[5],w=ao(e,L);u=y;var v=function(h,R){h?(i(),a(h,null)):(R&&(o[d]=R),--l||a(null,o))};if(!U||U({name:d,size:x,originalSize:T,compression:p}))if(!p)v(null,gt(e,w,w+x));else if(p==8){var b=e.subarray(w,w+x);if(T<524288||x>.8*T)try{v(null,pr(b,{out:new Y(T)}))}catch(h){v(h,null)}else n.push(no(b,{size:T},v))}else v(J(14,"unknown compression type "+p,1),null);else v(null,null)},D=0;D<c;++D)P(D)}else a(null,{});return i}var Hn=require("fs"),ce=require("fs/promises"),_e=require("path");Pe();f();function Gn(e){function t(a,s,l,c){let u=0;return u+=a<<0,u+=s<<8,u+=l<<16,u+=c<<24>>>0,u}if(e[0]===80&&e[1]===75&&e[2]===3&&e[3]===4)return e;if(e[0]!==67||e[1]!==114||e[2]!==50||e[3]!==52)throw new Error("Invalid header: Does not start with Cr24");let r=e[4]===3,n=e[4]===2;if(!n&&!r||e[5]||e[6]||e[7])throw new Error("Unexpected crx format version number.");if(n){let a=t(e[8],e[9],e[10],e[11]),s=t(e[12],e[13],e[14],e[15]),l=16+a+s;return e.subarray(l,e.length)}let o=12+t(e[8],e[9],e[10],e[11]);return e.subarray(o,e.length)}Ct();var uo=(0,_e.join)(Je,"ExtensionCache");async function fo(e,t){return await(0,ce.mkdir)(t,{recursive:!0}),new Promise((r,n)=>{Vn(e,(i,o)=>{if(i)return void n(i);Promise.all(Object.keys(o).map(async a=>{if(a.startsWith("_metadata/"))return;if(a.endsWith("/"))return void(0,ce.mkdir)((0,_e.join)(t,a),{recursive:!0});let s=a.split("/"),l=s.pop(),c=s.join("/"),u=(0,_e.join)(t,c);c&&await(0,ce.mkdir)(u,{recursive:!0}),await(0,ce.writeFile)((0,_e.join)(u,l),o[a])})).then(()=>r()).catch(a=>{(0,ce.rm)(t,{recursive:!0,force:!0}),n(a)})})})}async function Zn(e){let t=(0,_e.join)(uo,`${e}`);try{await(0,ce.access)(t,Hn.constants.F_OK)}catch{let n=`https://clients2.google.com/service/update2/crx?response=redirect&acceptformat=crx2,crx3&x=id%3D${e}%26uc&prodversion=${process.versions.chrome}`,i=await Xe(n,{headers:{"User-Agent":`Electron ${process.versions.electron} ~ Vencord (https://github.com/Vendicated/Vencord)`}});await fo(Gn(i),t).catch(o=>console.error(`Failed to extract extension ${e}`,o))}Wn.session.defaultSession.loadExtension(t)}Ye||Re.app.whenReady().then(()=>{Re.protocol.handle("vencord",({url:e})=>{let t=decodeURI(e).slice(10).replace(/\?v=\d+$/,"");if(t.endsWith("/")&&(t=t.slice(0,-1)),t.startsWith("/themes/")){let r=t.slice(8),n=ar(ye,r);return n?Re.net.fetch((0,gr.pathToFileURL)(n).toString()):new Response(null,{status:404})}switch(t){case"renderer.js.map":case"vencordDesktopRenderer.js.map":case"preload.js.map":case"vencordDesktopPreload.js.map":case"patcher.js.map":case"vencordDesktopMain.js.map":return Re.net.fetch((0,gr.pathToFileURL)((0,Xn.join)(__dirname,t)).toString());default:return new Response(null,{status:404})}});try{j.store.enableReactDevtools&&Zn("fmkadmapgofadopljbjfkapdkoienihi").then(()=>console.info("[Vencord] Installed React Developer Tools")).catch(e=>console.error("[Vencord] Failed to install React Developer Tools",e))}catch{}Ar()});Kn();
//# sourceURL=file:///VencordPatcher
//# sourceMappingURL=vencord://patcher.js.map
/*! For license information please see patcher.js.LEGAL.txt */
