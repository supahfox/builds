// Vencord 2aa7f56
// Standalone: true
// Platform: Universal
// Updater Disabled: false
"use strict";var $n=Object.create;var Ve=Object.defineProperty;var _n=Object.getOwnPropertyDescriptor;var On=Object.getOwnPropertyNames;var Mn=Object.getPrototypeOf,zn=Object.prototype.hasOwnProperty;var ue=(t,e)=>()=>(t&&(e=t(t=0)),e);var se=(t,e)=>{for(var r in e)Ve(t,r,{get:e[r],enumerable:!0})},dr=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of On(e))!zn.call(t,o)&&o!==r&&Ve(t,o,{get:()=>e[o],enumerable:!(n=_n(e,o))||n.enumerable});return t};var xe=(t,e,r)=>(r=t!=null?$n(Mn(t)):{},dr(e||!t||!t.__esModule?Ve(r,"default",{value:t,enumerable:!0}):r,t)),Bn=t=>dr(Ve({},"__esModule",{value:!0}),t);var f=ue(()=>{"use strict"});var be=ue(()=>{"use strict";f()});async function Er(t,e){try{var r=await fetch(t,e)}catch(o){throw o instanceof Error&&o.cause&&(o=o.cause),new Error(`${e?.method??"GET"} ${t} failed: ${o}`)}if(r.ok)return r;let n=`${e?.method??"GET"} ${t}: ${r.status} ${r.statusText}`;try{let o=await r.text();n+=`
${o}`}catch{}throw new Error(n)}async function xr(t,e){return(await Er(t,e)).json()}async function He(t,e){let n=await(await Er(t,e)).arrayBuffer();return Buffer.from(n)}var Hn,yt=ue(()=>{"use strict";f();Hn=require("original-fs")});var ke,wt=ue(()=>{f();ke="2aa7f56"});var Re,Tt=ue(()=>{f();Re="supahfox/Vencord"});var Ze,Et=ue(()=>{"use strict";f();wt();Tt();Ze=`Vencord/${ke}${Re?` (https://github.com/${Re})`:""}`});function $e(t){return async function(){try{return{ok:!0,value:await t(...arguments)}}catch(e){return{ok:!1,error:e instanceof Error?{...e,message:e.message,name:e.name,stack:e.stack}:e}}}}var br,Ur=ue(()=>{"use strict";f();br=["vencordDesktopMain.js","vencordDesktopPreload.js","vencordDesktopRenderer.js","vencordDesktopRenderer.css"]});var Yn={};async function Cr(t){return xr(Zn+t,{headers:{Accept:"application/vnd.github+json","User-Agent":Ze}})}async function qn(){return await Fr()?(await Cr(`/compare/${ke}...HEAD`)).commits.map(r=>({hash:r.sha.slice(0,7),author:r.author.login,message:r.commit.message.split(`
`)[0]})):[]}async function Fr(){let t=await Cr("/releases/latest");return t.name.slice(t.name.lastIndexOf(" ")+1)===ke?!1:(t.assets.forEach(({name:r,browser_download_url:n})=>{br.some(o=>r.startsWith(o))&&xt.push([r,n])}),!0)}async function Jn(){let t=await Promise.all(xt.map(async([e,r])=>{let n=await He(r);return[(0,Rr.join)(__dirname,e),n]}));return await Promise.all(t.map(async([e,r])=>(0,Sr.writeFile)(e,r))),xt=[],!0}var _e,Sr,Rr,Zn,xt,Dr=ue(()=>{"use strict";f();yt();be();Et();_e=require("electron"),Sr=require("fs/promises"),Rr=require("path");wt();Tt();Ur();Zn=`https://api.github.com/repos/${Re}`,xt=[];_e.ipcMain.handle("VencordGetRepo",$e(()=>`https://github.com/${Re}`));_e.ipcMain.handle("VencordGetUpdates",$e(qn));_e.ipcMain.handle("VencordUpdate",$e(Fr));_e.ipcMain.handle("VencordBuild",$e(Jn))});f();var Te=require("electron"),An=require("path"),or=require("url");f();f();be();f();var ut=Symbol("SettingsStore.isProxy"),pr=Symbol("SettingsStore.getRawTarget"),Ae=class{pathListeners=new Map;prefixListeners=new Map;globalListeners=new Set;proxyContexts=new WeakMap;proxyHandler=(()=>{let e=this;return{get(r,n,o){if(n===ut)return!0;if(n===pr)return r;let i=Reflect.get(r,n,o),a=e.proxyContexts.get(r);if(a==null)return i;let{root:s,path:l}=a;if(!(n in r)&&e.getDefaultValue!=null&&(i=e.getDefaultValue({target:r,key:n,root:s,path:l})),typeof i=="object"&&i!==null&&!i[ut]){let c=`${l}${l&&"."}${n}`;return e.makeProxy(i,s,c)}return i},set(r,n,o){if(o?.[ut]&&(o=o[pr]),r[n]===o)return!0;if(!Reflect.set(r,n,o))return!1;let i=e.proxyContexts.get(r);if(i==null)return!0;let{root:a,path:s}=i,l=`${s}${s&&"."}${n}`;return e.notifyListeners(l,o,a),!0},deleteProperty(r,n){if(!Reflect.deleteProperty(r,n))return!1;let o=e.proxyContexts.get(r);if(o==null)return!0;let{root:i,path:a}=o,s=`${a}${a&&"."}${n}`;return e.notifyListeners(s,void 0,i),!0}}})();constructor(e,r={}){this.plain=e,this.store=this.makeProxy(e),Object.assign(this,r)}makeProxy(e,r=e,n=""){return this.proxyContexts.set(e,{root:r,path:n}),new Proxy(e,this.proxyHandler)}notifyPrefixListeners(e,r,n){for(let o=1;o<=r.length;o++){let i=r.slice(0,o).join(".");this.prefixListeners.get(i)?.forEach(a=>a(n,e))}}notifyListeners(e,r,n){let o=e.split(".");if(o.length>3&&o[0]==="plugins"){let i=o.slice(0,3),a=i.join("."),s=i.reduce((l,c)=>l[c],n);this.globalListeners.forEach(l=>l(n,a)),this.pathListeners.get(a)?.forEach(l=>l(s))}else this.globalListeners.forEach(i=>i(n,e));this.pathListeners.get(e)?.forEach(i=>i(r)),this.notifyPrefixListeners(e,o,r)}setData(e,r){if(this.readOnly)throw new Error("SettingsStore is read-only");if(this.plain=e,this.store=this.makeProxy(e),r){let n=e,o=r.split(".");for(let i of o){if(!n){console.warn(`Settings#setData: Path ${r} does not exist in new data. Not dispatching update`);return}n=n[i]}this.pathListeners.get(r)?.forEach(i=>i(n)),this.notifyPrefixListeners(r,o,n)}this.markAsChanged()}addGlobalChangeListener(e){this.globalListeners.add(e)}addChangeListener(e,r){let n=this.pathListeners.get(e)??new Set;n.add(r),this.pathListeners.set(e,n)}addPrefixChangeListener(e,r){let n=this.prefixListeners.get(e)??new Set;n.add(r),this.prefixListeners.set(e,n)}removeGlobalChangeListener(e){this.globalListeners.delete(e)}removeChangeListener(e,r){let n=this.pathListeners.get(e);n&&(n.delete(r),n.size||this.pathListeners.delete(e))}removePrefixChangeListener(e,r){let n=this.prefixListeners.get(e);n&&(n.delete(r),n.size||this.prefixListeners.delete(e))}markAsChanged(){this.globalListeners.forEach(e=>e(this.plain,""))}};f();function ft(t,e){for(let r in e){let n=e[r];typeof n=="object"&&!Array.isArray(n)?(t[r]??={},ft(t[r],n)):t[r]??=n}return t}var ht=require("electron"),ge=require("fs");f();var hr=require("electron"),fe=require("path"),Ge=process.env.VENCORD_USER_DATA_DIR??(process.env.DISCORD_USER_DATA_DIR?(0,fe.join)(process.env.DISCORD_USER_DATA_DIR,"..","VencordData"):(0,fe.join)(hr.app.getPath("userData"),"..","Vencord")),he=(0,fe.join)(Ge,"settings"),de=(0,fe.join)(Ge,"themes"),Ue=(0,fe.join)(he,"quickCss.css"),dt=(0,fe.join)(he,"settings.json"),pt=(0,fe.join)(he,"native-settings.json"),gr=["https:","http:","steam:","spotify:","com.epicgames.launcher:","tidal:","itunes:"];(0,ge.mkdirSync)(he,{recursive:!0});function mr(t,e){try{return JSON.parse((0,ge.readFileSync)(e,"utf-8"))}catch(r){return r?.code!=="ENOENT"&&console.error(`Failed to read ${t} settings`,r),{}}}var Y=new Ae(mr("renderer",dt));Y.addGlobalChangeListener(()=>{try{(0,ge.writeFileSync)(dt,JSON.stringify(Y.plain,null,4))}catch(t){console.error("Failed to write renderer settings",t)}});ht.ipcMain.on("VencordGetSettings",t=>t.returnValue=Y.plain);ht.ipcMain.handle("VencordSetSettings",(t,e,r)=>{Y.setData(e,r)});var Nn={plugins:{},customCspRules:{}},vr=mr("native",pt);ft(vr,Nn);var re=new Ae(vr);re.addGlobalChangeListener(()=>{try{(0,ge.writeFileSync)(pt,JSON.stringify(re.plain,null,4))}catch(t){console.error("Failed to write native settings",t)}});var gt=require("electron"),Se=["connect-src"],j=[...Se,"img-src"],wr=["style-src","font-src"],G=[...j,...wr],yr=[...G,"script-src","worker-src"],vt={"http://localhost:*":G,"http://127.0.0.1:*":G,"localhost:*":G,"127.0.0.1:*":G,"*.github.io":G,"github.com":G,"raw.githubusercontent.com":G,"*.gitlab.io":G,"gitlab.com":G,"*.codeberg.page":G,"codeberg.org":G,"*.githack.com":G,"jsdelivr.net":G,"fonts.googleapis.com":wr,"i.imgur.com":j,"i.ibb.co":j,"i.pinimg.com":j,"*.tenor.com":j,"files.catbox.moe":G,"cdn.discordapp.com":G,"media.discordapp.net":j,"cdnjs.cloudflare.com":yr,"cdn.jsdelivr.net":yr,"api.github.com":Se,"ws.audioscrobbler.com":Se,"translate-pa.googleapis.com":Se,"*.vencord.dev":j,"manti.vendicated.dev":j,"decor.fieryflames.dev":Se,"ugc.decor.fieryflames.dev":j,"sponsor.ajay.app":Se,"dearrow-thumb.ajay.app":j,"usrbg.is-hardly.online":j,"icons.duckduckgo.com":j},mt=(t,e)=>Object.keys(t).find(r=>r.toLowerCase()===e),Vn=t=>{let e={};return t.split(";").forEach(r=>{let[n,...o]=r.trim().split(/\s+/g);n&&!Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=o)}),e},Gn=t=>Object.entries(t).filter(([,e])=>e?.length).map(e=>e.flat().join(" ")).join("; "),Wn=t=>{let e=mt(t,"content-security-policy-report-only");e&&delete t[e];let r=mt(t,"content-security-policy");if(r){let n=Vn(t[r][0]),o=(i,...a)=>{n[i]??=[...n["default-src"]??[]],n[i].push(...a)};o("style-src","'unsafe-inline'"),o("script-src","'unsafe-inline'","'unsafe-eval'");for(let i of["style-src","connect-src","img-src","font-src","media-src","worker-src"])o(i,"blob:","data:","vencord:","vesktop:");for(let[i,a]of Object.entries(re.store.customCspRules))for(let s of a)o(s,i);for(let[i,a]of Object.entries(vt))for(let s of a)o(s,i);t[r]=[Gn(n)]}};function Tr(){gt.session.defaultSession.webRequest.onHeadersReceived(({responseHeaders:t,resourceType:e},r)=>{if(t&&(e==="mainFrame"&&Wn(t),e==="stylesheet")){let n=mt(t,"content-type");n&&(t[n]=["text/css"])}r({cancel:!1,responseHeaders:t})}),gt.session.defaultSession.webRequest.onHeadersReceived=()=>{}}f();f();Dr();f();be();var Jt=require("electron");f();var Ut={};se(Ut,{fetchTrackData:()=>Kn});f();Et();var Lr=require("child_process"),Pr=require("util"),Ir=(0,Pr.promisify)(Lr.execFile);async function bt(t){let{stdout:e}=await Ir("osascript",t.map(r=>["-e",r]).flat());return e}var Q=null;async function jn({id:t,name:e,artist:r,album:n}){if(t===Q?.id){if("data"in Q)return Q.data;if("failures"in Q&&Q.failures>=5)return null}try{let o=new URL("https://itunes.apple.com/search");o.searchParams.set("term",`${e} ${r} ${n}`),o.searchParams.set("media","music"),o.searchParams.set("entity","song");let i=await fetch(o,{headers:{"user-agent":Ze}}).then(s=>s.json()).then(s=>s.results.find(l=>l.collectionName===n)||s.results[0]),a=await fetch(i.artistViewUrl).then(s=>s.text()).then(s=>{let l=s.match(/<meta property="og:image" content="(.+?)">/);return l?l[1].replace(/[0-9]+x.+/,"220x220bb-60.png"):void 0}).catch(()=>{});return Q={id:t,data:{appleMusicLink:i.trackViewUrl,songLink:`https://song.link/i/${new URL(i.trackViewUrl).searchParams.get("i")}`,albumArtwork:i.artworkUrl100.replace("100x100","512x512"),artistArtwork:a}},Q.data}catch(o){return console.error("[AppleMusicRichPresence] Failed to fetch remote data:",o),Q={id:t,failures:(t===Q?.id&&"failures"in Q?Q.failures:0)+1},null}}async function Kn(){try{await Ir("pgrep",["^Music$"])}catch{return null}if(await bt(['tell application "Music"',"get player state","end tell"]).then(p=>p.trim())!=="playing")return null;let e=await bt(['tell application "Music"',"get player position","end tell"]).then(p=>Number.parseFloat(p.trim())),r=await bt(['set output to ""','tell application "Music"',"set t_id to database id of current track","set t_name to name of current track","set t_album to album of current track","set t_artist to artist of current track","set t_duration to duration of current track",'set output to "" & t_id & "\\n" & t_name & "\\n" & t_album & "\\n" & t_artist & "\\n" & t_duration',"end tell","return output"]),[n,o,i,a,s]=r.split(`
`).filter(p=>!!p),l=Number.parseFloat(s),c=await jn({id:n,name:o,artist:a,album:i});return{name:o,album:i,artist:a,playerPosition:e,duration:l,...c}}var St={};se(St,{initDevtoolsOpenEagerLoad:()=>Xn});f();function Xn(t){let e=()=>t.sender.executeJavaScript("Vencord.Plugins.plugins.ConsoleShortcuts.eagerLoad(true)");t.sender.isDevToolsOpened()?e():t.sender.once("devtools-opened",()=>e())}var kr={};f();var Je=require("electron"),qe=[];function Ar(){let t=[];for(let e=qe.length-1;e>=0;e--){let{processId:r,routingId:n}=qe[e],o=Je.webFrameMain.fromId(r,n);if(!o){qe.splice(e,1);continue}t.push(o)}return t}Je.app.on("browser-window-created",(t,e)=>{e.webContents.on("frame-created",(r,{frame:n})=>{n?.once("dom-ready",()=>{if(n.url.startsWith("https://open.spotify.com/embed/")){Ar();let{routingId:o,processId:i}=n;qe.push({routingId:o,processId:i});let a=Y.store.plugins?.FixSpotifyEmbeds;if(!a?.enabled)return;n.executeJavaScript(`
                    globalThis._vcVolume = ${a.volume/100};
                    const original = Audio.prototype.play;
                    Audio.prototype.play = function() {
                        this.volume = _vcVolume;
                        return original.apply(this, arguments);
                    }
                `)}})}),Y.addChangeListener("plugins.FixSpotifyEmbeds.volume",r=>{try{Ar().forEach(n=>n.executeJavaScript(`globalThis._vcVolume = ${r/100}`))}catch(n){console.error("FixSpotifyEmbeds: Failed to update volume",n)}})});var _r={};f();var $r=require("electron");$r.app.on("browser-window-created",(t,e)=>{e.webContents.on("frame-created",(r,{frame:n})=>{n?.once("dom-ready",()=>{if(n.url.startsWith("https://www.youtube.com/")){if(!Y.store.plugins?.FixYoutubeEmbeds?.enabled)return;n.executeJavaScript(`
                new MutationObserver(() => {
                    if(
                        document.querySelector('div.ytp-error-content-wrap-subreason a[href*="www.youtube.com/watch?v="]')
                    ) location.reload()
                }).observe(document.body, { childList: true, subtree:true });
                `)}})})});var Rt={};se(Rt,{resolveRedirect:()=>eo});f();var Or=require("https"),Qn=/^https:\/\/(spotify\.link|s\.team)\/.+$/;function Mr(t){return new Promise((e,r)=>{let n=(0,Or.request)(new URL(t),{method:"HEAD"},o=>{e(o.headers.location?Mr(o.headers.location):t)});n.on("error",r),n.end()})}async function eo(t,e){return Qn.test(e)?Mr(e):e}var Ct={};se(Ct,{makeDeeplTranslateRequest:()=>to});f();async function to(t,e,r,n){let o=e?"https://api.deepl.com/v2/translate":"https://api-free.deepl.com/v2/translate";try{let i=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`DeepL-Auth-Key ${r}`},body:n}),a=await i.text();return{status:i.status,data:a}}catch(i){return{status:-1,data:String(i)}}}var Ft={};se(Ft,{readRecording:()=>ro});f();var zr=require("electron"),Ye=require("fs/promises"),Oe=require("path");async function ro(t,e){e=(0,Oe.normalize)(e);let r=(0,Oe.basename)(e),n=(0,Oe.normalize)(zr.app.getPath("userData")+"/");if(!/^\d*recording\.ogg$/.test(r)||!e.startsWith(n))return null;try{let o=await(0,Ye.readFile)(e);return(0,Ye.rm)(e).catch(()=>{}),new Uint8Array(o.buffer)}catch{return null}}var Dt={};se(Dt,{sendToOverlay:()=>no});f();var Nr=require("dgram"),Br;function no(t,e){e.messageType=e.type;let r=JSON.stringify(e);Br??=(0,Nr.createSocket)("udp4"),Br.send(r,42069,"127.0.0.1")}var Gr={};f();var Vr=require("electron");f();var Lt=`"use strict";const hiddenCSS=["#__ffYoutube1","#__ffYoutube2","#__ffYoutube3","#__ffYoutube4","#feed-pyv-container","#feedmodule-PRO","#homepage-chrome-side-promo","#merch-shelf","#offer-module",'#pla-shelf > ytd-pla-shelf-renderer[class="style-scope ytd-watch"]',"#pla-shelf","#premium-yva","#promo-info","#promo-list","#promotion-shelf","#related > ytd-watch-next-secondary-results-renderer > #items > ytd-compact-promoted-video-renderer.ytd-watch-next-secondary-results-renderer","#search-pva","#shelf-pyv-container","#video-masthead","#watch-branded-actions","#watch-buy-urls","#watch-channel-brand-div","#watch7-branded-banner","#YtKevlarVisibilityIdentifier","#YtSparklesVisibilityIdentifier",".carousel-offer-url-container",".companion-ad-container",".GoogleActiveViewElement",'.list-view[style="margin: 7px 0pt;"]',".promoted-sparkles-text-search-root-container",".promoted-videos",".searchView.list-view",".sparkles-light-cta",".watch-extra-info-column",".watch-extra-info-right",".ytd-carousel-ad-renderer",".ytd-compact-promoted-video-renderer",".ytd-companion-slot-renderer",".ytd-merch-shelf-renderer",".ytd-player-legacy-desktop-watch-ads-renderer",".ytd-promoted-sparkles-text-search-renderer",".ytd-promoted-video-renderer",".ytd-search-pyv-renderer",".ytd-video-masthead-ad-v3-renderer",".ytp-ad-action-interstitial-background-container",".ytp-ad-action-interstitial-slot",".ytp-ad-image-overlay",".ytp-ad-overlay-container",".ytp-ad-progress",".ytp-ad-progress-list",'[class*="ytd-display-ad-"]','[layout*="display-ad-"]','a[href^="http://www.youtube.com/cthru?"]','a[href^="https://www.youtube.com/cthru?"]',"ytd-action-companion-ad-renderer","ytd-banner-promo-renderer","ytd-compact-promoted-video-renderer","ytd-companion-slot-renderer","ytd-display-ad-renderer","ytd-promoted-sparkles-text-search-renderer","ytd-promoted-sparkles-web-renderer","ytd-search-pyv-renderer","ytd-single-option-survey-renderer","ytd-video-masthead-ad-advertiser-info-renderer","ytd-video-masthead-ad-v3-renderer","YTM-PROMOTED-VIDEO-RENDERER"],hideElements=()=>{const e=hiddenCSS;if(!e)return;const t=e.join(", ")+" { display: none!important; }",r=document.createElement("style");r.textContent=t,document.head.appendChild(r)},observeDomChanges=e=>{new MutationObserver(r=>{e(r)}).observe(document.documentElement,{childList:!0,subtree:!0})},hideDynamicAds=()=>{const e=document.querySelectorAll("#contents > ytd-rich-item-renderer ytd-display-ad-renderer");e.length!==0&&e.forEach(t=>{if(t.parentNode&&t.parentNode.parentNode){const r=t.parentNode.parentNode;r.localName==="ytd-rich-item-renderer"&&(r.style.display="none")}})},autoSkipAds=()=>{if(document.querySelector(".ad-showing")){const e=document.querySelector("video");e&&e.duration&&(e.currentTime=e.duration,setTimeout(()=>{const t=document.querySelector("button.ytp-ad-skip-button");t&&t.click()},100))}},overrideObject=(e,t,r)=>{if(!e)return!1;let n=!1;for(const o in e)e.hasOwnProperty(o)&&o===t?(e[o]=r,n=!0):e.hasOwnProperty(o)&&typeof e[o]=="object"&&overrideObject(e[o],t,r)&&(n=!0);return n},jsonOverride=(e,t)=>{const r=JSON.parse;JSON.parse=(...n)=>{const o=r.apply(this,n);return overrideObject(o,e,t),o},Response.prototype.json=new Proxy(Response.prototype.json,{async apply(...n){const o=await Reflect.apply(...n);return overrideObject(o,e,t),o}})};jsonOverride("adPlacements",[]),jsonOverride("playerAds",[]),hideElements(),hideDynamicAds(),autoSkipAds(),observeDomChanges(()=>{hideDynamicAds(),autoSkipAds()});
`;Vr.app.on("browser-window-created",(t,e)=>{e.webContents.on("frame-created",(r,{frame:n})=>{n?.once("dom-ready",()=>{Y.store.plugins?.YoutubeAdblock?.enabled&&(n.url.includes("youtube.com/embed/")?n.executeJavaScript(Lt):n.parent?.url.includes("youtube.com/embed/")&&n.parent.executeJavaScript(Lt))})})});var Ht={};se(Ht,{cancelUpload:()=>vo,clearProgress:()=>ze,getLatestProgress:()=>mo,getPendingNotifications:()=>go,pickAndUploadFile:()=>fo,uploadFileBuffer:()=>uo,uploadFileCustomNative:()=>Wt,uploadFileTo0x0StNative:()=>Gt,uploadFileToBuzzheavierNative:()=>Vt,uploadFileToCatboxNative:()=>Ot,uploadFileToFileIoNative:()=>co,uploadFileToFilebinNative:()=>Nt,uploadFileToGofileNative:()=>_t,uploadFileToLitterboxNative:()=>Mt,uploadFileToTempShNative:()=>zt,uploadFileToTmpFilesNative:()=>Bt,uploadFileToTransferShNative:()=>lo});f();var Ce=xe(require("crypto")),Be=require("electron"),N=xe(require("fs")),et=xe(require("http")),me=xe(require("https")),Jr=xe(require("os")),At=xe(require("path")),je={errors:0,info:1,debug:2},Pt="errors",kt=["Catbox","Litterbox","0x0.st"],Wr="GoFile",ae=1*1024*1024,Hr={none:10*1024*1024,basic:50*1024*1024,full:500*1024*1024};function $t(t){return t.toLowerCase().endsWith(".exe")}function Yr(t,e){return $t(t)&&kt.includes(e)?(m.info(`[BigFileUpload] ${e} doesn't support EXE files, using ${Wr} instead`),Wr):e}function jr(t){if(t==="localhost"||t==="localhost.localdomain")return!0;let e=t.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/);if(e){let[,r,n,o]=e.map(Number);if(r===127||r===10||r===172&&n>=16&&n<=31||r===192&&n===168||r===169&&n===254||r===0||r===255)return!0}return!!(t==="::1"||t==="[::1]"||t.startsWith("fe80:")||t.startsWith("[fe80:")||t.startsWith("fc")||t.startsWith("[fc")||t.startsWith("fd")||t.startsWith("[fd"))}function Kr(t){if(!t||typeof t!="string")return!1;try{let e=new URL(t);return e.protocol!=="http:"&&e.protocol!=="https:"?(m.warn(`[BigFileUpload] Invalid URL protocol: ${e.protocol}`),!1):!e.hostname||e.hostname.length<3?(m.warn(`[BigFileUpload] Invalid URL hostname: ${e.hostname}`),!1):jr(e.hostname)?(m.warn(`[BigFileUpload] Blocked private/reserved IP in URL: ${e.hostname}`),!1):/^\d+$/.test(e.hostname)?(m.warn(`[BigFileUpload] Blocked numeric-only hostname: ${e.hostname}`),!1):e.hostname.includes(".")?!0:(m.warn(`[BigFileUpload] Invalid hostname (no TLD): ${e.hostname}`),!1)}catch{return m.warn(`[BigFileUpload] Invalid URL format: ${t.substring(0,100)}`),!1}}var oo=new Set(["host","connection","upgrade","proxy-authorization","proxy-connection","te","trailer","transfer-encoding","keep-alive","expect","cookie","set-cookie","authorization","www-authenticate","x-forwarded-for","x-forwarded-host","x-forwarded-proto","x-real-ip","forwarded"]);function It(t){let e={};for(let[r,n]of Object.entries(t)){let o=r.toLowerCase().trim();if(oo.has(o)){m.warn(`[BigFileUpload] Blocked dangerous header: ${r}`);continue}!r||r.trim()===""||(typeof n=="string"&&!n.includes(`
`)&&!n.includes("\r")?e[r]=n:m.warn(`[BigFileUpload] Blocked header with invalid value: ${r}`))}return e}function Xe(t,e){if(!t||t.trim()==="")return e;try{return JSON.parse(t)}catch{return m.warn(`[BigFileUpload] Failed to parse JSON: ${t.substring(0,100)}`),e}}function Zr(t,e){let r=t;for(let n of e){if(r==null)return;let o=n.match(/^([^\[]+)\[(\d+)\]$/);if(o){let[,i,a]=o;if(i&&(r=r[i],r==null))return;r=r[parseInt(a,10)]}else/^\d+$/.test(n)&&Array.isArray(r)?r=r[parseInt(n,10)]:r=r[n]}return r}function io(t,e,r,n){let o=t.trim();if(e==="JSON"||e==="Text"&&o.startsWith("{")||o.startsWith("["))try{let s=JSON.parse(o);if(r.length>0){let c=Zr(s,r);if(typeof c=="string"&&c.length>0)return Ke(c,n)}let l=[["url"],["link"],["href"],["file"],["download"],["data","url"],["data","link"],["data","file"],["result","url"],["result","link"],["response","url"],["response","link"],["files","0","url"],["files","0","link"],["image","url"],["image","link"],["upload","url"],["upload","link"]];for(let c of l){let p=Zr(s,c);if(typeof p=="string"&&(p.startsWith("http")||p.startsWith("/")))return m.debug(`[BigFileUpload] Auto-detected URL at path: ${c.join(".")}`),Ke(p,n)}if(typeof s=="string"&&(s.startsWith("http")||s.startsWith("/")))return Ke(s,n);throw new Error("Could not find URL in JSON response. Try specifying a URL path.")}catch(s){if(e==="JSON")throw s}if(o.startsWith("http://")||o.startsWith("https://")){let s=o.split(/[\r\n]/)[0].trim();if(s.startsWith("http"))return s}let i=/https?:\/\/[^\s<>"')\]]+/gi,a=o.match(i);if(a&&a.length>0){let s=a.reduce((l,c)=>l.length>=c.length?l:c);return m.debug(`[BigFileUpload] Extracted URL from text response: ${s}`),s}return o.startsWith("/")&&n?Ke(o,n):o}function Ke(t,e){if(!t)return"";if(t.startsWith("http://")||t.startsWith("https://"))return t;if(e)try{let r=new URL(e);return t.startsWith("/")?`${r.protocol}//${r.host}${t}`:new URL(t,e).href}catch{}return t}var m={info:(...t)=>{je[Pt]>=je.info&&console.log(...t)},debug:(...t)=>{je[Pt]>=je.debug&&console.debug(...t)},warn:(...t)=>console.warn(...t),error:(...t)=>console.error(...t)};function Xr(t){Pt=t??"errors"}async function ee(t,e){let r=Jr.default.tmpdir(),o=`vencord-upload-${`${Date.now()}-${Ce.default.randomBytes(8).toString("hex")}`}-${e}`,i=At.default.join(r,o);return await N.default.promises.writeFile(i,Buffer.from(t)),i}async function qr(t){return t.length===0?null:new Promise(e=>{let r=!1,n=t.length;for(let o of t)o.then(i=>{!r&&i!==null?(r=!0,e(i)):(n--,n===0&&!r&&e(null))}).catch(()=>{n--,n===0&&!r&&e(null)})})}async function z(t){try{await N.default.promises.unlink(t),m.debug(`[BigFileUpload] Temp file deleted: ${t}`)}catch(e){let r=e instanceof Error?e.message:String(e);m.debug(`[BigFileUpload] Failed to delete temp file ${t}: ${r}`)}}async function so(){return"https://upload.gofile.io/uploadfile"}function Qr(t,e,r,n={},o,i,a=3e5){let s=!1;return new Promise((l,c)=>{let p=new URL(t),u=p.protocol==="https:",y=u?me.default:et.default;if(!N.default.existsSync(e)){c(new Error(`File not found: ${e}`));return}let C=N.default.statSync(e).size;if(C===0){c(new Error(`File is empty (0 bytes): ${e}`));return}try{N.default.accessSync(e,N.default.constants.R_OK)}catch{c(new Error(`File is not readable: ${e}`));return}let U={hostname:p.hostname,port:p.port||(u?443:80),path:p.pathname+p.search,method:"PUT",headers:{"Content-Type":"application/octet-stream","Content-Length":C,...n}};u&&(U.agent=new me.default.Agent({keepAlive:!0,timeout:3e4,rejectUnauthorized:!0}));let w=Date.now(),F=Date.now(),d=0,T=setInterval(()=>{Date.now()-F>3e5&&(clearInterval(T),g.destroy(),c(new Error("Upload stalled - no progress for 5 minutes")))},1e4),g=y.request(U,v=>{let b="",P=!1;v.socket.setTimeout(6e4),v.on("data",h=>{if(b.length+h.length>ae){P||(m.warn(`[BigFileUpload] Response exceeded ${ae} bytes, truncating`),P=!0);return}b+=h}),v.on("end",()=>{if(clearInterval(T),i&&J.delete(i),i&&W.has(i)){W.delete(i),c(new Error("Upload cancelled by user"));return}if(P){c(new Error(`Response exceeded maximum size (${ae} bytes) and was truncated. The upload may have succeeded but the response could not be processed.`));return}if(v.statusCode&&v.statusCode>=200&&v.statusCode<300)i&&W.delete(i),l(b);else{let h=`HTTP ${v.statusCode}: ${v.statusMessage}`;v.statusCode===500?h="HTTP 500: Server Internal Error - The upload service is experiencing issues. Try using a different uploader (temp.sh, Catbox, 0x0.st, or file.io).":v.statusCode===502||v.statusCode===503||v.statusCode===504?h=`HTTP ${v.statusCode}: Service Unavailable - The upload service is temporarily down or overloaded. Try using a different uploader.`:v.statusCode===429?h="HTTP 429: Rate Limited - Too many requests. Please wait before trying again.":v.statusCode===413&&(h="HTTP 413: File Too Large - The file exceeds the service's size limit."),b&&b.length>0&&b.length<500&&(h+=`
Server response: ${b}`),c(new Error(h))}})});g.setTimeout(a),g.on("timeout",()=>{clearInterval(T),i&&J.delete(i),g.destroy(),c(new Error("Request timeout - The server took too long to respond."))}),g.on("error",v=>{if(clearInterval(T),i&&J.delete(i),s)c(new Error("Upload cancelled by user"));else{let b=v.message||String(v);if(b.includes("ECONNRESET")||b.includes("Client network socket disconnected")){let P=t.includes("0x0.st")?"0x0.st":t.includes("tmpfiles.org")?"tmpfiles.org":t.includes("catbox")?"Catbox/Litterbox":"the upload service",h="";t.includes("catbox")||t.includes("litterbox")?h="Please try using: 0x0.st, tmpfiles.org, temp.sh, file.io, or transfer.sh instead.":t.includes("0x0.st")||t.includes("tmpfiles")?h="Please try using: Catbox, Litterbox, temp.sh, file.io, or transfer.sh instead.":h="Please try using a different uploader service.",c(new Error(`Connection blocked to ${P} - This could mean:
1. Your network/firewall is blocking SSL/TLS connections to this service
2. The service is blocked by your ISP or organization
3. There's a proxy interfering with the connection

Try using a VPN, proxy, or connecting from a different network.

`+h))}else if(b.includes("ETIMEDOUT"))c(new Error("Connection timed out - The upload service did not respond in time. Try again or use a different uploader."));else if(b.includes("ENOTFOUND"))c(new Error("Service not found - Cannot reach the upload service. Check your internet connection."));else if(b.includes("EPIPE")||b.includes("ECONNABORTED"))c(new Error("Connection aborted - The server terminated the connection. This may be due to file size limits or server issues. Try a different uploader."));else if(b.includes("self signed certificate")||b.includes("SELF_SIGNED")||b.includes("UNABLE_TO_VERIFY_LEAF_SIGNATURE")||b.includes("DEPTH_ZERO_SELF_SIGNED_CERT")){let P=t.includes("0x0.st")?"0x0.st":t.includes("tmpfiles.org")?"tmpfiles.org":t.includes("catbox")?"Catbox/Litterbox":t.includes("temp.sh")?"temp.sh":t.includes("filebin.net")?"filebin.net":t.includes("buzzheavier")?"buzzheavier.com":t.includes("gofile")?"GoFile":"the upload service";c(new Error(`SSL certificate error with ${P} - You may be behind a corporate firewall or proxy that uses self-signed certificates. The plugin will try alternative uploaders automatically.`))}else c(v)}});let x=()=>{if(i&&W.has(i))return;let v=(Date.now()-w)/1e3,b=d/v/1024/1024,P=d/C*100,h=v>0?(C-d)/(d/v):0;o&&!o.isDestroyed()&&i&&($={uploadId:i,fileName:r,loaded:d,total:C,percent:P,speed:b,eta:h})},R=N.default.createReadStream(e,{highWaterMark:256*1024}),E=0;R.on("data",v=>{if(s){R.destroy();return}let b=g.write(v);d+=v.length,F=Date.now();let P;C>100*1024*1024?P=5*1024*1024:C>10*1024*1024?P=2*1024*1024:P=512*1024,(d-E>=P||d===v.length)&&(x(),E=d),b||(R.pause(),g.once("drain",()=>{R.resume()}))}),R.on("end",()=>{if(s){g.destroy();return}x(),g.end()}),R.on("error",v=>{clearInterval(T),g.destroy(),c(v)}),i&&J.set(i,{req:g,cleanup:()=>{s=!0,clearInterval(T);try{R.destroy()}catch{}try{g.socket&&g.socket.destroy(),g.destroy()}catch{}}})})}function ao(t,e,r,n,o,i={},a,s,l=3e5){let c=!1;return new Promise((p,u)=>{let y=new URL(t),A=y.protocol==="https:",C=A?me.default:et.default;if(jr(y.hostname)){u(new Error(`Custom uploader: Blocked request to private/reserved IP: ${y.hostname}`));return}if(!N.default.existsSync(e)){u(new Error(`File not found: ${e}`));return}let w=N.default.statSync(e).size;if(w===0){u(new Error(`File is empty (0 bytes): ${e}`));return}try{N.default.accessSync(e,N.default.constants.R_OK)}catch{u(new Error(`File is not readable: ${e}`));return}let F=It(i),d={hostname:y.hostname,port:y.port||(A?443:80),path:y.pathname+y.search,method:o,headers:{"Content-Type":n||"application/octet-stream","Content-Length":w,"User-Agent":"Vencord-BigFileUpload/1.0",...F}};A&&(d.agent=new me.default.Agent({keepAlive:!0,timeout:3e4,rejectUnauthorized:!0}));let T=Date.now(),g=Date.now(),x=0,R=setInterval(()=>{Date.now()-g>3e5&&(clearInterval(R),E.destroy(),u(new Error("Upload stalled - no progress for 5 minutes")))},1e4),E=C.request(d,h=>{let I="",H=!1;h.socket.setTimeout(6e4),h.on("data",B=>{if(I.length+B.length>ae){H||(m.warn(`[BigFileUpload] Response exceeded ${ae} bytes, truncating`),H=!0);return}I+=B}),h.on("end",()=>{if(clearInterval(R),s&&J.delete(s),s&&W.has(s)){W.delete(s),u(new Error("Upload cancelled by user"));return}if(H){u(new Error(`Response exceeded maximum size (${ae} bytes) and was truncated.`));return}if(h.statusCode&&h.statusCode>=200&&h.statusCode<300)s&&W.delete(s),p(I);else{let B=`HTTP ${h.statusCode}: ${h.statusMessage}`;h.statusCode===500?B="HTTP 500: Server Internal Error - The custom upload service is experiencing issues.":h.statusCode===502||h.statusCode===503||h.statusCode===504?B=`HTTP ${h.statusCode}: Service Unavailable - The custom upload service is temporarily down.`:h.statusCode===429?B="HTTP 429: Rate Limited - Too many requests to the custom uploader.":h.statusCode===413&&(B="HTTP 413: File Too Large - The file exceeds the custom service's size limit."),I&&I.length>0&&I.length<500&&(B+=`
Server response: ${I}`),u(new Error(B))}})});E.setTimeout(l),E.on("timeout",()=>{clearInterval(R),s&&J.delete(s),E.destroy(),u(new Error("Request timeout - The custom uploader took too long to respond."))}),E.on("error",h=>{clearInterval(R),s&&J.delete(s),u(c?new Error("Upload cancelled by user"):h)});let v=()=>{if(s&&W.has(s))return;let h=(Date.now()-T)/1e3,I=x/h/1024/1024,H=x/w*100,B=h>0?(w-x)/(x/h):0;a&&!a.isDestroyed()&&s&&($={uploadId:s,fileName:r,loaded:x,total:w,percent:H,speed:I,eta:B})},b=N.default.createReadStream(e,{highWaterMark:256*1024}),P=0;b.on("data",h=>{if(c){b.destroy();return}let I=E.write(h);x+=h.length,g=Date.now();let H;w>100*1024*1024?H=5*1024*1024:w>10*1024*1024?H=2*1024*1024:H=512*1024,(x-P>=H||x===h.length)&&(v(),P=x),I||(b.pause(),E.once("drain",()=>{b.resume()}))}),b.on("end",()=>{if(c){E.destroy();return}v(),E.end()}),b.on("error",h=>{clearInterval(R),E.destroy(),u(h)}),s&&J.set(s,{req:E,cleanup:()=>{c=!0,clearInterval(R);try{b.destroy()}catch{}try{E.socket&&E.socket.destroy(),E.destroy()}catch{}}})})}function le(t,e,r,n,o,i,a={},s,l,c=3e5){let p=!1;return new Promise((u,y)=>{let A=`----WebKitFormBoundary${Ce.default.randomBytes(16).toString("hex")}`,C=new URL(t),U=C.protocol==="https:",w=U?me.default:et.default;if(!N.default.existsSync(e)){y(new Error(`File not found: ${e}`));return}let d=N.default.statSync(e).size;if(d===0){y(new Error(`File is empty (0 bytes): ${e}`));return}try{N.default.accessSync(e,N.default.constants.R_OK)}catch{y(new Error(`File is not readable: ${e}`));return}let T=[];for(let[S,_]of Object.entries(i))S&&S.trim()!==""&&T.push(Buffer.from(`--${A}\r
Content-Disposition: form-data; name="${S}"\r
\r
${_}\r
`));T.push(Buffer.from(`--${A}\r
Content-Disposition: form-data; name="${o}"; filename="${r}"\r
Content-Type: ${n||"application/octet-stream"}\r
\r
`));let g=Buffer.concat(T),x=Buffer.from(`\r
--${A}--\r
`),R=g.length+d+x.length,E={hostname:C.hostname,port:C.port||(U?443:80),path:C.pathname+C.search,method:"POST",headers:{"Content-Type":`multipart/form-data; boundary=${A}`,"Content-Length":R,...a}};U&&(E.agent=new me.default.Agent({keepAlive:!0,timeout:3e4,rejectUnauthorized:!0}));let v=Date.now(),b=Date.now(),P=0,h=setInterval(()=>{Date.now()-b>3e5&&(clearInterval(h),I.destroy(),y(new Error("Upload stalled - no progress for 5 minutes")))},1e4),I=w.request(E,S=>{let _="",M=!1;S.socket.setTimeout(6e4),S.on("data",V=>{if(_.length+V.length>ae){M||(m.warn(`[BigFileUpload] Response exceeded ${ae} bytes, truncating`),M=!0);return}_+=V}),S.on("end",()=>{if(clearInterval(h),l&&J.delete(l),l&&W.has(l)){W.delete(l),y(new Error("Upload cancelled by user"));return}if(M){y(new Error(`Response exceeded maximum size (${ae} bytes) and was truncated. The upload may have succeeded but the response could not be processed.`));return}if(S.statusCode&&S.statusCode>=200&&S.statusCode<300)l&&W.delete(l),u(_);else{let V=`HTTP ${S.statusCode}: ${S.statusMessage}`;S.statusCode===500?V="HTTP 500: Server Internal Error - The upload service is experiencing issues. This is a server-side problem, not a client error.":S.statusCode===502||S.statusCode===503||S.statusCode===504?V=`HTTP ${S.statusCode}: Service Unavailable - The upload service is temporarily down or overloaded.`:S.statusCode===429?V="HTTP 429: Rate Limited - Too many requests. Please wait before trying again.":S.statusCode===413?V="HTTP 413: File Too Large - The file exceeds the service's size limit.":S.statusCode&&S.statusCode>=400&&S.statusCode<500&&(V=`HTTP ${S.statusCode}: Client Error - ${S.statusMessage}`),_&&_.length>0&&_.length<500&&(V+=`
Server response: ${_}`),y(new Error(V))}})});I.setTimeout(c),I.on("timeout",()=>{clearInterval(h),l&&J.delete(l),I.destroy(),y(new Error("Request timeout - The server took too long to respond."))}),I.on("error",S=>{if(clearInterval(h),l&&J.delete(l),p)y(new Error("Upload cancelled by user"));else{let _=S.message||String(S);if(_.includes("ECONNRESET")||_.includes("Client network socket disconnected")){let M=t.includes("0x0.st")?"0x0.st":t.includes("tmpfiles.org")?"tmpfiles.org":t.includes("catbox")?"Catbox/Litterbox":"the upload service",V="";t.includes("catbox")||t.includes("litterbox")?V="Please try using: 0x0.st, tmpfiles.org, temp.sh, file.io, or transfer.sh instead.":t.includes("0x0.st")||t.includes("tmpfiles")?V="Please try using: Catbox, Litterbox, temp.sh, file.io, or transfer.sh instead.":V="Please try using a different uploader service.",y(new Error(`Connection blocked to ${M} - This could mean:
1. Your network/firewall is blocking SSL/TLS connections to this service
2. The service is blocked by your ISP or organization
3. There's a proxy interfering with the connection

Try using a VPN, proxy, or connecting from a different network.

`+V))}else if(_.includes("ETIMEDOUT"))y(new Error("Connection timed out - The upload service did not respond in time. Try again or use a different uploader."));else if(_.includes("ENOTFOUND"))y(new Error("Service not found - Cannot reach the upload service. Check your internet connection."));else if(_.includes("EPIPE")||_.includes("ECONNABORTED"))y(new Error("Connection aborted - The server terminated the connection. This may be due to file size limits or server issues. Try a different uploader."));else if(_.includes("self signed certificate")||_.includes("SELF_SIGNED")||_.includes("UNABLE_TO_VERIFY_LEAF_SIGNATURE")||_.includes("DEPTH_ZERO_SELF_SIGNED_CERT")){let M=t.includes("0x0.st")?"0x0.st":t.includes("tmpfiles.org")?"tmpfiles.org":t.includes("catbox")?"Catbox/Litterbox":t.includes("temp.sh")?"temp.sh":t.includes("filebin.net")?"filebin.net":t.includes("buzzheavier")?"buzzheavier.com":t.includes("gofile")?"GoFile":"the upload service";y(new Error(`SSL certificate error with ${M} - You may be behind a corporate firewall or proxy that uses self-signed certificates. The plugin will try alternative uploaders automatically.`))}else y(S)}});let H=()=>{if(l&&W.has(l))return;let S=(Date.now()-v)/1e3,_=P/S/1024/1024,M=P/R*100,V=S>0?(R-P)/(P/S):0;s&&!s.isDestroyed()&&l&&($={uploadId:l,fileName:r,loaded:P,total:R,percent:M,speed:_,eta:V})};I.write(g),P+=g.length,b=Date.now();let B=N.default.createReadStream(e,{highWaterMark:256*1024}),Pe=0,X=0;B.on("data",S=>{if(p){B.destroy();return}let _=I.write(S);P+=S.length,X+=S.length,b=Date.now();let M;d>100*1024*1024?M=5*1024*1024:d>10*1024*1024?M=2*1024*1024:M=512*1024,(X-Pe>=M||X===S.length)&&(H(),Pe=X),_||(B.pause(),I.once("drain",()=>{B.resume()}))}),B.on("end",()=>{if(p){I.destroy();return}I.write(x),P+=x.length,b=Date.now(),H(),d<1024*1024?setTimeout(()=>{I.end()},100):I.end()}),B.on("error",S=>{clearInterval(h),I.destroy(),y(S)}),l&&J.set(l,{req:I,cleanup:()=>{p=!0,clearInterval(h);try{B.destroy()}catch{}try{I.socket&&I.socket.destroy(),I.destroy()}catch{}}})})}async function _t(t,e,r,n,o,i=3e5){let a,s=!1;try{if(typeof e=="string"?a=e:(a=await ee(e,r),s=!0),!a)throw new Error("Failed to resolve file path for GoFile upload");let l={};n&&(l.token=n);let c=await so(),p=await le(c,a,r,"application/octet-stream","file",l,{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,o,i),u=JSON.parse(p);return s&&await z(a),u}catch(l){throw s&&a&&await z(a),l}}async function Ot(t,e,r,n,o,i,a,s=3e5){let l,c=!1;try{if(typeof r=="string"?l=r:(l=await ee(r,n),c=!0),!l)throw new Error("Failed to resolve file path for Catbox upload");let p={reqtype:"fileupload"},u=i?.trim();u&&(p.userhash=u);let y=await le(e,l,n,o,"fileToUpload",p,{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,a,s);return c&&await z(l),y}catch(p){throw c&&l&&await z(l),p}}async function Mt(t,e,r,n,o,i,a=3e5){let s,l=!1;try{if(typeof e=="string"?s=e:(s=await ee(e,r),l=!0),!s)throw new Error("Failed to resolve file path for Litterbox upload");let p=await le("https://litterbox.catbox.moe/resources/internals/api.php",s,r,n,"fileToUpload",{reqtype:"fileupload",time:o},{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,i,a);return l&&await z(s),p}catch(c){throw l&&s&&await z(s),c}}async function lo(t,e,r,n,o,i,a=3e5){let s,l=!1;try{if(typeof e=="string"?s=e:(s=await ee(e,r),l=!0),!s)throw new Error("Failed to resolve file path for transfer.sh upload");let c={"User-Agent":"Vencord-BigFileUpload/1.0"};n&&n.trim()!==""&&(c["Max-Days"]=n),o&&o.trim()!==""&&(c["Max-Downloads"]=o);let p=await Qr(`https://transfer.sh/${encodeURIComponent(r)}`,s,r,c,t.sender,i,a);return l&&await z(s),p.trim()}catch(c){throw l&&s&&await z(s),c}}async function zt(t,e,r,n,o=3e5){let i,a=!1;try{if(typeof e=="string"?i=e:(i=await ee(e,r),a=!0),!i)throw new Error("Failed to resolve file path for temp.sh upload");let s=await le("https://temp.sh/upload",i,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,n,o);return a&&await z(i),s.trim()}catch(s){throw a&&i&&await z(i),s}}async function Bt(t,e,r,n,o=3e5){let i,a=!1;try{if(typeof e=="string"?i=e:(i=await ee(e,r),a=!0),!i)throw new Error("Failed to resolve file path for tmpfiles.org upload");let s=await le("https://tmpfiles.org/api/v1/upload",i,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,n,o),l=JSON.parse(s);if(l.status==="success"&&l.data?.url){a&&await z(i);let c=l.data.url;return c.includes("tmpfiles.org/")&&!c.includes("/dl/")&&(c=c.replace(/tmpfiles\.org\/(\d+)/,"tmpfiles.org/dl/$1")),c}else throw new Error(`tmpfiles.org upload failed: ${s}`)}catch(s){throw a&&i&&await z(i),s}}async function Nt(t,e,r,n,o=3e5){let i,a=!1;try{if(typeof e=="string"?i=e:(i=await ee(e,r),a=!0),!i)throw new Error("Failed to resolve file path for filebin.net upload");let s=Ce.default.randomBytes(6).toString("hex");return await le(`https://filebin.net/${s}/${encodeURIComponent(r)}`,i,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,n,o),a&&await z(i),`https://filebin.net/${s}/${encodeURIComponent(r)}`}catch(s){throw a&&i&&await z(i),s}}async function Vt(t,e,r,n,o=3e5){let i,a=!1;try{if(typeof e=="string"?i=e:(i=await ee(e,r),a=!0),!i)throw new Error("Failed to resolve file path for buzzheavier.com upload");let s=await Qr(`https://w.buzzheavier.com/${encodeURIComponent(r)}`,i,r,{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,n,o);a&&await z(i);try{let l=JSON.parse(s);if(l.code===201&&l.data?.id)return`https://buzzheavier.com/${l.data.id}`;throw new Error(`Unexpected buzzheavier.com response: ${s}`)}catch{return s.trim()}}catch(s){throw a&&i&&await z(i),s}}async function co(t,e,r,n,o,i=3e5){let a,s=!1;try{if(typeof e=="string"?a=e:(a=await ee(e,r),s=!0),!a)throw new Error("Failed to resolve file path for file.io upload");let l="https://file.io/";n&&n.trim()!==""&&(l+=`?expires=${encodeURIComponent(n)}`);let c=await le(l,a,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,o,i),p=JSON.parse(c);if(p.success&&p.link)return s&&await z(a),p.link;throw new Error(`file.io upload failed: ${c}`)}catch(l){throw s&&a&&await z(a),l}}async function Gt(t,e,r,n,o,i=3e5){let a,s=!1;try{if(typeof e=="string"?a=e:(a=await ee(e,r),s=!0),!a)throw new Error("Failed to resolve file path for 0x0.st upload");let l={};n&&n.trim()!==""&&(l.expires=n);let c=await le("https://0x0.st",a,r,"application/octet-stream","file",l,{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,o,i);return s&&await z(a),c.trim()}catch(l){throw s&&a&&await z(a),l}}async function Wt(t,e,r,n,o,i,a,s,l,c,p,u,y,A=3e5){let C,U=!1,w=u||"POST",F=y||"MultipartFormData";try{if(typeof r=="string"?C=r:(C=await ee(r,n),U=!0),!C)throw new Error("Failed to resolve file path for custom upload");let d;if(F==="Binary"){m.info(`[BigFileUpload] Custom uploader using ${w} with binary body`);let g=It(s);d=await ao(e,C,n,o,w,g,t.sender,p,A)}else{m.info("[BigFileUpload] Custom uploader using POST with multipart form data");let g={};for(let[R,E]of Object.entries(a))R&&R.trim()!==""&&(g[R]=E);let x=It(s);delete x["Content-Type"],delete x["content-type"],d=await le(e,C,n,o,i,g,{...x,"User-Agent":"Vencord-BigFileUpload/1.0"},t.sender,p,A)}let T=io(d,l,c,e);return U&&await z(C),T}catch(d){throw U&&C&&await z(C),d}}async function uo(t,e,r,n,o){Xr(o.loggingLevel),m.info(`[BigFileUpload NATIVE] uploadFileBuffer called for: ${r} (type: ${n})`),m.info(`[BigFileUpload NATIVE] Received uploader setting: "${o.fileUploader}"`);try{let i=e.byteLength;m.info(`[BigFileUpload] Uploading from buffer: ${r} (${(i/1024/1024).toFixed(1)}MB)`);let a=["Catbox","Litterbox","0x0.st","tmpfiles.org","GoFile","buzzheavier.com","temp.sh","filebin.net"],s=o.fileUploader||"Catbox",l=Yr(r,s);m.info(`[BigFileUpload NATIVE] Primary uploader will be: ${l}`);let c=[l],p=$t(r);for(let w of a)w!==l&&w!=="Custom"&&!(p&&kt.includes(w))&&c.push(w);l==="Custom"&&c.length===1&&c.push(p?"GoFile":"Catbox"),m.info(`[BigFileUpload] Will try uploaders in order: ${c.join(", ")}`);let u=`upload-${Ce.default.randomUUID()}`;m.debug(`[BigFileUpload NATIVE] Upload ID: ${u}`),W.delete(u),$={uploadId:u,fileName:r,fileSize:i,loaded:0,total:i,percent:0,speed:0,eta:0},ne=Date.now();let y=async(w,F=!1)=>{let d;switch(w){case"GoFile":{let T=await _t(t,e,r,o.gofileToken,F?void 0:u,o.uploadTimeout);if(T.status==="ok"&&T.data){let g=T.data.downloadPage||(T.data.code?`https://gofile.io/d/${T.data.code}`:void 0);if(!g)throw new Error(`GoFile response missing download URL: ${JSON.stringify(T)}`);d=g}else throw new Error(`GoFile upload failed: ${T.error||JSON.stringify(T)}`);break}case"Catbox":{d=await Ot(t,"https://catbox.moe/user/api.php",e,r,n||"application/octet-stream",o.catboxUserHash||"",F?void 0:u,o.uploadTimeout);break}case"Litterbox":{d=await Mt(t,e,r,n||"application/octet-stream",o.litterboxTime||"1h",F?void 0:u,o.uploadTimeout);break}case"temp.sh":{d=await zt(t,e,r,F?void 0:u,o.uploadTimeout);break}case"0x0.st":{d=await Gt(t,e,r,o.zeroX0Expires,F?void 0:u,o.uploadTimeout);break}case"tmpfiles.org":{d=await Bt(t,e,r,F?void 0:u,o.uploadTimeout);break}case"filebin.net":{d=await Nt(t,e,r,F?void 0:u,o.uploadTimeout);break}case"buzzheavier.com":{d=await Vt(t,e,r,F?void 0:u,o.uploadTimeout);break}case"Custom":{if(!o.customUploaderRequestURL||o.customUploaderRequestURL.trim()==="")throw new Error("Custom uploader not configured - skipping to next uploader");if(F)throw new Error("Custom uploader cannot be retried in background");let T=Xe(o.customUploaderArgs,{}),g=Xe(o.customUploaderHeaders,{}),x=(o.customUploaderURL||"").split(".").filter(R=>R);d=await Wt(t,o.customUploaderRequestURL,e,r,n||"application/octet-stream",o.customUploaderFileFormName||"file",T,g,o.customUploaderResponseType||"Text",x,u,o.customUploaderRequestMethod,o.customUploaderBodyType,o.uploadTimeout);break}default:throw new Error(`Unknown uploader: ${w}`)}if(!Kr(d))throw new Error(`Invalid URL received from ${w}: ${d.substring(0,100)}`);return d},A=[],C=null,U=[];for(let w of c){let F=U.length+1,d=c.length;if(m.info(`[BigFileUpload] Trying uploader: ${w} (attempt ${F}/${d})`),F===1?m.info(`[BigFileUpload] Starting upload to ${w}`):m.info(`[BigFileUpload] Retrying with ${w} (attempt ${F}/${d})`),A.length>0){let T=await qr(A.map(g=>g.promise));if(T){m.info(`[BigFileUpload] \u2705 Background retry succeeded with ${T.uploader}!`);let g=T.url;return o.useEmbedsVideo==="Yes"&&(g="https://embeds.video/"+uploadResult),o.autoFormat==="Yes"&&(g=`[${r}](${g})`),{success:!0,url:g,fileName:r,fileSize:i,uploadId:u,actualUploader:T.uploader,attemptedUploaders:[...U,T.uploader]}}}try{m.debug(`[BigFileUpload NATIVE] Trying ${w}`);let T=await y(w,!1),g=T;return o.useEmbedsVideo==="Yes"&&(g="https://embeds.video/"+T),o.autoFormat==="Yes"&&(g=`[${r}](${g})`),m.info(`[BigFileUpload] \u2705 Upload successful with ${w}! File: ${r} (${(i/1024/1024).toFixed(2)}MB) \u2192 ${T}`),{success:!0,url:g,fileName:r,fileSize:i,uploadId:u,actualUploader:w,attemptedUploaders:[...U,w]}}catch(T){let g=T instanceof Error?T.message:String(T);if(g.toLowerCase().includes("upload cancelled by user"))return m.info("[BigFileUpload] Upload cancelled by user, aborting retries"),ze(),{success:!1,error:"Upload cancelled by user",attemptedUploaders:U};m.error(`[BigFileUpload] Upload failed with ${w}:`,T),C=new Error(`[${w}] ${g}`),U.push(w),m.debug(`[BigFileUpload] Error details for ${w}: ${g}`);let x=g;g.length>100&&(x=g.substring(0,100)+"...");let R=U.length>=c.length;if(t.sender&&!t.sender.isDestroyed())if(R)Qe(t,{type:"failure",message:`${w} failed: ${x}`});else{let E=c[U.length];Qe(t,{type:"failure",message:`${w} failed: ${x}. Trying ${E}...`})}if(w!=="Custom"&&!A.some(E=>E.uploader===w)){m.info(`[BigFileUpload] Starting background retry for ${w}`);let E=(async()=>{await new Promise(v=>setTimeout(v,1e3));try{let v=await y(w,!0);return m.info(`[BigFileUpload] Background retry succeeded for ${w}`),{url:v,uploader:w}}catch(v){return m.debug(`[BigFileUpload] Background retry failed for ${w}:`,v),null}})();A.push({uploader:w,promise:E})}if(!R){let E=c[U.length];m.warn(`[BigFileUpload] ${w} failed. Trying ${E}...`),$&&$.uploadId===u&&($={...$,loaded:0,percent:0,speed:0,eta:0},ne=Date.now())}if(g.toLowerCase().includes("read")&&g.toLowerCase().includes("image")?m.error(`[BigFileUpload] IMAGE READ ERROR from ${w}: ${g}`):g.includes("412")||g.includes("415")||g.includes("Bad file type")||g.includes("Unsupported Media Type")?m.warn(`[BigFileUpload] File type rejected by ${w}`):(g.includes("File not found")||g.includes("empty")||g.includes("not readable"))&&m.error(`[BigFileUpload] FILE ACCESS ERROR: ${g}`),R){m.info("[BigFileUpload] All primary uploaders exhausted, waiting for background retries...");let E=await Promise.race([qr(A.map(v=>v.promise)),new Promise(v=>setTimeout(()=>v(null),3e4))]);if(E){m.info(`[BigFileUpload] \u2705 Background retry saved the day with ${E.uploader}!`);let v=E.url;return o.useEmbedsVideo==="Yes"&&(v="https://embeds.video/"+uploadResult),o.autoFormat==="Yes"&&(v=`[${r}](${v})`),{success:!0,url:v,fileName:r,fileSize:i,uploadId:u,actualUploader:E.uploader,attemptedUploaders:[...U,E.uploader]}}m.warn("[BigFileUpload] No more uploaders to try and no background retries succeeded");break}}}return m.error(`[BigFileUpload] All uploaders failed. Attempted: ${U.join(", ")}`),ze(),{success:!1,error:`All upload services failed. Last error: ${C?.message||"Connection issue"}. Tried: ${U.join(", ")}`}}catch(i){return m.error("[BigFileUpload] Unexpected error in uploadFileBuffer:",i),ze(),{success:!1,error:`Unexpected error: ${i instanceof Error?i.message:String(i)}. Please try again.`}}}async function fo(t,e){Xr(e.loggingLevel);let r=Be.BrowserWindow.fromWebContents(t.sender),n={title:"Select file to upload",properties:["openFile","dontAddToRecent"]},{canceled:o,filePaths:i}=r?await Be.dialog.showOpenDialog(r,n):await Be.dialog.showOpenDialog(n);if(o||i.length===0)return{success:!1,error:"File selection cancelled"};let a=i[0],s=At.default.basename(a),c=(await N.default.promises.stat(a)).size;if(e.respectNitroLimit){let d=Hr[e.nitroTier||"none"]||Hr.none;if(c<=d){m.info(`[BigFileUpload] File under Nitro limit (${(c/1024/1024).toFixed(1)}MB <= ${(d/1024/1024).toFixed(0)}MB), using Discord native upload`);let T=await N.default.promises.readFile(a);return{success:!0,useNativeUpload:!0,fileName:s,fileSize:c,buffer:T.buffer.slice(T.byteOffset,T.byteOffset+T.byteLength)}}}m.info(`[BigFileUpload] Securely uploading: ${s} (${(c/1024/1024).toFixed(1)}MB)`),m.debug(`[BigFileUpload] File path (main process only): ${a}`);let p=["Catbox","Litterbox","0x0.st","tmpfiles.org","GoFile","buzzheavier.com","temp.sh","filebin.net"],u=e.fileUploader||"Catbox",y=Yr(s,u),A=$t(s),C=[y];for(let d of p)d!==y&&d!=="Custom"&&!(A&&kt.includes(d))&&C.push(d);m.info(`[BigFileUpload] Will try uploaders in order: ${C.join(", ")}`);let U=`upload-${Ce.default.randomUUID()}`;W.delete(U),$={uploadId:U,fileName:s,fileSize:c,loaded:0,total:c,percent:0,speed:0,eta:0},ne=Date.now();let w=null,F=[];for(let d of C){let T=F.length+1,g=C.length;m.info(`[BigFileUpload] Trying uploader: ${d} (attempt ${T}/${g})`),T===1?m.info(`[BigFileUpload] Starting upload to ${d}`):m.info(`[BigFileUpload] Retrying with ${d} (attempt ${T}/${g})`);try{let x;switch(d){case"GoFile":{m.debug("[BigFileUpload] Trying GoFile");let E=await _t(t,a,s,e.gofileToken,U,e.uploadTimeout);if(E.status==="ok"&&E.data){let v=E.data.downloadPage||(E.data.code?`https://gofile.io/d/${E.data.code}`:void 0);if(!v)throw new Error(`GoFile response missing download URL: ${JSON.stringify(E)}`);x=v}else throw new Error(`GoFile upload failed: ${E.error||JSON.stringify(E)}`);break}case"Catbox":{m.debug("[BigFileUpload] Trying Catbox"),x=await Ot(t,"https://catbox.moe/user/api.php",a,s,"",e.catboxUserHash||"",U,e.uploadTimeout);break}case"Litterbox":{m.debug("[BigFileUpload] Trying Litterbox"),x=await Mt(t,a,s,"",e.litterboxTime||"1h",U,e.uploadTimeout);break}case"temp.sh":{m.debug("[BigFileUpload] Trying temp.sh"),x=await zt(t,a,s,U,e.uploadTimeout);break}case"0x0.st":{m.debug("[BigFileUpload] Trying 0x0.st"),x=await Gt(t,a,s,e.zeroX0Expires,U,e.uploadTimeout);break}case"tmpfiles.org":{m.debug("[BigFileUpload] Trying tmpfiles.org"),x=await Bt(t,a,s,U,e.uploadTimeout);break}case"filebin.net":{m.debug("[BigFileUpload] Trying filebin.net"),x=await Nt(t,a,s,U,e.uploadTimeout);break}case"buzzheavier.com":{m.debug("[BigFileUpload] Trying buzzheavier.com"),x=await Vt(t,a,s,U,e.uploadTimeout);break}case"Custom":{if(!e.customUploaderRequestURL||e.customUploaderRequestURL.trim()==="")throw new Error("Custom uploader not configured - skipping to next uploader");if(d!==y)throw new Error("Custom uploader only works as primary selection");let E=Xe(e.customUploaderArgs,{}),v=Xe(e.customUploaderHeaders,{}),b=(e.customUploaderURL||"").split(".").filter(h=>h);x=await Wt(t,e.customUploaderRequestURL,a,s,"",e.customUploaderFileFormName||"file",E,v,e.customUploaderResponseType||"Text",b,U,e.customUploaderRequestMethod,e.customUploaderBodyType,e.uploadTimeout);break}default:throw new Error(`Unknown uploader: ${d}`)}if(!Kr(x))throw new Error(`Invalid URL received from ${d}: ${x.substring(0,100)}`);let R=x;return e.useEmbedsVideo==="Yes"&&(R="https://embeds.video/"+x),e.autoFormat==="Yes"&&(R=`[${s}](${R})`),m.info(`[BigFileUpload] \u2705 Upload successful with ${d}! File: ${s} (${(c/1024/1024).toFixed(2)}MB) \u2192 ${x}`),{success:!0,url:R,fileName:s,fileSize:c,uploadId:U,actualUploader:d,attemptedUploaders:[...F,d]}}catch(x){let R=x instanceof Error?x.message:String(x);if(R.toLowerCase().includes("upload cancelled by user"))return m.info("[BigFileUpload] Upload cancelled by user, aborting"),$&&$.uploadId===U&&($=void 0,ne=0),{success:!1,error:"Upload cancelled by user",attemptedUploaders:F};m.error(`[BigFileUpload] Upload failed with ${d}:`,x),w=new Error(`[${d}] ${R}`),F.push(d);let E=R;R.length>100&&(E=R.substring(0,100)+"...");let v=F.length===C.length-1;if(t.sender&&!t.sender.isDestroyed())if(v)Qe(t,{type:"failure",message:`${d} failed: ${E}`});else{let P=C[F.length];Qe(t,{type:"failure",message:`${d} failed: ${E}. Trying ${P}...`})}if(d===C[C.length-1])break;let b=C[F.length];m.warn(`[BigFileUpload] ${d} failed. Will retry with ${b}`),console.warn(`[BigFileUpload] Upload failed with ${d}, retrying with ${b}...`),$&&$.uploadId===U&&($={...$,loaded:0,percent:0,speed:0,eta:0},ne=Date.now())}}return m.error(`[BigFileUpload] All uploaders failed. Attempted: ${F.join(", ")}`),ze(),{success:!1,error:`All upload services failed. Last error: ${w?.message||"Connection issue"}. Tried: ${F.join(", ")}`}}var $=null,ne=0,po=300*1e3,J=new Map,W=new Set,Me=[],ho=50;function Qe(t,e){let r={...e,timestamp:Date.now()};Me.push(r),Me.length>ho&&Me.shift(),m.debug("[BigFileUpload] Notification queued:",e)}function go(){let t=[...Me];return Me.length=0,t}function mo(){if($&&$.uploadId&&W.has($.uploadId))return $=null,ne=0,null;if($&&ne>0){let t=Date.now()-ne;if(t>po)return m.warn(`[BigFileUpload] Clearing stale progress data (${Math.round(t/1e3)}s old)`),$=null,ne=0,null}return $&&m.debug("[NATIVE] getLatestProgress returning:",$.percent+"%"),$}function ze(){$=null,ne=0}function vo(t,e){m.info(`[BigFileUpload] Cancelling upload: ${e}`),W.add(e),setTimeout(()=>{W.delete(e),m.debug(`[BigFileUpload] Cleaned up cancelled upload ID: ${e}`)},3e4),$&&$.uploadId===e&&($=null);let r=J.get(e);if(r)try{r.cleanup();try{r.req.socket&&r.req.socket.destroy(),r.req.destroy()}catch{}return J.delete(e),m.info(`[BigFileUpload] Upload ${e} cancelled successfully`),{success:!0}}catch(n){return m.error(`[BigFileUpload] Error cancelling upload ${e}:`,n),{success:!1,error:n instanceof Error?n.message:String(n)}}else return m.warn(`[BigFileUpload] No active upload found for ID: ${e}, but marked as cancelled`),{success:!0}}var Zt={};se(Zt,{getImageBuffer:()=>yo});f();async function yo(t,e){let n=await(await fetch(e)).arrayBuffer();return Buffer.from(n)}var qt={};se(qt,{getMemory:()=>wo});f();function wo(){let t=process.memoryUsage();return{heapUsed:t.heapUsed,heapTotal:t.heapTotal}}var en={AppleMusicRichPresence:Ut,ConsoleShortcuts:St,FixSpotifyEmbeds:kr,FixYoutubeEmbeds:_r,OpenInApp:Rt,Translate:Ct,VoiceMessages:Ft,XSOverlay:Dt,YoutubeAdblock:Gr,BigFileUpload:Ht,RandomGary:Zt,venfetch:qt};var tn={};for(let[t,e]of Object.entries(en)){let r=Object.entries(e);if(!r.length)continue;let n=tn[t]={};for(let[o,i]of r){let a=`VencordPluginNative_${t}_${o}`;Jt.ipcMain.handle(a,i),n[o]=a}}Jt.ipcMain.on("VencordGetPluginIpcMethodMap",t=>{t.returnValue=tn});f();function Yt(t,e=300){let r;return function(...n){clearTimeout(r),r=setTimeout(()=>{t(...n)},e)}}be();var O=require("electron");f();var rn="PCFkb2N0eXBlIGh0bWw+PGh0bWwgbGFuZz0iZW4iPjxoZWFkPjxtZXRhIGNoYXJzZXQ9InV0Zi04Ij48dGl0bGU+VmVuY29yZCBRdWlja0NTUyBFZGl0b3I8L3RpdGxlPjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tb25hY28tZWRpdG9yQDAuNTAuMC9taW4vdnMvZWRpdG9yL2VkaXRvci5tYWluLmNzcyIgaW50ZWdyaXR5PSJzaGEyNTYtdGlKUFEyTzA0ei9wWi9Bd2R5SWdock9NemV3ZitQSXZFbDFZS2JRdnNaaz0iIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiIHJlZmVycmVycG9saWN5PSJuby1yZWZlcnJlciI+PHN0eWxlPiNjb250YWluZXIsYm9keSxodG1se3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MDt0b3A6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO21hcmdpbjowO3BhZGRpbmc6MDtvdmVyZmxvdzpoaWRkZW59PC9zdHlsZT48L2hlYWQ+PGJvZHk+PGRpdiBpZD0iY29udGFpbmVyIj48L2Rpdj48c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tb25hY28tZWRpdG9yQDAuNTAuMC9taW4vdnMvbG9hZGVyLmpzIiBpbnRlZ3JpdHk9InNoYTI1Ni1LY1U0OFRHcjg0cjd1bkY3SjVJZ0JvOTVhZVZyRWJyR2UwNFM3VGNGVWpzPSIgY3Jvc3NvcmlnaW49ImFub255bW91cyIgcmVmZXJyZXJwb2xpY3k9Im5vLXJlZmVycmVyIj48L3NjcmlwdD48c2NyaXB0PnJlcXVpcmUuY29uZmlnKHtwYXRoczp7dnM6Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbW9uYWNvLWVkaXRvckAwLjUwLjAvbWluL3ZzIn19KSxyZXF1aXJlKFsidnMvZWRpdG9yL2VkaXRvci5tYWluIl0sKCgpPT57Z2V0Q3VycmVudENzcygpLnRoZW4oKGU9Pnt2YXIgdD1tb25hY28uZWRpdG9yLmNyZWF0ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29udGFpbmVyIikse3ZhbHVlOmUsbGFuZ3VhZ2U6ImNzcyIsdGhlbWU6Z2V0VGhlbWUoKX0pO3Qub25EaWRDaGFuZ2VNb2RlbENvbnRlbnQoKCgpPT5zZXRDc3ModC5nZXRWYWx1ZSgpKSkpLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCgoKT0+e3QubGF5b3V0KCl9KSl9KSl9KSk8L3NjcmlwdD48L2JvZHk+PC9odG1sPg==";var ve=require("fs"),pe=require("fs/promises"),ye=require("path");f();be();var Fe=require("electron");function nn(){Fe.ipcMain.handle("VencordCspRemoveOverride",bo),Fe.ipcMain.handle("VencordCspRequestAddOverride",xo),Fe.ipcMain.handle("VencordCspIsDomainAllowed",Uo)}function To(t,e){try{let{host:r}=new URL(t);if(/[;'"\\]/.test(r))return!1}catch{return!1}return!(e.length===0||e.some(r=>!G.includes(r)))}function Eo(t,e,r){let n=new URL(t).host,o=`${r} wants to allow connections to ${n}`,i=`Unless you recognise and fully trust ${n}, you should cancel this request!

You will have to fully close and restart Vesktop for the changes to take effect.`;if(e.length===1&&e[0]==="connect-src")return{message:o,detail:i};let a=e.filter(s=>s!=="connect-src").map(s=>{switch(s){case"img-src":return"Images";case"style-src":return"CSS & Themes";case"font-src":return"Fonts";default:throw new Error(`Illegal CSP directive: ${s}`)}}).sort().join(", ");return i=`The following types of content will be allowed to load from ${n}:
${a}

${i}`,{message:o,detail:i}}async function xo(t,e,r,n){if(!To(e,r))return"invalid";let o=new URL(e).host;if(o in re.store.customCspRules)return"conflict";let{checkboxChecked:i,response:a}=await Fe.dialog.showMessageBox({...Eo(e,r,n),type:n?"info":"warning",title:"Vencord Host Permissions",buttons:["Cancel","Allow"],defaultId:0,cancelId:0,checkboxLabel:`I fully trust ${o} and understand the risks of allowing connections to it.`,checkboxChecked:!1});return a!==1?"cancelled":i?(re.store.customCspRules[o]=r,"ok"):"unchecked"}function bo(t,e){return e in re.store.customCspRules?(delete re.store.customCspRules[e],!0):!1}function Uo(t,e,r){try{let n=new URL(e).host,o=vt[n]??re.store.customCspRules[n];return o?r.every(i=>o.includes(i)):!1}catch{return!1}}f();var So=/[^\S\r\n]*?\r?(?:\r\n|\n)[^\S\r\n]*?\*[^\S\r\n]?/,Ro=/^\\@/;function jt(t,e={}){return{fileName:t,name:e.name??t.replace(/\.css$/i,""),author:e.author??"Unknown Author",description:e.description??"A Discord Theme.",version:e.version,license:e.license,source:e.source,website:e.website,invite:e.invite}}function on(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}function sn(t,e){if(!t)return jt(e);let r=t.split("/**",2)?.[1]?.split("*/",1)?.[0];if(!r)return jt(e);let n={},o="",i="";for(let a of r.split(So))if(a.length!==0)if(a.charAt(0)==="@"&&a.charAt(1)!==" "){n[o]=i.trim();let s=a.indexOf(" ");o=a.substring(1,s),i=a.substring(s+1)}else i+=" "+a.replace("\\n",`
`).replace(Ro,"@");return n[o]=i.trim(),delete n[""],jt(e,n)}f();var an=require("electron");function ln(t){t.webContents.setWindowOpenHandler(({url:e})=>{switch(e){case"about:blank":case"https://discord.com/popout":case"https://ptb.discord.com/popout":case"https://canary.discord.com/popout":return{action:"allow"}}try{var{protocol:r}=new URL(e)}catch{return{action:"deny"}}switch(r){case"http:":case"https:":case"mailto:":case"steam:":case"spotify:":an.shell.openExternal(e)}return{action:"deny"}})}var Co=(0,ye.join)(__dirname,"vencordDesktopRenderer.css");(0,ve.mkdirSync)(de,{recursive:!0});nn();function Kt(t,e){let r=(0,ye.normalize)(t+"/"),n=(0,ye.join)(t,e),o=(0,ye.normalize)(n);return o.startsWith(r)?o:null}function cn(){return(0,pe.readFile)(Ue,"utf-8").catch(()=>"")}async function Fo(){let t=await(0,pe.readdir)(de).catch(()=>[]),e=[];for(let r of t){if(!r.endsWith(".css"))continue;let n=await un(r).then(on).catch(()=>null);n!=null&&e.push(sn(n,r))}return e}function un(t){t=t.replace(/\?v=\d+$/,"");let e=Kt(de,t);return e?(0,pe.readFile)(e,"utf-8"):Promise.reject(`Unsafe path ${t}`)}O.ipcMain.handle("VencordOpenQuickCss",()=>O.shell.openPath(Ue));O.ipcMain.handle("VencordOpenExternal",(t,e)=>{try{var{protocol:r}=new URL(e)}catch{throw"Malformed URL"}if(!gr.includes(r))throw"Disallowed protocol.";O.shell.openExternal(e)});O.ipcMain.handle("VencordGetQuickCss",()=>cn());O.ipcMain.handle("VencordSetQuickCss",(t,e)=>(0,ve.writeFileSync)(Ue,e));O.ipcMain.handle("VencordGetThemesList",()=>Fo());O.ipcMain.handle("VencordGetThemeData",(t,e)=>un(e));O.ipcMain.handle("VencordGetThemeSystemValues",()=>{let t=O.systemPreferences.getAccentColor?.()??"";return t.length&&t[0]!=="#"&&(t=`#${t}`),{"os-accent-color":t}});O.ipcMain.handle("VencordOpenThemesFolder",()=>O.shell.openPath(de));O.ipcMain.handle("VencordOpenSettingsFolder",()=>O.shell.openPath(he));O.ipcMain.handle("VencordInitFileWatchers",({sender:t})=>{let e,r;(0,pe.open)(Ue,"a+").then(o=>{o.close(),e=(0,ve.watch)(Ue,{persistent:!1},Yt(async()=>{t.postMessage("VencordQuickCssUpdate",await cn())},50))}).catch(()=>{});let n=(0,ve.watch)(de,{persistent:!1},Yt(()=>{t.postMessage("VencordThemeUpdate",void 0)}));t.once("destroyed",()=>{e?.close(),n.close(),r?.close()})});O.ipcMain.on("VencordGetMonacoTheme",t=>{t.returnValue=O.nativeTheme.shouldUseDarkColors?"vs-dark":"vs-light"});O.ipcMain.handle("VencordOpenMonacoEditor",async()=>{let t="Vencord QuickCSS Editor",e=O.BrowserWindow.getAllWindows().find(n=>n.title===t);if(e&&!e.isDestroyed()){e.focus();return}let r=new O.BrowserWindow({title:t,autoHideMenuBar:!0,darkTheme:!0,webPreferences:{preload:(0,ye.join)(__dirname,"vencordDesktopPreload.js"),contextIsolation:!0,nodeIntegration:!1,sandbox:!1}});ln(r),await r.loadURL(`data:text/html;base64,${rn}`)});O.ipcMain.handle("VencordGetRendererCss",()=>(0,pe.readFile)(Co,"utf-8"));f();var Ln=require("electron");f();var pn=require("module"),Do=(0,pn.createRequire)("/"),rt,Lo=";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global";try{rt=Do("worker_threads").Worker}catch{}var Po=rt?function(t,e,r,n,o){var i=!1,a=new rt(t+Lo,{eval:!0}).on("error",function(s){return o(s,null)}).on("message",function(s){return o(null,s)}).on("exit",function(s){s&&!i&&o(new Error("exited with code "+s),null)});return a.postMessage(r,n),a.terminate=function(){return i=!0,rt.prototype.terminate.call(a)},a}:function(t,e,r,n,o){setImmediate(function(){return o(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var i=function(){};return{terminate:i,postMessage:i}},q=Uint8Array,we=Uint16Array,hn=Int32Array,er=new q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tr=new q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gn=new q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mn=function(t,e){for(var r=new we(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var o=new hn(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)o[i]=i-r[n]<<5|n;return{b:r,r:o}},vn=mn(er,2),rr=vn.b,Io=vn.r;rr[28]=258,Io[258]=28;var yn=mn(tr,0),wn=yn.b,$s=yn.r,it=new we(32768);for(k=0;k<32768;++k)ce=(k&43690)>>1|(k&21845)<<1,ce=(ce&52428)>>2|(ce&13107)<<2,ce=(ce&61680)>>4|(ce&3855)<<4,it[k]=((ce&65280)>>8|(ce&255)<<8)>>1;var ce,k,De=(function(t,e,r){for(var n=t.length,o=0,i=new we(e);o<n;++o)t[o]&&++i[t[o]-1];var a=new we(e);for(o=1;o<e;++o)a[o]=a[o-1]+i[o-1]<<1;var s;if(r){s=new we(1<<e);var l=15-e;for(o=0;o<n;++o)if(t[o])for(var c=o<<4|t[o],p=e-t[o],u=a[t[o]-1]++<<p,y=u|(1<<p)-1;u<=y;++u)s[it[u]>>l]=c}else for(s=new we(n),o=0;o<n;++o)t[o]&&(s[o]=it[a[t[o]-1]++]>>15-t[o]);return s}),Ne=new q(288);for(k=0;k<144;++k)Ne[k]=8;var k;for(k=144;k<256;++k)Ne[k]=9;var k;for(k=256;k<280;++k)Ne[k]=7;var k;for(k=280;k<288;++k)Ne[k]=8;var k,Tn=new q(32);for(k=0;k<32;++k)Tn[k]=5;var k;var En=De(Ne,9,1);var xn=De(Tn,5,1),nt=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},K=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},ot=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},bn=function(t){return(t+7)/8|0},st=function(t,e,r){return(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length),new q(t.subarray(e,r))};var Un=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Z=function(t,e,r){var n=new Error(e||Un[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Z),!r)throw n;return n},Sn=function(t,e,r,n){var o=t.length,i=n?n.length:0;if(!o||e.f&&!e.l)return r||new q(0);var a=!r,s=a||e.i!=2,l=e.i;a&&(r=new q(o*3));var c=function(cr){var ur=r.length;if(cr>ur){var fr=new q(Math.max(ur*2,cr));fr.set(r),r=fr}},p=e.f||0,u=e.p||0,y=e.b||0,A=e.l,C=e.d,U=e.m,w=e.n,F=o*8;do{if(!A){p=K(t,u,1);var d=K(t,u+1,3);if(u+=3,d)if(d==1)A=En,C=xn,U=9,w=5;else if(d==2){var R=K(t,u,31)+257,E=K(t,u+10,15)+4,v=R+K(t,u+5,31)+1;u+=14;for(var b=new q(v),P=new q(19),h=0;h<E;++h)P[gn[h]]=K(t,u+h*3,7);u+=E*3;for(var I=nt(P),H=(1<<I)-1,B=De(P,I,1),h=0;h<v;){var Pe=B[K(t,u,H)];u+=Pe&15;var T=Pe>>4;if(T<16)b[h++]=T;else{var X=0,S=0;for(T==16?(S=3+K(t,u,3),u+=2,X=b[h-1]):T==17?(S=3+K(t,u,7),u+=3):T==18&&(S=11+K(t,u,127),u+=7);S--;)b[h++]=X}}var _=b.subarray(0,R),M=b.subarray(R);U=nt(_),w=nt(M),A=De(_,U,1),C=De(M,w,1)}else Z(1);else{var T=bn(u)+4,g=t[T-4]|t[T-3]<<8,x=T+g;if(x>o){l&&Z(0);break}s&&c(y+g),r.set(t.subarray(T,x),y),e.b=y+=g,e.p=u=x*8,e.f=p;continue}if(u>F){l&&Z(0);break}}s&&c(y+131072);for(var V=(1<<U)-1,ir=(1<<w)-1,at=u;;at=u){var X=A[ot(t,u)&V],Ee=X>>4;if(u+=X&15,u>F){l&&Z(0);break}if(X||Z(2),Ee<256)r[y++]=Ee;else if(Ee==256){at=u,A=null;break}else{var sr=Ee-254;if(Ee>264){var h=Ee-257,Ie=er[h];sr=K(t,u,(1<<Ie)-1)+rr[h],u+=Ie}var lt=C[ot(t,u)&ir],ct=lt>>4;lt||Z(3),u+=lt&15;var M=wn[ct];if(ct>3){var Ie=tr[ct];M+=ot(t,u)&(1<<Ie)-1,u+=Ie}if(u>F){l&&Z(0);break}s&&c(y+131072);var ar=y+sr;if(y<M){var lr=i-M,kn=Math.min(M,ar);for(lr+y<0&&Z(3);y<kn;++y)r[y]=n[lr+y]}for(;y<ar;++y)r[y]=r[y-M]}}e.l=A,e.p=at,e.b=y,e.f=p,A&&(p=1,e.m=U,e.d=C,e.n=w)}while(!p);return y!=r.length&&a?st(r,0,y):r.subarray(0,y)};var Ao=new q(0);var ko=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},fn=function(t,e,r){for(var n=t(),o=t.toString(),i=o.slice(o.indexOf("[")+1,o.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<n.length;++a){var s=n[a],l=i[a];if(typeof s=="function"){e+=";"+l+"=";var c=s.toString();if(s.prototype)if(c.indexOf("[native code]")!=-1){var p=c.indexOf(" ",8)+1;e+=c.slice(p,c.indexOf("(",p))}else{e+=c;for(var u in s.prototype)e+=";"+l+".prototype."+u+"="+s.prototype[u].toString()}else e+=c}else r[l]=s}return e},tt=[],$o=function(t){var e=[];for(var r in t)t[r].buffer&&e.push((t[r]=new t[r].constructor(t[r])).buffer);return e},_o=function(t,e,r,n){if(!tt[r]){for(var o="",i={},a=t.length-1,s=0;s<a;++s)o=fn(t[s],o,i);tt[r]={c:fn(t[a],o,i),e:i}}var l=ko({},tt[r].e);return Po(tt[r].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",r,l,$o(l),n)},Oo=function(){return[q,we,hn,er,tr,gn,rr,wn,En,xn,it,Un,De,nt,K,ot,bn,st,Z,Sn,nr,Rn,Cn]};var Rn=function(t){return postMessage(t,[t.buffer])},Cn=function(t){return t&&{out:t.size&&new q(t.size),dictionary:t.dictionary}},Mo=function(t,e,r,n,o,i){var a=_o(r,n,o,function(s,l){a.terminate(),i(s,l)});return a.postMessage([t,e],e.consume?[t.buffer]:[]),function(){a.terminate()}};var oe=function(t,e){return t[e]|t[e+1]<<8},te=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},Xt=function(t,e){return te(t,e)+te(t,e+4)*4294967296};function zo(t,e,r){return r||(r=e,e={}),typeof r!="function"&&Z(7),Mo(t,e,[Oo],function(n){return Rn(nr(n.data[0],Cn(n.data[1])))},1,r)}function nr(t,e){return Sn(t,{i:2},e&&e.out,e&&e.dictionary)}var Qt=typeof TextDecoder<"u"&&new TextDecoder,Bo=0;try{Qt.decode(Ao,{stream:!0}),Bo=1}catch{}var No=function(t){for(var e="",r=0;;){var n=t[r++],o=(n>127)+(n>223)+(n>239);if(r+o>t.length)return{s:e,r:st(t,r-1)};o?o==3?(n=((n&15)<<18|(t[r++]&63)<<12|(t[r++]&63)<<6|t[r++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):o&1?e+=String.fromCharCode((n&31)<<6|t[r++]&63):e+=String.fromCharCode((n&15)<<12|(t[r++]&63)<<6|t[r++]&63):e+=String.fromCharCode(n)}};function Vo(t,e){if(e){for(var r="",n=0;n<t.length;n+=16384)r+=String.fromCharCode.apply(null,t.subarray(n,n+16384));return r}else{if(Qt)return Qt.decode(t);var o=No(t),i=o.s,r=o.r;return r.length&&Z(8),i}}var Go=function(t,e){return e+30+oe(t,e+26)+oe(t,e+28)},Wo=function(t,e,r){var n=oe(t,e+28),o=Vo(t.subarray(e+46,e+46+n),!(oe(t,e+8)&2048)),i=e+46+n,a=te(t,e+20),s=r&&a==4294967295?Ho(t,i):[a,te(t,e+24),te(t,e+42)],l=s[0],c=s[1],p=s[2];return[oe(t,e+10),l,c,o,i+oe(t,e+30)+oe(t,e+32),p]},Ho=function(t,e){for(;oe(t,e)!=1;e+=4+oe(t,e+2));return[Xt(t,e+12),Xt(t,e+4),Xt(t,e+20)]};var dn=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(t){t()};function Fn(t,e,r){r||(r=e,e={}),typeof r!="function"&&Z(7);var n=[],o=function(){for(var w=0;w<n.length;++w)n[w]()},i={},a=function(w,F){dn(function(){r(w,F)})};dn(function(){a=r});for(var s=t.length-22;te(t,s)!=101010256;--s)if(!s||t.length-s>65558)return a(Z(13,0,1),null),o;var l=oe(t,s+8);if(l){var c=l,p=te(t,s+16),u=p==4294967295||c==65535;if(u){var y=te(t,s-12);u=te(t,y)==101075792,u&&(c=l=te(t,y+32),p=te(t,y+48))}for(var A=e&&e.filter,C=function(w){var F=Wo(t,p,u),d=F[0],T=F[1],g=F[2],x=F[3],R=F[4],E=F[5],v=Go(t,E);p=R;var b=function(h,I){h?(o(),a(h,null)):(I&&(i[x]=I),--l||a(null,i))};if(!A||A({name:x,size:T,originalSize:g,compression:d}))if(!d)b(null,st(t,v,v+T));else if(d==8){var P=t.subarray(v,v+T);if(g<524288||T>.8*g)try{b(null,nr(P,{out:new q(g)}))}catch(h){b(h,null)}else n.push(zo(P,{size:g},b))}else b(Z(14,"unknown compression type "+d,1),null);else b(null,null)},U=0;U<c;++U)C(U)}else a(null,{});return o}var Pn=require("fs"),ie=require("fs/promises"),Le=require("path");f();function Dn(t){function e(a,s,l,c){let p=0;return p+=a<<0,p+=s<<8,p+=l<<16,p+=c<<24>>>0,p}if(t[0]===80&&t[1]===75&&t[2]===3&&t[3]===4)return t;if(t[0]!==67||t[1]!==114||t[2]!==50||t[3]!==52)throw new Error("Invalid header: Does not start with Cr24");let r=t[4]===3,n=t[4]===2;if(!n&&!r||t[5]||t[6]||t[7])throw new Error("Unexpected crx format version number.");if(n){let a=e(t[8],t[9],t[10],t[11]),s=e(t[12],t[13],t[14],t[15]),l=16+a+s;return t.subarray(l,t.length)}let i=12+e(t[8],t[9],t[10],t[11]);return t.subarray(i,t.length)}yt();var Zo=(0,Le.join)(Ge,"ExtensionCache");async function qo(t,e){return await(0,ie.mkdir)(e,{recursive:!0}),new Promise((r,n)=>{Fn(t,(o,i)=>{if(o)return void n(o);Promise.all(Object.keys(i).map(async a=>{if(a.startsWith("_metadata/"))return;if(a.endsWith("/"))return void(0,ie.mkdir)((0,Le.join)(e,a),{recursive:!0});let s=a.split("/"),l=s.pop(),c=s.join("/"),p=(0,Le.join)(e,c);c&&await(0,ie.mkdir)(p,{recursive:!0}),await(0,ie.writeFile)((0,Le.join)(p,l),i[a])})).then(()=>r()).catch(a=>{(0,ie.rm)(e,{recursive:!0,force:!0}),n(a)})})})}async function In(t){let e=(0,Le.join)(Zo,`${t}`);try{await(0,ie.access)(e,Pn.constants.F_OK)}catch{let n=`https://clients2.google.com/service/update2/crx?response=redirect&acceptformat=crx2,crx3&x=id%3D${t}%26uc&prodversion=${process.versions.chrome}`,o=await He(n,{headers:{"User-Agent":`Electron ${process.versions.electron} ~ Vencord (https://github.com/Vendicated/Vencord)`}});await qo(Dn(o),e).catch(i=>console.error(`Failed to extract extension ${t}`,i))}Ln.session.defaultSession.loadExtension(e)}Te.app.whenReady().then(()=>{Te.protocol.handle("vencord",({url:t})=>{let e=decodeURI(t).slice(10).replace(/\?v=\d+$/,"");if(e.endsWith("/")&&(e=e.slice(0,-1)),e.startsWith("/themes/")){let r=e.slice(8),n=Kt(de,r);return n?Te.net.fetch((0,or.pathToFileURL)(n).toString()):new Response(null,{status:404})}switch(e){case"renderer.js.map":case"vencordDesktopRenderer.js.map":case"preload.js.map":case"vencordDesktopPreload.js.map":case"patcher.js.map":case"vencordDesktopMain.js.map":return Te.net.fetch((0,or.pathToFileURL)((0,An.join)(__dirname,e)).toString());default:return new Response(null,{status:404})}});try{Y.store.enableReactDevtools&&In("fmkadmapgofadopljbjfkapdkoienihi").then(()=>console.info("[Vencord] Installed React Developer Tools")).catch(t=>console.error("[Vencord] Failed to install React Developer Tools",t))}catch{}Tr()});
//# sourceURL=file:///VencordDesktopMain
//# sourceMappingURL=vencord://vencordDesktopMain.js.map
/*! For license information please see vencordDesktopMain.js.LEGAL.txt */
