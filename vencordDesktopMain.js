// Vencord 615f0ab
// Standalone: true
// Platform: Universal
// Updater Disabled: false
"use strict";var An=Object.create;var Ne=Object.defineProperty;var $n=Object.getOwnPropertyDescriptor;var kn=Object.getOwnPropertyNames;var On=Object.getPrototypeOf,Mn=Object.prototype.hasOwnProperty;var ue=(t,e)=>()=>(t&&(e=t(t=0)),e);var se=(t,e)=>{for(var r in e)Ne(t,r,{get:e[r],enumerable:!0})},ur=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of kn(e))!Mn.call(t,o)&&o!==r&&Ne(t,o,{get:()=>e[o],enumerable:!(n=$n(e,o))||n.enumerable});return t};var we=(t,e,r)=>(r=t!=null?An(On(t)):{},ur(e||!t||!t.__esModule?Ne(r,"default",{value:t,enumerable:!0}):r,t)),zn=t=>ur(Ne({},"__esModule",{value:!0}),t);var f=ue(()=>{"use strict"});var Te=ue(()=>{"use strict";f()});async function wr(t,e){try{var r=await fetch(t,e)}catch(o){throw o instanceof Error&&o.cause&&(o=o.cause),new Error(`${e?.method??"GET"} ${t} failed: ${o}`)}if(r.ok)return r;let n=`${e?.method??"GET"} ${t}: ${r.status} ${r.statusText}`;try{let o=await r.text();n+=`
${o}`}catch{}throw new Error(n)}async function Tr(t,e){return(await wr(t,e)).json()}async function He(t,e){let n=await(await wr(t,e)).arrayBuffer();return Buffer.from(n)}var Gn,vt=ue(()=>{"use strict";f();Gn=require("original-fs")});var Ie,yt=ue(()=>{f();Ie="615f0ab"});var be,wt=ue(()=>{f();be="supahfox/Vencord"});var Ze,Tt=ue(()=>{"use strict";f();yt();wt();Ze=`Vencord/${Ie}${be?` (https://github.com/${be})`:""}`});function Ae(t){return async function(){try{return{ok:!0,value:await t(...arguments)}}catch(e){return{ok:!1,error:e instanceof Error?{...e,message:e.message,name:e.name,stack:e.stack}:e}}}}var xr,br=ue(()=>{"use strict";f();xr=["vencordDesktopMain.js","vencordDesktopPreload.js","vencordDesktopRenderer.js","vencordDesktopRenderer.css"]});var qn={};async function Sr(t){return Tr(Wn+t,{headers:{Accept:"application/vnd.github+json","User-Agent":Ze}})}async function Hn(){return await Rr()?(await Sr(`/compare/${Ie}...HEAD`)).commits.map(r=>({hash:r.sha.slice(0,7),author:r.author.login,message:r.commit.message.split(`
`)[0]})):[]}async function Rr(){let t=await Sr("/releases/latest");return t.name.slice(t.name.lastIndexOf(" ")+1)===Ie?!1:(t.assets.forEach(({name:r,browser_download_url:n})=>{xr.some(o=>r.startsWith(o))&&xt.push([r,n])}),!0)}async function Zn(){let t=await Promise.all(xt.map(async([e,r])=>{let n=await He(r);return[(0,Ur.join)(__dirname,e),n]}));return await Promise.all(t.map(async([e,r])=>(0,Er.writeFile)(e,r))),xt=[],!0}var $e,Er,Ur,Wn,xt,Cr=ue(()=>{"use strict";f();vt();Te();Tt();$e=require("electron"),Er=require("fs/promises"),Ur=require("path");yt();wt();br();Wn=`https://api.github.com/repos/${be}`,xt=[];$e.ipcMain.handle("VencordGetRepo",Ae(()=>`https://github.com/${be}`));$e.ipcMain.handle("VencordGetUpdates",Ae(Hn));$e.ipcMain.handle("VencordUpdate",Ae(Rr));$e.ipcMain.handle("VencordBuild",Ae(Zn))});f();var ve=require("electron"),Pn=require("path"),rr=require("url");f();f();Te();f();var ct=Symbol("SettingsStore.isProxy"),fr=Symbol("SettingsStore.getRawTarget"),Pe=class{pathListeners=new Map;prefixListeners=new Map;globalListeners=new Set;proxyContexts=new WeakMap;proxyHandler=(()=>{let e=this;return{get(r,n,o){if(n===ct)return!0;if(n===fr)return r;let i=Reflect.get(r,n,o),a=e.proxyContexts.get(r);if(a==null)return i;let{root:s,path:l}=a;if(!(n in r)&&e.getDefaultValue!=null&&(i=e.getDefaultValue({target:r,key:n,root:s,path:l})),typeof i=="object"&&i!==null&&!i[ct]){let c=`${l}${l&&"."}${n}`;return e.makeProxy(i,s,c)}return i},set(r,n,o){if(o?.[ct]&&(o=o[fr]),r[n]===o)return!0;if(!Reflect.set(r,n,o))return!1;let i=e.proxyContexts.get(r);if(i==null)return!0;let{root:a,path:s}=i,l=`${s}${s&&"."}${n}`;return e.notifyListeners(l,o,a),!0},deleteProperty(r,n){if(!Reflect.deleteProperty(r,n))return!1;let o=e.proxyContexts.get(r);if(o==null)return!0;let{root:i,path:a}=o,s=`${a}${a&&"."}${n}`;return e.notifyListeners(s,void 0,i),!0}}})();constructor(e,r={}){this.plain=e,this.store=this.makeProxy(e),Object.assign(this,r)}makeProxy(e,r=e,n=""){return this.proxyContexts.set(e,{root:r,path:n}),new Proxy(e,this.proxyHandler)}notifyPrefixListeners(e,r,n){for(let o=1;o<=r.length;o++){let i=r.slice(0,o).join(".");this.prefixListeners.get(i)?.forEach(a=>a(n,e))}}notifyListeners(e,r,n){let o=e.split(".");if(o.length>3&&o[0]==="plugins"){let i=o.slice(0,3),a=i.join("."),s=i.reduce((l,c)=>l[c],n);this.globalListeners.forEach(l=>l(n,a)),this.pathListeners.get(a)?.forEach(l=>l(s))}else this.globalListeners.forEach(i=>i(n,e));this.pathListeners.get(e)?.forEach(i=>i(r)),this.notifyPrefixListeners(e,o,r)}setData(e,r){if(this.readOnly)throw new Error("SettingsStore is read-only");if(this.plain=e,this.store=this.makeProxy(e),r){let n=e,o=r.split(".");for(let i of o){if(!n){console.warn(`Settings#setData: Path ${r} does not exist in new data. Not dispatching update`);return}n=n[i]}this.pathListeners.get(r)?.forEach(i=>i(n)),this.notifyPrefixListeners(r,o,n)}this.markAsChanged()}addGlobalChangeListener(e){this.globalListeners.add(e)}addChangeListener(e,r){let n=this.pathListeners.get(e)??new Set;n.add(r),this.pathListeners.set(e,n)}addPrefixChangeListener(e,r){let n=this.prefixListeners.get(e)??new Set;n.add(r),this.prefixListeners.set(e,n)}removeGlobalChangeListener(e){this.globalListeners.delete(e)}removeChangeListener(e,r){let n=this.pathListeners.get(e);n&&(n.delete(r),n.size||this.pathListeners.delete(e))}removePrefixChangeListener(e,r){let n=this.prefixListeners.get(e);n&&(n.delete(r),n.size||this.prefixListeners.delete(e))}markAsChanged(){this.globalListeners.forEach(e=>e(this.plain,""))}};f();function ut(t,e){for(let r in e){let n=e[r];typeof n=="object"&&!Array.isArray(n)?(t[r]??={},ut(t[r],n)):t[r]??=n}return t}var dt=require("electron"),he=require("fs");f();var pr=require("electron"),fe=require("path"),Ve=process.env.VENCORD_USER_DATA_DIR??(process.env.DISCORD_USER_DATA_DIR?(0,fe.join)(process.env.DISCORD_USER_DATA_DIR,"..","VencordData"):(0,fe.join)(pr.app.getPath("userData"),"..","Vencord")),pe=(0,fe.join)(Ve,"settings"),de=(0,fe.join)(Ve,"themes"),Ge=(0,fe.join)(pe,"quickCss.css"),ft=(0,fe.join)(pe,"settings.json"),pt=(0,fe.join)(pe,"native-settings.json"),dr=["https:","http:","steam:","spotify:","com.epicgames.launcher:","tidal:","itunes:"];(0,he.mkdirSync)(pe,{recursive:!0});function hr(t,e){try{return JSON.parse((0,he.readFileSync)(e,"utf-8"))}catch(r){return r?.code!=="ENOENT"&&console.error(`Failed to read ${t} settings`,r),{}}}var Y=new Pe(hr("renderer",ft));Y.addGlobalChangeListener(()=>{try{(0,he.writeFileSync)(ft,JSON.stringify(Y.plain,null,4))}catch(t){console.error("Failed to write renderer settings",t)}});dt.ipcMain.on("VencordGetSettings",t=>t.returnValue=Y.plain);dt.ipcMain.handle("VencordSetSettings",(t,e,r)=>{Y.setData(e,r)});var _n={plugins:{},customCspRules:{}},gr=hr("native",pt);ut(gr,_n);var re=new Pe(gr);re.addGlobalChangeListener(()=>{try{(0,he.writeFileSync)(pt,JSON.stringify(re.plain,null,4))}catch(t){console.error("Failed to write native settings",t)}});var ht=require("electron"),xe=["connect-src"],j=[...xe,"img-src"],vr=["style-src","font-src"],G=[...j,...vr],mr=[...G,"script-src","worker-src"],mt={"http://localhost:*":G,"http://127.0.0.1:*":G,"localhost:*":G,"127.0.0.1:*":G,"*.github.io":G,"github.com":G,"raw.githubusercontent.com":G,"*.gitlab.io":G,"gitlab.com":G,"*.codeberg.page":G,"codeberg.org":G,"*.githack.com":G,"jsdelivr.net":G,"fonts.googleapis.com":vr,"i.imgur.com":j,"i.ibb.co":j,"i.pinimg.com":j,"*.tenor.com":j,"files.catbox.moe":G,"cdn.discordapp.com":G,"media.discordapp.net":j,"cdnjs.cloudflare.com":mr,"cdn.jsdelivr.net":mr,"api.github.com":xe,"ws.audioscrobbler.com":xe,"translate-pa.googleapis.com":xe,"*.vencord.dev":j,"manti.vendicated.dev":j,"decor.fieryflames.dev":xe,"ugc.decor.fieryflames.dev":j,"sponsor.ajay.app":xe,"dearrow-thumb.ajay.app":j,"usrbg.is-hardly.online":j,"icons.duckduckgo.com":j},gt=(t,e)=>Object.keys(t).find(r=>r.toLowerCase()===e),Bn=t=>{let e={};return t.split(";").forEach(r=>{let[n,...o]=r.trim().split(/\s+/g);n&&!Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=o)}),e},Nn=t=>Object.entries(t).filter(([,e])=>e?.length).map(e=>e.flat().join(" ")).join("; "),Vn=t=>{let e=gt(t,"content-security-policy-report-only");e&&delete t[e];let r=gt(t,"content-security-policy");if(r){let n=Bn(t[r][0]),o=(i,...a)=>{n[i]??=[...n["default-src"]??[]],n[i].push(...a)};o("style-src","'unsafe-inline'"),o("script-src","'unsafe-inline'","'unsafe-eval'");for(let i of["style-src","connect-src","img-src","font-src","media-src","worker-src"])o(i,"blob:","data:","vencord:","vesktop:");for(let[i,a]of Object.entries(re.store.customCspRules))for(let s of a)o(s,i);for(let[i,a]of Object.entries(mt))for(let s of a)o(s,i);t[r]=[Nn(n)]}};function yr(){ht.session.defaultSession.webRequest.onHeadersReceived(({responseHeaders:t,resourceType:e},r)=>{if(t&&(e==="mainFrame"&&Vn(t),e==="stylesheet")){let n=gt(t,"content-type");n&&(t[n]=["text/css"])}r({cancel:!1,responseHeaders:t})}),ht.session.defaultSession.webRequest.onHeadersReceived=()=>{}}f();f();Cr();f();Te();var qt=require("electron");f();var Et={};se(Et,{fetchTrackData:()=>Yn});f();Tt();var Fr=require("child_process"),Lr=require("util"),Dr=(0,Lr.promisify)(Fr.execFile);async function bt(t){let{stdout:e}=await Dr("osascript",t.map(r=>["-e",r]).flat());return e}var Q=null;async function Jn({id:t,name:e,artist:r,album:n}){if(t===Q?.id){if("data"in Q)return Q.data;if("failures"in Q&&Q.failures>=5)return null}try{let o=new URL("https://itunes.apple.com/search");o.searchParams.set("term",`${e} ${r} ${n}`),o.searchParams.set("media","music"),o.searchParams.set("entity","song");let i=await fetch(o,{headers:{"user-agent":Ze}}).then(s=>s.json()).then(s=>s.results.find(l=>l.collectionName===n)||s.results[0]),a=await fetch(i.artistViewUrl).then(s=>s.text()).then(s=>{let l=s.match(/<meta property="og:image" content="(.+?)">/);return l?l[1].replace(/[0-9]+x.+/,"220x220bb-60.png"):void 0}).catch(()=>{});return Q={id:t,data:{appleMusicLink:i.trackViewUrl,songLink:`https://song.link/i/${new URL(i.trackViewUrl).searchParams.get("i")}`,albumArtwork:i.artworkUrl100.replace("100x100","512x512"),artistArtwork:a}},Q.data}catch(o){return console.error("[AppleMusicRichPresence] Failed to fetch remote data:",o),Q={id:t,failures:(t===Q?.id&&"failures"in Q?Q.failures:0)+1},null}}async function Yn(){try{await Dr("pgrep",["^Music$"])}catch{return null}if(await bt(['tell application "Music"',"get player state","end tell"]).then(d=>d.trim())!=="playing")return null;let e=await bt(['tell application "Music"',"get player position","end tell"]).then(d=>Number.parseFloat(d.trim())),r=await bt(['set output to ""','tell application "Music"',"set t_id to database id of current track","set t_name to name of current track","set t_album to album of current track","set t_artist to artist of current track","set t_duration to duration of current track",'set output to "" & t_id & "\\n" & t_name & "\\n" & t_album & "\\n" & t_artist & "\\n" & t_duration',"end tell","return output"]),[n,o,i,a,s]=r.split(`
`).filter(d=>!!d),l=Number.parseFloat(s),c=await Jn({id:n,name:o,artist:a,album:i});return{name:o,album:i,artist:a,playerPosition:e,duration:l,...c}}var Ut={};se(Ut,{initDevtoolsOpenEagerLoad:()=>jn});f();function jn(t){let e=()=>t.sender.executeJavaScript("Vencord.Plugins.plugins.ConsoleShortcuts.eagerLoad(true)");t.sender.isDevToolsOpened()?e():t.sender.once("devtools-opened",()=>e())}var Ir={};f();var Je=require("electron"),qe=[];function Pr(){let t=[];for(let e=qe.length-1;e>=0;e--){let{processId:r,routingId:n}=qe[e],o=Je.webFrameMain.fromId(r,n);if(!o){qe.splice(e,1);continue}t.push(o)}return t}Je.app.on("browser-window-created",(t,e)=>{e.webContents.on("frame-created",(r,{frame:n})=>{n?.once("dom-ready",()=>{if(n.url.startsWith("https://open.spotify.com/embed/")){Pr();let{routingId:o,processId:i}=n;qe.push({routingId:o,processId:i});let a=Y.store.plugins?.FixSpotifyEmbeds;if(!a?.enabled)return;n.executeJavaScript(`
                    globalThis._vcVolume = ${a.volume/100};
                    const original = Audio.prototype.play;
                    Audio.prototype.play = function() {
                        this.volume = _vcVolume;
                        return original.apply(this, arguments);
                    }
                `)}})}),Y.addChangeListener("plugins.FixSpotifyEmbeds.volume",r=>{try{Pr().forEach(n=>n.executeJavaScript(`globalThis._vcVolume = ${r/100}`))}catch(n){console.error("FixSpotifyEmbeds: Failed to update volume",n)}})});var $r={};f();var Ar=require("electron");Ar.app.on("browser-window-created",(t,e)=>{e.webContents.on("frame-created",(r,{frame:n})=>{n?.once("dom-ready",()=>{if(n.url.startsWith("https://www.youtube.com/")){if(!Y.store.plugins?.FixYoutubeEmbeds?.enabled)return;n.executeJavaScript(`
                new MutationObserver(() => {
                    if(
                        document.querySelector('div.ytp-error-content-wrap-subreason a[href*="www.youtube.com/watch?v="]')
                    ) location.reload()
                }).observe(document.body, { childList: true, subtree:true });
                `)}})})});var St={};se(St,{resolveRedirect:()=>Xn});f();var kr=require("https"),Kn=/^https:\/\/(spotify\.link|s\.team)\/.+$/;function Or(t){return new Promise((e,r)=>{let n=(0,kr.request)(new URL(t),{method:"HEAD"},o=>{e(o.headers.location?Or(o.headers.location):t)});n.on("error",r),n.end()})}async function Xn(t,e){return Kn.test(e)?Or(e):e}var Rt={};se(Rt,{makeDeeplTranslateRequest:()=>Qn});f();async function Qn(t,e,r,n){let o=e?"https://api.deepl.com/v2/translate":"https://api-free.deepl.com/v2/translate";try{let i=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`DeepL-Auth-Key ${r}`},body:n}),a=await i.text();return{status:i.status,data:a}}catch(i){return{status:-1,data:String(i)}}}var Ct={};se(Ct,{readRecording:()=>eo});f();var Mr=require("electron"),zr=require("fs/promises"),ke=require("path");async function eo(t,e){e=(0,ke.normalize)(e);let r=(0,ke.basename)(e),n=(0,ke.normalize)(Mr.app.getPath("userData")+"/");if(console.log(r,n,e),r!=="recording.ogg"||!e.startsWith(n))return null;try{let o=await(0,zr.readFile)(e);return new Uint8Array(o.buffer)}catch{return null}}var Ft={};se(Ft,{sendToOverlay:()=>to});f();var Br=require("dgram"),_r;function to(t,e){e.messageType=e.type;let r=JSON.stringify(e);_r??=(0,Br.createSocket)("udp4"),_r.send(r,42069,"127.0.0.1")}var Vr={};f();var Nr=require("electron");f();var Lt=`"use strict";const hiddenCSS=["#__ffYoutube1","#__ffYoutube2","#__ffYoutube3","#__ffYoutube4","#feed-pyv-container","#feedmodule-PRO","#homepage-chrome-side-promo","#merch-shelf","#offer-module",'#pla-shelf > ytd-pla-shelf-renderer[class="style-scope ytd-watch"]',"#pla-shelf","#premium-yva","#promo-info","#promo-list","#promotion-shelf","#related > ytd-watch-next-secondary-results-renderer > #items > ytd-compact-promoted-video-renderer.ytd-watch-next-secondary-results-renderer","#search-pva","#shelf-pyv-container","#video-masthead","#watch-branded-actions","#watch-buy-urls","#watch-channel-brand-div","#watch7-branded-banner","#YtKevlarVisibilityIdentifier","#YtSparklesVisibilityIdentifier",".carousel-offer-url-container",".companion-ad-container",".GoogleActiveViewElement",'.list-view[style="margin: 7px 0pt;"]',".promoted-sparkles-text-search-root-container",".promoted-videos",".searchView.list-view",".sparkles-light-cta",".watch-extra-info-column",".watch-extra-info-right",".ytd-carousel-ad-renderer",".ytd-compact-promoted-video-renderer",".ytd-companion-slot-renderer",".ytd-merch-shelf-renderer",".ytd-player-legacy-desktop-watch-ads-renderer",".ytd-promoted-sparkles-text-search-renderer",".ytd-promoted-video-renderer",".ytd-search-pyv-renderer",".ytd-video-masthead-ad-v3-renderer",".ytp-ad-action-interstitial-background-container",".ytp-ad-action-interstitial-slot",".ytp-ad-image-overlay",".ytp-ad-overlay-container",".ytp-ad-progress",".ytp-ad-progress-list",'[class*="ytd-display-ad-"]','[layout*="display-ad-"]','a[href^="http://www.youtube.com/cthru?"]','a[href^="https://www.youtube.com/cthru?"]',"ytd-action-companion-ad-renderer","ytd-banner-promo-renderer","ytd-compact-promoted-video-renderer","ytd-companion-slot-renderer","ytd-display-ad-renderer","ytd-promoted-sparkles-text-search-renderer","ytd-promoted-sparkles-web-renderer","ytd-search-pyv-renderer","ytd-single-option-survey-renderer","ytd-video-masthead-ad-advertiser-info-renderer","ytd-video-masthead-ad-v3-renderer","YTM-PROMOTED-VIDEO-RENDERER"],hideElements=()=>{const e=hiddenCSS;if(!e)return;const t=e.join(", ")+" { display: none!important; }",r=document.createElement("style");r.textContent=t,document.head.appendChild(r)},observeDomChanges=e=>{new MutationObserver(r=>{e(r)}).observe(document.documentElement,{childList:!0,subtree:!0})},hideDynamicAds=()=>{const e=document.querySelectorAll("#contents > ytd-rich-item-renderer ytd-display-ad-renderer");e.length!==0&&e.forEach(t=>{if(t.parentNode&&t.parentNode.parentNode){const r=t.parentNode.parentNode;r.localName==="ytd-rich-item-renderer"&&(r.style.display="none")}})},autoSkipAds=()=>{if(document.querySelector(".ad-showing")){const e=document.querySelector("video");e&&e.duration&&(e.currentTime=e.duration,setTimeout(()=>{const t=document.querySelector("button.ytp-ad-skip-button");t&&t.click()},100))}},overrideObject=(e,t,r)=>{if(!e)return!1;let n=!1;for(const o in e)e.hasOwnProperty(o)&&o===t?(e[o]=r,n=!0):e.hasOwnProperty(o)&&typeof e[o]=="object"&&overrideObject(e[o],t,r)&&(n=!0);return n},jsonOverride=(e,t)=>{const r=JSON.parse;JSON.parse=(...n)=>{const o=r.apply(this,n);return overrideObject(o,e,t),o},Response.prototype.json=new Proxy(Response.prototype.json,{async apply(...n){const o=await Reflect.apply(...n);return overrideObject(o,e,t),o}})};jsonOverride("adPlacements",[]),jsonOverride("playerAds",[]),hideElements(),hideDynamicAds(),autoSkipAds(),observeDomChanges(()=>{hideDynamicAds(),autoSkipAds()});
`;Nr.app.on("browser-window-created",(t,e)=>{e.webContents.on("frame-created",(r,{frame:n})=>{n?.once("dom-ready",()=>{Y.store.plugins?.YoutubeAdblock?.enabled&&(n.url.includes("youtube.com/embed/")?n.executeJavaScript(Lt):n.parent?.url.includes("youtube.com/embed/")&&n.parent.executeJavaScript(Lt))})})});var Wt={};se(Wt,{cancelUpload:()=>go,clearProgress:()=>Me,getLatestProgress:()=>ho,getPendingNotifications:()=>po,pickAndUploadFile:()=>co,uploadFileBuffer:()=>lo,uploadFileCustomNative:()=>Gt,uploadFileTo0x0StNative:()=>Vt,uploadFileToBuzzheavierNative:()=>Nt,uploadFileToCatboxNative:()=>Ot,uploadFileToFileIoNative:()=>ao,uploadFileToFilebinNative:()=>Bt,uploadFileToGofileNative:()=>kt,uploadFileToLitterboxNative:()=>Mt,uploadFileToTempShNative:()=>zt,uploadFileToTmpFilesNative:()=>_t,uploadFileToTransferShNative:()=>so});f();var Ee=we(require("crypto")),ze=require("electron"),N=we(require("fs")),Qe=we(require("http")),ge=we(require("https")),qr=we(require("os")),It=we(require("path")),Ye={errors:0,info:1,debug:2},Dt="errors",At=["Catbox","Litterbox","0x0.st"],Gr="GoFile",ae=1*1024*1024,Wr={none:10*1024*1024,basic:50*1024*1024,full:500*1024*1024};function $t(t){return t.toLowerCase().endsWith(".exe")}function Jr(t,e){return $t(t)&&At.includes(e)?(g.info(`[BigFileUpload] ${e} doesn't support EXE files, using ${Gr} instead`),Gr):e}function Yr(t){if(t==="localhost"||t==="localhost.localdomain")return!0;let e=t.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/);if(e){let[,r,n,o]=e.map(Number);if(r===127||r===10||r===172&&n>=16&&n<=31||r===192&&n===168||r===169&&n===254||r===0||r===255)return!0}return!!(t==="::1"||t==="[::1]"||t.startsWith("fe80:")||t.startsWith("[fe80:")||t.startsWith("fc")||t.startsWith("[fc")||t.startsWith("fd")||t.startsWith("[fd"))}function jr(t){if(!t||typeof t!="string")return!1;try{let e=new URL(t);return e.protocol!=="http:"&&e.protocol!=="https:"?(g.warn(`[BigFileUpload] Invalid URL protocol: ${e.protocol}`),!1):!e.hostname||e.hostname.length<3?(g.warn(`[BigFileUpload] Invalid URL hostname: ${e.hostname}`),!1):Yr(e.hostname)?(g.warn(`[BigFileUpload] Blocked private/reserved IP in URL: ${e.hostname}`),!1):/^\d+$/.test(e.hostname)?(g.warn(`[BigFileUpload] Blocked numeric-only hostname: ${e.hostname}`),!1):e.hostname.includes(".")?!0:(g.warn(`[BigFileUpload] Invalid hostname (no TLD): ${e.hostname}`),!1)}catch{return g.warn(`[BigFileUpload] Invalid URL format: ${t.substring(0,100)}`),!1}}var ro=new Set(["host","connection","upgrade","proxy-authorization","proxy-connection","te","trailer","transfer-encoding","keep-alive","expect","cookie","set-cookie","authorization","www-authenticate","x-forwarded-for","x-forwarded-host","x-forwarded-proto","x-real-ip","forwarded"]);function Pt(t){let e={};for(let[r,n]of Object.entries(t)){let o=r.toLowerCase().trim();if(ro.has(o)){g.warn(`[BigFileUpload] Blocked dangerous header: ${r}`);continue}!r||r.trim()===""||(typeof n=="string"&&!n.includes(`
`)&&!n.includes("\r")?e[r]=n:g.warn(`[BigFileUpload] Blocked header with invalid value: ${r}`))}return e}function Ke(t,e){if(!t||t.trim()==="")return e;try{return JSON.parse(t)}catch{return g.warn(`[BigFileUpload] Failed to parse JSON: ${t.substring(0,100)}`),e}}function Hr(t,e){let r=t;for(let n of e){if(r==null)return;let o=n.match(/^([^\[]+)\[(\d+)\]$/);if(o){let[,i,a]=o;if(i&&(r=r[i],r==null))return;r=r[parseInt(a,10)]}else/^\d+$/.test(n)&&Array.isArray(r)?r=r[parseInt(n,10)]:r=r[n]}return r}function no(t,e,r,n){let o=t.trim();if(e==="JSON"||e==="Text"&&o.startsWith("{")||o.startsWith("["))try{let s=JSON.parse(o);if(r.length>0){let c=Hr(s,r);if(typeof c=="string"&&c.length>0)return je(c,n)}let l=[["url"],["link"],["href"],["file"],["download"],["data","url"],["data","link"],["data","file"],["result","url"],["result","link"],["response","url"],["response","link"],["files","0","url"],["files","0","link"],["image","url"],["image","link"],["upload","url"],["upload","link"]];for(let c of l){let d=Hr(s,c);if(typeof d=="string"&&(d.startsWith("http")||d.startsWith("/")))return g.debug(`[BigFileUpload] Auto-detected URL at path: ${c.join(".")}`),je(d,n)}if(typeof s=="string"&&(s.startsWith("http")||s.startsWith("/")))return je(s,n);throw new Error("Could not find URL in JSON response. Try specifying a URL path.")}catch(s){if(e==="JSON")throw s}if(o.startsWith("http://")||o.startsWith("https://")){let s=o.split(/[\r\n]/)[0].trim();if(s.startsWith("http"))return s}let i=/https?:\/\/[^\s<>"')\]]+/gi,a=o.match(i);if(a&&a.length>0){let s=a.reduce((l,c)=>l.length>=c.length?l:c);return g.debug(`[BigFileUpload] Extracted URL from text response: ${s}`),s}return o.startsWith("/")&&n?je(o,n):o}function je(t,e){if(!t)return"";if(t.startsWith("http://")||t.startsWith("https://"))return t;if(e)try{let r=new URL(e);return t.startsWith("/")?`${r.protocol}//${r.host}${t}`:new URL(t,e).href}catch{}return t}var g={info:(...t)=>{Ye[Dt]>=Ye.info&&console.log(...t)},debug:(...t)=>{Ye[Dt]>=Ye.debug&&console.debug(...t)},warn:(...t)=>console.warn(...t),error:(...t)=>console.error(...t)};function Kr(t){Dt=t??"errors"}async function ee(t,e){let r=qr.default.tmpdir(),o=`vencord-upload-${`${Date.now()}-${Ee.default.randomBytes(8).toString("hex")}`}-${e}`,i=It.default.join(r,o);return await N.default.promises.writeFile(i,Buffer.from(t)),i}async function Zr(t){return t.length===0?null:new Promise(e=>{let r=!1,n=t.length;for(let o of t)o.then(i=>{!r&&i!==null?(r=!0,e(i)):(n--,n===0&&!r&&e(null))}).catch(()=>{n--,n===0&&!r&&e(null)})})}async function z(t){try{await N.default.promises.unlink(t),g.debug(`[BigFileUpload] Temp file deleted: ${t}`)}catch(e){let r=e instanceof Error?e.message:String(e);g.debug(`[BigFileUpload] Failed to delete temp file ${t}: ${r}`)}}async function oo(){return"https://upload.gofile.io/uploadfile"}function Xr(t,e,r,n={},o,i,a=3e5){let s=!1;return new Promise((l,c)=>{let d=new URL(t),u=d.protocol==="https:",w=u?ge.default:Qe.default;if(!N.default.existsSync(e)){c(new Error(`File not found: ${e}`));return}let R=N.default.statSync(e).size;if(R===0){c(new Error(`File is empty (0 bytes): ${e}`));return}try{N.default.accessSync(e,N.default.constants.R_OK)}catch{c(new Error(`File is not readable: ${e}`));return}let U={hostname:d.hostname,port:d.port||(u?443:80),path:d.pathname+d.search,method:"PUT",headers:{"Content-Type":"application/octet-stream","Content-Length":R,...n}};u&&(U.agent=new ge.default.Agent({keepAlive:!0,timeout:3e4,rejectUnauthorized:!0}));let T=Date.now(),C=Date.now(),p=0,v=setInterval(()=>{Date.now()-C>3e5&&(clearInterval(v),m.destroy(),c(new Error("Upload stalled - no progress for 5 minutes")))},1e4),m=w.request(U,y=>{let E="",P=!1;y.socket.setTimeout(6e4),y.on("data",h=>{if(E.length+h.length>ae){P||(g.warn(`[BigFileUpload] Response exceeded ${ae} bytes, truncating`),P=!0);return}E+=h}),y.on("end",()=>{if(clearInterval(v),i&&J.delete(i),i&&W.has(i)){W.delete(i),c(new Error("Upload cancelled by user"));return}if(P){c(new Error(`Response exceeded maximum size (${ae} bytes) and was truncated. The upload may have succeeded but the response could not be processed.`));return}if(y.statusCode&&y.statusCode>=200&&y.statusCode<300)i&&W.delete(i),l(E);else{let h=`HTTP ${y.statusCode}: ${y.statusMessage}`;y.statusCode===500?h="HTTP 500: Server Internal Error - The upload service is experiencing issues. Try using a different uploader (temp.sh, Catbox, 0x0.st, or file.io).":y.statusCode===502||y.statusCode===503||y.statusCode===504?h=`HTTP ${y.statusCode}: Service Unavailable - The upload service is temporarily down or overloaded. Try using a different uploader.`:y.statusCode===429?h="HTTP 429: Rate Limited - Too many requests. Please wait before trying again.":y.statusCode===413&&(h="HTTP 413: File Too Large - The file exceeds the service's size limit."),E&&E.length>0&&E.length<500&&(h+=`
Server response: ${E}`),c(new Error(h))}})});m.setTimeout(a),m.on("timeout",()=>{clearInterval(v),i&&J.delete(i),m.destroy(),c(new Error("Request timeout - The server took too long to respond."))}),m.on("error",y=>{if(clearInterval(v),i&&J.delete(i),s)c(new Error("Upload cancelled by user"));else{let E=y.message||String(y);if(E.includes("ECONNRESET")||E.includes("Client network socket disconnected")){let P=t.includes("0x0.st")?"0x0.st":t.includes("tmpfiles.org")?"tmpfiles.org":t.includes("catbox")?"Catbox/Litterbox":"the upload service",h="";t.includes("catbox")||t.includes("litterbox")?h="Please try using: 0x0.st, tmpfiles.org, temp.sh, file.io, or transfer.sh instead.":t.includes("0x0.st")||t.includes("tmpfiles")?h="Please try using: Catbox, Litterbox, temp.sh, file.io, or transfer.sh instead.":h="Please try using a different uploader service.",c(new Error(`Connection blocked to ${P} - This could mean:
1. Your network/firewall is blocking SSL/TLS connections to this service
2. The service is blocked by your ISP or organization
3. There's a proxy interfering with the connection

Try using a VPN, proxy, or connecting from a different network.

`+h))}else if(E.includes("ETIMEDOUT"))c(new Error("Connection timed out - The upload service did not respond in time. Try again or use a different uploader."));else if(E.includes("ENOTFOUND"))c(new Error("Service not found - Cannot reach the upload service. Check your internet connection."));else if(E.includes("EPIPE")||E.includes("ECONNABORTED"))c(new Error("Connection aborted - The server terminated the connection. This may be due to file size limits or server issues. Try a different uploader."));else if(E.includes("self signed certificate")||E.includes("SELF_SIGNED")||E.includes("UNABLE_TO_VERIFY_LEAF_SIGNATURE")||E.includes("DEPTH_ZERO_SELF_SIGNED_CERT")){let P=t.includes("0x0.st")?"0x0.st":t.includes("tmpfiles.org")?"tmpfiles.org":t.includes("catbox")?"Catbox/Litterbox":t.includes("temp.sh")?"temp.sh":t.includes("filebin.net")?"filebin.net":t.includes("buzzheavier")?"buzzheavier.com":t.includes("gofile")?"GoFile":"the upload service";c(new Error(`SSL certificate error with ${P} - You may be behind a corporate firewall or proxy that uses self-signed certificates. The plugin will try alternative uploaders automatically.`))}else c(y)}});let b=()=>{if(i&&W.has(i))return;let y=(Date.now()-T)/1e3,E=p/y/1024/1024,P=p/R*100,h=y>0?(R-p)/(p/y):0;o&&!o.isDestroyed()&&i&&(k={uploadId:i,fileName:r,loaded:p,total:R,percent:P,speed:E,eta:h})},F=N.default.createReadStream(e,{highWaterMark:256*1024}),x=0;F.on("data",y=>{if(s){F.destroy();return}let E=m.write(y);p+=y.length,C=Date.now();let P;R>100*1024*1024?P=5*1024*1024:R>10*1024*1024?P=2*1024*1024:P=512*1024,(p-x>=P||p===y.length)&&(b(),x=p),E||(F.pause(),m.once("drain",()=>{F.resume()}))}),F.on("end",()=>{if(s){m.destroy();return}b(),m.end()}),F.on("error",y=>{clearInterval(v),m.destroy(),c(y)}),i&&J.set(i,{req:m,cleanup:()=>{s=!0,clearInterval(v);try{F.destroy()}catch{}try{m.socket&&m.socket.destroy(),m.destroy()}catch{}}})})}function io(t,e,r,n,o,i={},a,s,l=3e5){let c=!1;return new Promise((d,u)=>{let w=new URL(t),A=w.protocol==="https:",R=A?ge.default:Qe.default;if(Yr(w.hostname)){u(new Error(`Custom uploader: Blocked request to private/reserved IP: ${w.hostname}`));return}if(!N.default.existsSync(e)){u(new Error(`File not found: ${e}`));return}let T=N.default.statSync(e).size;if(T===0){u(new Error(`File is empty (0 bytes): ${e}`));return}try{N.default.accessSync(e,N.default.constants.R_OK)}catch{u(new Error(`File is not readable: ${e}`));return}let C=Pt(i),p={hostname:w.hostname,port:w.port||(A?443:80),path:w.pathname+w.search,method:o,headers:{"Content-Type":n||"application/octet-stream","Content-Length":T,"User-Agent":"Vencord-BigFileUpload/1.0",...C}};A&&(p.agent=new ge.default.Agent({keepAlive:!0,timeout:3e4,rejectUnauthorized:!0}));let v=Date.now(),m=Date.now(),b=0,F=setInterval(()=>{Date.now()-m>3e5&&(clearInterval(F),x.destroy(),u(new Error("Upload stalled - no progress for 5 minutes")))},1e4),x=R.request(p,h=>{let I="",H=!1;h.socket.setTimeout(6e4),h.on("data",_=>{if(I.length+_.length>ae){H||(g.warn(`[BigFileUpload] Response exceeded ${ae} bytes, truncating`),H=!0);return}I+=_}),h.on("end",()=>{if(clearInterval(F),s&&J.delete(s),s&&W.has(s)){W.delete(s),u(new Error("Upload cancelled by user"));return}if(H){u(new Error(`Response exceeded maximum size (${ae} bytes) and was truncated.`));return}if(h.statusCode&&h.statusCode>=200&&h.statusCode<300)s&&W.delete(s),d(I);else{let _=`HTTP ${h.statusCode}: ${h.statusMessage}`;h.statusCode===500?_="HTTP 500: Server Internal Error - The custom upload service is experiencing issues.":h.statusCode===502||h.statusCode===503||h.statusCode===504?_=`HTTP ${h.statusCode}: Service Unavailable - The custom upload service is temporarily down.`:h.statusCode===429?_="HTTP 429: Rate Limited - Too many requests to the custom uploader.":h.statusCode===413&&(_="HTTP 413: File Too Large - The file exceeds the custom service's size limit."),I&&I.length>0&&I.length<500&&(_+=`
Server response: ${I}`),u(new Error(_))}})});x.setTimeout(l),x.on("timeout",()=>{clearInterval(F),s&&J.delete(s),x.destroy(),u(new Error("Request timeout - The custom uploader took too long to respond."))}),x.on("error",h=>{clearInterval(F),s&&J.delete(s),u(c?new Error("Upload cancelled by user"):h)});let y=()=>{if(s&&W.has(s))return;let h=(Date.now()-v)/1e3,I=b/h/1024/1024,H=b/T*100,_=h>0?(T-b)/(b/h):0;a&&!a.isDestroyed()&&s&&(k={uploadId:s,fileName:r,loaded:b,total:T,percent:H,speed:I,eta:_})},E=N.default.createReadStream(e,{highWaterMark:256*1024}),P=0;E.on("data",h=>{if(c){E.destroy();return}let I=x.write(h);b+=h.length,m=Date.now();let H;T>100*1024*1024?H=5*1024*1024:T>10*1024*1024?H=2*1024*1024:H=512*1024,(b-P>=H||b===h.length)&&(y(),P=b),I||(E.pause(),x.once("drain",()=>{E.resume()}))}),E.on("end",()=>{if(c){x.destroy();return}y(),x.end()}),E.on("error",h=>{clearInterval(F),x.destroy(),u(h)}),s&&J.set(s,{req:x,cleanup:()=>{c=!0,clearInterval(F);try{E.destroy()}catch{}try{x.socket&&x.socket.destroy(),x.destroy()}catch{}}})})}function le(t,e,r,n,o,i,a={},s,l,c=3e5){let d=!1;return new Promise((u,w)=>{let A=`----WebKitFormBoundary${Ee.default.randomBytes(16).toString("hex")}`,R=new URL(t),U=R.protocol==="https:",T=U?ge.default:Qe.default;if(!N.default.existsSync(e)){w(new Error(`File not found: ${e}`));return}let p=N.default.statSync(e).size;if(p===0){w(new Error(`File is empty (0 bytes): ${e}`));return}try{N.default.accessSync(e,N.default.constants.R_OK)}catch{w(new Error(`File is not readable: ${e}`));return}let v=[];for(let[S,O]of Object.entries(i))S&&S.trim()!==""&&v.push(Buffer.from(`--${A}\r
Content-Disposition: form-data; name="${S}"\r
\r
${O}\r
`));v.push(Buffer.from(`--${A}\r
Content-Disposition: form-data; name="${o}"; filename="${r}"\r
Content-Type: ${n||"application/octet-stream"}\r
\r
`));let m=Buffer.concat(v),b=Buffer.from(`\r
--${A}--\r
`),F=m.length+p+b.length,x={hostname:R.hostname,port:R.port||(U?443:80),path:R.pathname+R.search,method:"POST",headers:{"Content-Type":`multipart/form-data; boundary=${A}`,"Content-Length":F,...a}};U&&(x.agent=new ge.default.Agent({keepAlive:!0,timeout:3e4,rejectUnauthorized:!0}));let y=Date.now(),E=Date.now(),P=0,h=setInterval(()=>{Date.now()-E>3e5&&(clearInterval(h),I.destroy(),w(new Error("Upload stalled - no progress for 5 minutes")))},1e4),I=T.request(x,S=>{let O="",M=!1;S.socket.setTimeout(6e4),S.on("data",V=>{if(O.length+V.length>ae){M||(g.warn(`[BigFileUpload] Response exceeded ${ae} bytes, truncating`),M=!0);return}O+=V}),S.on("end",()=>{if(clearInterval(h),l&&J.delete(l),l&&W.has(l)){W.delete(l),w(new Error("Upload cancelled by user"));return}if(M){w(new Error(`Response exceeded maximum size (${ae} bytes) and was truncated. The upload may have succeeded but the response could not be processed.`));return}if(S.statusCode&&S.statusCode>=200&&S.statusCode<300)l&&W.delete(l),u(O);else{let V=`HTTP ${S.statusCode}: ${S.statusMessage}`;S.statusCode===500?V="HTTP 500: Server Internal Error - The upload service is experiencing issues. This is a server-side problem, not a client error.":S.statusCode===502||S.statusCode===503||S.statusCode===504?V=`HTTP ${S.statusCode}: Service Unavailable - The upload service is temporarily down or overloaded.`:S.statusCode===429?V="HTTP 429: Rate Limited - Too many requests. Please wait before trying again.":S.statusCode===413?V="HTTP 413: File Too Large - The file exceeds the service's size limit.":S.statusCode&&S.statusCode>=400&&S.statusCode<500&&(V=`HTTP ${S.statusCode}: Client Error - ${S.statusMessage}`),O&&O.length>0&&O.length<500&&(V+=`
Server response: ${O}`),w(new Error(V))}})});I.setTimeout(c),I.on("timeout",()=>{clearInterval(h),l&&J.delete(l),I.destroy(),w(new Error("Request timeout - The server took too long to respond."))}),I.on("error",S=>{if(clearInterval(h),l&&J.delete(l),d)w(new Error("Upload cancelled by user"));else{let O=S.message||String(S);if(O.includes("ECONNRESET")||O.includes("Client network socket disconnected")){let M=t.includes("0x0.st")?"0x0.st":t.includes("tmpfiles.org")?"tmpfiles.org":t.includes("catbox")?"Catbox/Litterbox":"the upload service",V="";t.includes("catbox")||t.includes("litterbox")?V="Please try using: 0x0.st, tmpfiles.org, temp.sh, file.io, or transfer.sh instead.":t.includes("0x0.st")||t.includes("tmpfiles")?V="Please try using: Catbox, Litterbox, temp.sh, file.io, or transfer.sh instead.":V="Please try using a different uploader service.",w(new Error(`Connection blocked to ${M} - This could mean:
1. Your network/firewall is blocking SSL/TLS connections to this service
2. The service is blocked by your ISP or organization
3. There's a proxy interfering with the connection

Try using a VPN, proxy, or connecting from a different network.

`+V))}else if(O.includes("ETIMEDOUT"))w(new Error("Connection timed out - The upload service did not respond in time. Try again or use a different uploader."));else if(O.includes("ENOTFOUND"))w(new Error("Service not found - Cannot reach the upload service. Check your internet connection."));else if(O.includes("EPIPE")||O.includes("ECONNABORTED"))w(new Error("Connection aborted - The server terminated the connection. This may be due to file size limits or server issues. Try a different uploader."));else if(O.includes("self signed certificate")||O.includes("SELF_SIGNED")||O.includes("UNABLE_TO_VERIFY_LEAF_SIGNATURE")||O.includes("DEPTH_ZERO_SELF_SIGNED_CERT")){let M=t.includes("0x0.st")?"0x0.st":t.includes("tmpfiles.org")?"tmpfiles.org":t.includes("catbox")?"Catbox/Litterbox":t.includes("temp.sh")?"temp.sh":t.includes("filebin.net")?"filebin.net":t.includes("buzzheavier")?"buzzheavier.com":t.includes("gofile")?"GoFile":"the upload service";w(new Error(`SSL certificate error with ${M} - You may be behind a corporate firewall or proxy that uses self-signed certificates. The plugin will try alternative uploaders automatically.`))}else w(S)}});let H=()=>{if(l&&W.has(l))return;let S=(Date.now()-y)/1e3,O=P/S/1024/1024,M=P/F*100,V=S>0?(F-P)/(P/S):0;s&&!s.isDestroyed()&&l&&(k={uploadId:l,fileName:r,loaded:P,total:F,percent:M,speed:O,eta:V})};I.write(m),P+=m.length,E=Date.now();let _=N.default.createReadStream(e,{highWaterMark:256*1024}),Le=0,X=0;_.on("data",S=>{if(d){_.destroy();return}let O=I.write(S);P+=S.length,X+=S.length,E=Date.now();let M;p>100*1024*1024?M=5*1024*1024:p>10*1024*1024?M=2*1024*1024:M=512*1024,(X-Le>=M||X===S.length)&&(H(),Le=X),O||(_.pause(),I.once("drain",()=>{_.resume()}))}),_.on("end",()=>{if(d){I.destroy();return}I.write(b),P+=b.length,E=Date.now(),H(),p<1024*1024?setTimeout(()=>{I.end()},100):I.end()}),_.on("error",S=>{clearInterval(h),I.destroy(),w(S)}),l&&J.set(l,{req:I,cleanup:()=>{d=!0,clearInterval(h);try{_.destroy()}catch{}try{I.socket&&I.socket.destroy(),I.destroy()}catch{}}})})}async function kt(t,e,r,n,o,i=3e5){let a,s=!1;try{if(typeof e=="string"?a=e:(a=await ee(e,r),s=!0),!a)throw new Error("Failed to resolve file path for GoFile upload");let l={};n&&(l.token=n);let c=await oo(),d=await le(c,a,r,"application/octet-stream","file",l,{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,o,i),u=JSON.parse(d);return s&&await z(a),u}catch(l){throw s&&a&&await z(a),l}}async function Ot(t,e,r,n,o,i,a,s=3e5){let l,c=!1;try{if(typeof r=="string"?l=r:(l=await ee(r,n),c=!0),!l)throw new Error("Failed to resolve file path for Catbox upload");let d={reqtype:"fileupload"},u=i?.trim();u&&(d.userhash=u);let w=await le(e,l,n,o,"fileToUpload",d,{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,a,s);return c&&await z(l),w}catch(d){throw c&&l&&await z(l),d}}async function Mt(t,e,r,n,o,i,a=3e5){let s,l=!1;try{if(typeof e=="string"?s=e:(s=await ee(e,r),l=!0),!s)throw new Error("Failed to resolve file path for Litterbox upload");let d=await le("https://litterbox.catbox.moe/resources/internals/api.php",s,r,n,"fileToUpload",{reqtype:"fileupload",time:o},{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,i,a);return l&&await z(s),d}catch(c){throw l&&s&&await z(s),c}}async function so(t,e,r,n,o,i,a=3e5){let s,l=!1;try{if(typeof e=="string"?s=e:(s=await ee(e,r),l=!0),!s)throw new Error("Failed to resolve file path for transfer.sh upload");let c={"User-Agent":"Vencord-BigFileUpload/1.0"};n&&n.trim()!==""&&(c["Max-Days"]=n),o&&o.trim()!==""&&(c["Max-Downloads"]=o);let d=await Xr(`https://transfer.sh/${encodeURIComponent(r)}`,s,r,c,t.sender,i,a);return l&&await z(s),d.trim()}catch(c){throw l&&s&&await z(s),c}}async function zt(t,e,r,n,o=3e5){let i,a=!1;try{if(typeof e=="string"?i=e:(i=await ee(e,r),a=!0),!i)throw new Error("Failed to resolve file path for temp.sh upload");let s=await le("https://temp.sh/upload",i,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,n,o);return a&&await z(i),s.trim()}catch(s){throw a&&i&&await z(i),s}}async function _t(t,e,r,n,o=3e5){let i,a=!1;try{if(typeof e=="string"?i=e:(i=await ee(e,r),a=!0),!i)throw new Error("Failed to resolve file path for tmpfiles.org upload");let s=await le("https://tmpfiles.org/api/v1/upload",i,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,n,o),l=JSON.parse(s);if(l.status==="success"&&l.data?.url){a&&await z(i);let c=l.data.url;return c.includes("tmpfiles.org/")&&!c.includes("/dl/")&&(c=c.replace(/tmpfiles\.org\/(\d+)/,"tmpfiles.org/dl/$1")),c}else throw new Error(`tmpfiles.org upload failed: ${s}`)}catch(s){throw a&&i&&await z(i),s}}async function Bt(t,e,r,n,o=3e5){let i,a=!1;try{if(typeof e=="string"?i=e:(i=await ee(e,r),a=!0),!i)throw new Error("Failed to resolve file path for filebin.net upload");let s=Ee.default.randomBytes(6).toString("hex");return await le(`https://filebin.net/${s}/${encodeURIComponent(r)}`,i,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,n,o),a&&await z(i),`https://filebin.net/${s}/${encodeURIComponent(r)}`}catch(s){throw a&&i&&await z(i),s}}async function Nt(t,e,r,n,o=3e5){let i,a=!1;try{if(typeof e=="string"?i=e:(i=await ee(e,r),a=!0),!i)throw new Error("Failed to resolve file path for buzzheavier.com upload");let s=await Xr(`https://w.buzzheavier.com/${encodeURIComponent(r)}`,i,r,{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,n,o);a&&await z(i);try{let l=JSON.parse(s);if(l.code===201&&l.data?.id)return`https://buzzheavier.com/${l.data.id}`;throw new Error(`Unexpected buzzheavier.com response: ${s}`)}catch{return s.trim()}}catch(s){throw a&&i&&await z(i),s}}async function ao(t,e,r,n,o,i=3e5){let a,s=!1;try{if(typeof e=="string"?a=e:(a=await ee(e,r),s=!0),!a)throw new Error("Failed to resolve file path for file.io upload");let l="https://file.io/";n&&n.trim()!==""&&(l+=`?expires=${encodeURIComponent(n)}`);let c=await le(l,a,r,"application/octet-stream","file",{},{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,o,i),d=JSON.parse(c);if(d.success&&d.link)return s&&await z(a),d.link;throw new Error(`file.io upload failed: ${c}`)}catch(l){throw s&&a&&await z(a),l}}async function Vt(t,e,r,n,o,i=3e5){let a,s=!1;try{if(typeof e=="string"?a=e:(a=await ee(e,r),s=!0),!a)throw new Error("Failed to resolve file path for 0x0.st upload");let l={};n&&n.trim()!==""&&(l.expires=n);let c=await le("https://0x0.st",a,r,"application/octet-stream","file",l,{"User-Agent":"VencordBigFileUpload/1.0"},t.sender,o,i);return s&&await z(a),c.trim()}catch(l){throw s&&a&&await z(a),l}}async function Gt(t,e,r,n,o,i,a,s,l,c,d,u,w,A=3e5){let R,U=!1,T=u||"POST",C=w||"MultipartFormData";try{if(typeof r=="string"?R=r:(R=await ee(r,n),U=!0),!R)throw new Error("Failed to resolve file path for custom upload");let p;if(C==="Binary"){g.info(`[BigFileUpload] Custom uploader using ${T} with binary body`);let m=Pt(s);p=await io(e,R,n,o,T,m,t.sender,d,A)}else{g.info("[BigFileUpload] Custom uploader using POST with multipart form data");let m={};for(let[F,x]of Object.entries(a))F&&F.trim()!==""&&(m[F]=x);let b=Pt(s);delete b["Content-Type"],delete b["content-type"],p=await le(e,R,n,o,i,m,{...b,"User-Agent":"Vencord-BigFileUpload/1.0"},t.sender,d,A)}let v=no(p,l,c,e);return U&&await z(R),v}catch(p){throw U&&R&&await z(R),p}}async function lo(t,e,r,n,o){Kr(o.loggingLevel),g.info(`[BigFileUpload NATIVE] uploadFileBuffer called for: ${r} (type: ${n})`),g.info(`[BigFileUpload NATIVE] Received uploader setting: "${o.fileUploader}"`);try{let i=e.byteLength;g.info(`[BigFileUpload] Uploading from buffer: ${r} (${(i/1024/1024).toFixed(1)}MB)`);let a=["Catbox","Litterbox","0x0.st","tmpfiles.org","GoFile","buzzheavier.com","temp.sh","filebin.net"],s=o.fileUploader||"Catbox",l=Jr(r,s);g.info(`[BigFileUpload NATIVE] Primary uploader will be: ${l}`);let c=[l],d=$t(r);for(let T of a)T!==l&&T!=="Custom"&&!(d&&At.includes(T))&&c.push(T);l==="Custom"&&c.length===1&&c.push(d?"GoFile":"Catbox"),g.info(`[BigFileUpload] Will try uploaders in order: ${c.join(", ")}`);let u=`upload-${Ee.default.randomUUID()}`;g.debug(`[BigFileUpload NATIVE] Upload ID: ${u}`),W.delete(u),k={uploadId:u,fileName:r,fileSize:i,loaded:0,total:i,percent:0,speed:0,eta:0},ne=Date.now();let w=async(T,C=!1)=>{let p;switch(T){case"GoFile":{let v=await kt(t,e,r,o.gofileToken,C?void 0:u,o.uploadTimeout);if(v.status==="ok"&&v.data){let m=v.data.downloadPage||(v.data.code?`https://gofile.io/d/${v.data.code}`:void 0);if(!m)throw new Error(`GoFile response missing download URL: ${JSON.stringify(v)}`);p=m}else throw new Error(`GoFile upload failed: ${v.error||JSON.stringify(v)}`);break}case"Catbox":{p=await Ot(t,"https://catbox.moe/user/api.php",e,r,n||"application/octet-stream",o.catboxUserHash||"",C?void 0:u,o.uploadTimeout);break}case"Litterbox":{p=await Mt(t,e,r,n||"application/octet-stream",o.litterboxTime||"1h",C?void 0:u,o.uploadTimeout);break}case"temp.sh":{p=await zt(t,e,r,C?void 0:u,o.uploadTimeout);break}case"0x0.st":{p=await Vt(t,e,r,o.zeroX0Expires,C?void 0:u,o.uploadTimeout);break}case"tmpfiles.org":{p=await _t(t,e,r,C?void 0:u,o.uploadTimeout);break}case"filebin.net":{p=await Bt(t,e,r,C?void 0:u,o.uploadTimeout);break}case"buzzheavier.com":{p=await Nt(t,e,r,C?void 0:u,o.uploadTimeout);break}case"Custom":{if(!o.customUploaderRequestURL||o.customUploaderRequestURL.trim()==="")throw new Error("Custom uploader not configured - skipping to next uploader");if(C)throw new Error("Custom uploader cannot be retried in background");let v=Ke(o.customUploaderArgs,{}),m=Ke(o.customUploaderHeaders,{}),b=(o.customUploaderURL||"").split(".").filter(F=>F);p=await Gt(t,o.customUploaderRequestURL,e,r,n||"application/octet-stream",o.customUploaderFileFormName||"file",v,m,o.customUploaderResponseType||"Text",b,u,o.customUploaderRequestMethod,o.customUploaderBodyType,o.uploadTimeout);break}default:throw new Error(`Unknown uploader: ${T}`)}if(!jr(p))throw new Error(`Invalid URL received from ${T}: ${p.substring(0,100)}`);return p},A=[],R=null,U=[];for(let T of c){let C=U.length+1,p=c.length;if(g.info(`[BigFileUpload] Trying uploader: ${T} (attempt ${C}/${p})`),C===1?g.info(`[BigFileUpload] Starting upload to ${T}`):g.info(`[BigFileUpload] Retrying with ${T} (attempt ${C}/${p})`),A.length>0){let v=await Zr(A.map(m=>m.promise));if(v){g.info(`[BigFileUpload] \u2705 Background retry succeeded with ${v.uploader}!`);let m=v.url;return o.autoFormat==="Yes"&&(m=`[${r}](${v.url})`),{success:!0,url:m,fileName:r,fileSize:i,uploadId:u,actualUploader:v.uploader,attemptedUploaders:[...U,v.uploader]}}}try{g.debug(`[BigFileUpload NATIVE] Trying ${T}`);let v=await w(T,!1),m=v;return o.autoFormat==="Yes"&&(m=`[${r}](${v})`),g.info(`[BigFileUpload] \u2705 Upload successful with ${T}! File: ${r} (${(i/1024/1024).toFixed(2)}MB) \u2192 ${v}`),{success:!0,url:m,fileName:r,fileSize:i,uploadId:u,actualUploader:T,attemptedUploaders:[...U,T]}}catch(v){let m=v instanceof Error?v.message:String(v);if(m.toLowerCase().includes("upload cancelled by user"))return g.info("[BigFileUpload] Upload cancelled by user, aborting retries"),Me(),{success:!1,error:"Upload cancelled by user",attemptedUploaders:U};g.error(`[BigFileUpload] Upload failed with ${T}:`,v),R=new Error(`[${T}] ${m}`),U.push(T),g.debug(`[BigFileUpload] Error details for ${T}: ${m}`);let b=m;m.length>100&&(b=m.substring(0,100)+"...");let F=U.length>=c.length;if(t.sender&&!t.sender.isDestroyed())if(F)Xe(t,{type:"failure",message:`${T} failed: ${b}`});else{let x=c[U.length];Xe(t,{type:"failure",message:`${T} failed: ${b}. Trying ${x}...`})}if(T!=="Custom"&&!A.some(x=>x.uploader===T)){g.info(`[BigFileUpload] Starting background retry for ${T}`);let x=(async()=>{await new Promise(y=>setTimeout(y,1e3));try{let y=await w(T,!0);return g.info(`[BigFileUpload] Background retry succeeded for ${T}`),{url:y,uploader:T}}catch(y){return g.debug(`[BigFileUpload] Background retry failed for ${T}:`,y),null}})();A.push({uploader:T,promise:x})}if(!F){let x=c[U.length];g.warn(`[BigFileUpload] ${T} failed. Trying ${x}...`),k&&k.uploadId===u&&(k={...k,loaded:0,percent:0,speed:0,eta:0},ne=Date.now())}if(m.toLowerCase().includes("read")&&m.toLowerCase().includes("image")?g.error(`[BigFileUpload] IMAGE READ ERROR from ${T}: ${m}`):m.includes("412")||m.includes("415")||m.includes("Bad file type")||m.includes("Unsupported Media Type")?g.warn(`[BigFileUpload] File type rejected by ${T}`):(m.includes("File not found")||m.includes("empty")||m.includes("not readable"))&&g.error(`[BigFileUpload] FILE ACCESS ERROR: ${m}`),F){g.info("[BigFileUpload] All primary uploaders exhausted, waiting for background retries...");let x=await Promise.race([Zr(A.map(y=>y.promise)),new Promise(y=>setTimeout(()=>y(null),3e4))]);if(x){g.info(`[BigFileUpload] \u2705 Background retry saved the day with ${x.uploader}!`);let y=x.url;return o.autoFormat==="Yes"&&(y=`[${r}](${x.url})`),{success:!0,url:y,fileName:r,fileSize:i,uploadId:u,actualUploader:x.uploader,attemptedUploaders:[...U,x.uploader]}}g.warn("[BigFileUpload] No more uploaders to try and no background retries succeeded");break}}}return g.error(`[BigFileUpload] All uploaders failed. Attempted: ${U.join(", ")}`),Me(),{success:!1,error:`All upload services failed. Last error: ${R?.message||"Connection issue"}. Tried: ${U.join(", ")}`}}catch(i){return g.error("[BigFileUpload] Unexpected error in uploadFileBuffer:",i),Me(),{success:!1,error:`Unexpected error: ${i instanceof Error?i.message:String(i)}. Please try again.`}}}async function co(t,e){Kr(e.loggingLevel);let r=ze.BrowserWindow.fromWebContents(t.sender),n={title:"Select file to upload",properties:["openFile","dontAddToRecent"]},{canceled:o,filePaths:i}=r?await ze.dialog.showOpenDialog(r,n):await ze.dialog.showOpenDialog(n);if(o||i.length===0)return{success:!1,error:"File selection cancelled"};let a=i[0],s=It.default.basename(a),c=(await N.default.promises.stat(a)).size;if(e.respectNitroLimit){let p=Wr[e.nitroTier||"none"]||Wr.none;if(c<=p){g.info(`[BigFileUpload] File under Nitro limit (${(c/1024/1024).toFixed(1)}MB <= ${(p/1024/1024).toFixed(0)}MB), using Discord native upload`);let v=await N.default.promises.readFile(a);return{success:!0,useNativeUpload:!0,fileName:s,fileSize:c,buffer:v.buffer.slice(v.byteOffset,v.byteOffset+v.byteLength)}}}g.info(`[BigFileUpload] Securely uploading: ${s} (${(c/1024/1024).toFixed(1)}MB)`),g.debug(`[BigFileUpload] File path (main process only): ${a}`);let d=["Catbox","Litterbox","0x0.st","tmpfiles.org","GoFile","buzzheavier.com","temp.sh","filebin.net"],u=e.fileUploader||"Catbox",w=Jr(s,u),A=$t(s),R=[w];for(let p of d)p!==w&&p!=="Custom"&&!(A&&At.includes(p))&&R.push(p);g.info(`[BigFileUpload] Will try uploaders in order: ${R.join(", ")}`);let U=`upload-${Ee.default.randomUUID()}`;W.delete(U),k={uploadId:U,fileName:s,fileSize:c,loaded:0,total:c,percent:0,speed:0,eta:0},ne=Date.now();let T=null,C=[];for(let p of R){let v=C.length+1,m=R.length;g.info(`[BigFileUpload] Trying uploader: ${p} (attempt ${v}/${m})`),v===1?g.info(`[BigFileUpload] Starting upload to ${p}`):g.info(`[BigFileUpload] Retrying with ${p} (attempt ${v}/${m})`);try{let b;switch(p){case"GoFile":{g.debug("[BigFileUpload] Trying GoFile");let x=await kt(t,a,s,e.gofileToken,U,e.uploadTimeout);if(x.status==="ok"&&x.data){let y=x.data.downloadPage||(x.data.code?`https://gofile.io/d/${x.data.code}`:void 0);if(!y)throw new Error(`GoFile response missing download URL: ${JSON.stringify(x)}`);b=y}else throw new Error(`GoFile upload failed: ${x.error||JSON.stringify(x)}`);break}case"Catbox":{g.debug("[BigFileUpload] Trying Catbox"),b=await Ot(t,"https://catbox.moe/user/api.php",a,s,"",e.catboxUserHash||"",U,e.uploadTimeout);break}case"Litterbox":{g.debug("[BigFileUpload] Trying Litterbox"),b=await Mt(t,a,s,"",e.litterboxTime||"1h",U,e.uploadTimeout);break}case"temp.sh":{g.debug("[BigFileUpload] Trying temp.sh"),b=await zt(t,a,s,U,e.uploadTimeout);break}case"0x0.st":{g.debug("[BigFileUpload] Trying 0x0.st"),b=await Vt(t,a,s,e.zeroX0Expires,U,e.uploadTimeout);break}case"tmpfiles.org":{g.debug("[BigFileUpload] Trying tmpfiles.org"),b=await _t(t,a,s,U,e.uploadTimeout);break}case"filebin.net":{g.debug("[BigFileUpload] Trying filebin.net"),b=await Bt(t,a,s,U,e.uploadTimeout);break}case"buzzheavier.com":{g.debug("[BigFileUpload] Trying buzzheavier.com"),b=await Nt(t,a,s,U,e.uploadTimeout);break}case"Custom":{if(!e.customUploaderRequestURL||e.customUploaderRequestURL.trim()==="")throw new Error("Custom uploader not configured - skipping to next uploader");if(p!==w)throw new Error("Custom uploader only works as primary selection");let x=Ke(e.customUploaderArgs,{}),y=Ke(e.customUploaderHeaders,{}),E=(e.customUploaderURL||"").split(".").filter(h=>h);b=await Gt(t,e.customUploaderRequestURL,a,s,"",e.customUploaderFileFormName||"file",x,y,e.customUploaderResponseType||"Text",E,U,e.customUploaderRequestMethod,e.customUploaderBodyType,e.uploadTimeout);break}default:throw new Error(`Unknown uploader: ${p}`)}if(!jr(b))throw new Error(`Invalid URL received from ${p}: ${b.substring(0,100)}`);let F=b;return e.autoFormat==="Yes"&&(F=`[${s}](${b})`),g.info(`[BigFileUpload] \u2705 Upload successful with ${p}! File: ${s} (${(c/1024/1024).toFixed(2)}MB) \u2192 ${b}`),{success:!0,url:F,fileName:s,fileSize:c,uploadId:U,actualUploader:p,attemptedUploaders:[...C,p]}}catch(b){let F=b instanceof Error?b.message:String(b);if(F.toLowerCase().includes("upload cancelled by user"))return g.info("[BigFileUpload] Upload cancelled by user, aborting"),k&&k.uploadId===U&&(k=void 0,ne=0),{success:!1,error:"Upload cancelled by user",attemptedUploaders:C};g.error(`[BigFileUpload] Upload failed with ${p}:`,b),T=new Error(`[${p}] ${F}`),C.push(p);let x=F;F.length>100&&(x=F.substring(0,100)+"...");let y=C.length===R.length-1;if(t.sender&&!t.sender.isDestroyed())if(y)Xe(t,{type:"failure",message:`${p} failed: ${x}`});else{let P=R[C.length];Xe(t,{type:"failure",message:`${p} failed: ${x}. Trying ${P}...`})}if(p===R[R.length-1])break;let E=R[C.length];g.warn(`[BigFileUpload] ${p} failed. Will retry with ${E}`),console.warn(`[BigFileUpload] Upload failed with ${p}, retrying with ${E}...`),k&&k.uploadId===U&&(k={...k,loaded:0,percent:0,speed:0,eta:0},ne=Date.now())}}return g.error(`[BigFileUpload] All uploaders failed. Attempted: ${C.join(", ")}`),Me(),{success:!1,error:`All upload services failed. Last error: ${T?.message||"Connection issue"}. Tried: ${C.join(", ")}`}}var k=null,ne=0,uo=300*1e3,J=new Map,W=new Set,Oe=[],fo=50;function Xe(t,e){let r={...e,timestamp:Date.now()};Oe.push(r),Oe.length>fo&&Oe.shift(),g.debug("[BigFileUpload] Notification queued:",e)}function po(){let t=[...Oe];return Oe.length=0,t}function ho(){if(k&&k.uploadId&&W.has(k.uploadId))return k=null,ne=0,null;if(k&&ne>0){let t=Date.now()-ne;if(t>uo)return g.warn(`[BigFileUpload] Clearing stale progress data (${Math.round(t/1e3)}s old)`),k=null,ne=0,null}return k&&g.debug("[NATIVE] getLatestProgress returning:",k.percent+"%"),k}function Me(){k=null,ne=0}function go(t,e){g.info(`[BigFileUpload] Cancelling upload: ${e}`),W.add(e),setTimeout(()=>{W.delete(e),g.debug(`[BigFileUpload] Cleaned up cancelled upload ID: ${e}`)},3e4),k&&k.uploadId===e&&(k=null);let r=J.get(e);if(r)try{r.cleanup();try{r.req.socket&&r.req.socket.destroy(),r.req.destroy()}catch{}return J.delete(e),g.info(`[BigFileUpload] Upload ${e} cancelled successfully`),{success:!0}}catch(n){return g.error(`[BigFileUpload] Error cancelling upload ${e}:`,n),{success:!1,error:n instanceof Error?n.message:String(n)}}else return g.warn(`[BigFileUpload] No active upload found for ID: ${e}, but marked as cancelled`),{success:!0}}var Ht={};se(Ht,{getImageBuffer:()=>mo});f();async function mo(t,e){let n=await(await fetch(e)).arrayBuffer();return Buffer.from(n)}var Zt={};se(Zt,{getMemory:()=>vo});f();function vo(){let t=process.memoryUsage();return{heapUsed:t.heapUsed,heapTotal:t.heapTotal}}var Qr={AppleMusicRichPresence:Et,ConsoleShortcuts:Ut,FixSpotifyEmbeds:Ir,FixYoutubeEmbeds:$r,OpenInApp:St,Translate:Rt,VoiceMessages:Ct,XSOverlay:Ft,YoutubeAdblock:Vr,BigFileUpload:Wt,RandomGary:Ht,venfetch:Zt};var en={};for(let[t,e]of Object.entries(Qr)){let r=Object.entries(e);if(!r.length)continue;let n=en[t]={};for(let[o,i]of r){let a=`VencordPluginNative_${t}_${o}`;qt.ipcMain.handle(a,i),n[o]=a}}qt.ipcMain.on("VencordGetPluginIpcMethodMap",t=>{t.returnValue=en});f();Te();var B=require("electron");f();var tn="PCFkb2N0eXBlIGh0bWw+PGh0bWwgbGFuZz0iZW4iPjxoZWFkPjxtZXRhIGNoYXJzZXQ9InV0Zi04Ij48dGl0bGU+VmVuY29yZCBRdWlja0NTUyBFZGl0b3I8L3RpdGxlPjxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tb25hY28tZWRpdG9yQDAuNTAuMC9taW4vdnMvZWRpdG9yL2VkaXRvci5tYWluLmNzcyIgaW50ZWdyaXR5PSJzaGEyNTYtdGlKUFEyTzA0ei9wWi9Bd2R5SWdock9NemV3ZitQSXZFbDFZS2JRdnNaaz0iIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiIHJlZmVycmVycG9saWN5PSJuby1yZWZlcnJlciI+PHN0eWxlPiNjb250YWluZXIsYm9keSxodG1se3Bvc2l0aW9uOmFic29sdXRlO2xlZnQ6MDt0b3A6MDt3aWR0aDoxMDAlO2hlaWdodDoxMDAlO21hcmdpbjowO3BhZGRpbmc6MDtvdmVyZmxvdzpoaWRkZW59PC9zdHlsZT48L2hlYWQ+PGJvZHk+PGRpdiBpZD0iY29udGFpbmVyIj48L2Rpdj48c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS9tb25hY28tZWRpdG9yQDAuNTAuMC9taW4vdnMvbG9hZGVyLmpzIiBpbnRlZ3JpdHk9InNoYTI1Ni1LY1U0OFRHcjg0cjd1bkY3SjVJZ0JvOTVhZVZyRWJyR2UwNFM3VGNGVWpzPSIgY3Jvc3NvcmlnaW49ImFub255bW91cyIgcmVmZXJyZXJwb2xpY3k9Im5vLXJlZmVycmVyIj48L3NjcmlwdD48c2NyaXB0PnJlcXVpcmUuY29uZmlnKHtwYXRoczp7dnM6Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vbW9uYWNvLWVkaXRvckAwLjUwLjAvbWluL3ZzIn19KSxyZXF1aXJlKFsidnMvZWRpdG9yL2VkaXRvci5tYWluIl0sKCgpPT57Z2V0Q3VycmVudENzcygpLnRoZW4oKGU9Pnt2YXIgdD1tb25hY28uZWRpdG9yLmNyZWF0ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29udGFpbmVyIikse3ZhbHVlOmUsbGFuZ3VhZ2U6ImNzcyIsdGhlbWU6Z2V0VGhlbWUoKX0pO3Qub25EaWRDaGFuZ2VNb2RlbENvbnRlbnQoKCgpPT5zZXRDc3ModC5nZXRWYWx1ZSgpKSkpLHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJyZXNpemUiLCgoKT0+e3QubGF5b3V0KCl9KSl9KSl9KSk8L3NjcmlwdD48L2JvZHk+PC9odG1sPg==";var _e=require("fs"),Re=require("fs/promises"),Se=require("path");f();Te();var Ue=require("electron");function rn(){Ue.ipcMain.handle("VencordCspRemoveOverride",xo),Ue.ipcMain.handle("VencordCspRequestAddOverride",To),Ue.ipcMain.handle("VencordCspIsDomainAllowed",bo)}function yo(t,e){try{let{host:r}=new URL(t);if(/[;'"\\]/.test(r))return!1}catch{return!1}return!(e.length===0||e.some(r=>!G.includes(r)))}function wo(t,e,r){let n=new URL(t).host,o=`${r} wants to allow connections to ${n}`,i=`Unless you recognise and fully trust ${n}, you should cancel this request!

You will have to fully close and restart Vesktop for the changes to take effect.`;if(e.length===1&&e[0]==="connect-src")return{message:o,detail:i};let a=e.filter(s=>s!=="connect-src").map(s=>{switch(s){case"img-src":return"Images";case"style-src":return"CSS & Themes";case"font-src":return"Fonts";default:throw new Error(`Illegal CSP directive: ${s}`)}}).sort().join(", ");return i=`The following types of content will be allowed to load from ${n}:
${a}

${i}`,{message:o,detail:i}}async function To(t,e,r,n){if(!yo(e,r))return"invalid";let o=new URL(e).host;if(o in re.store.customCspRules)return"conflict";let{checkboxChecked:i,response:a}=await Ue.dialog.showMessageBox({...wo(e,r,n),type:n?"info":"warning",title:"Vencord Host Permissions",buttons:["Cancel","Allow"],defaultId:0,cancelId:0,checkboxLabel:`I fully trust ${o} and understand the risks of allowing connections to it.`,checkboxChecked:!1});return a!==1?"cancelled":i?(re.store.customCspRules[o]=r,"ok"):"unchecked"}function xo(t,e){return e in re.store.customCspRules?(delete re.store.customCspRules[e],!0):!1}function bo(t,e,r){try{let n=new URL(e).host,o=mt[n]??re.store.customCspRules[n];return o?r.every(i=>o.includes(i)):!1}catch{return!1}}f();var Eo=/[^\S\r\n]*?\r?(?:\r\n|\n)[^\S\r\n]*?\*[^\S\r\n]?/,Uo=/^\\@/;function Jt(t,e={}){return{fileName:t,name:e.name??t.replace(/\.css$/i,""),author:e.author??"Unknown Author",description:e.description??"A Discord Theme.",version:e.version,license:e.license,source:e.source,website:e.website,invite:e.invite}}function nn(t){return t.charCodeAt(0)===65279&&(t=t.slice(1)),t}function on(t,e){if(!t)return Jt(e);let r=t.split("/**",2)?.[1]?.split("*/",1)?.[0];if(!r)return Jt(e);let n={},o="",i="";for(let a of r.split(Eo))if(a.length!==0)if(a.charAt(0)==="@"&&a.charAt(1)!==" "){n[o]=i.trim();let s=a.indexOf(" ");o=a.substring(1,s),i=a.substring(s+1)}else i+=" "+a.replace("\\n",`
`).replace(Uo,"@");return n[o]=i.trim(),delete n[""],Jt(e,n)}f();var sn=require("electron");function an(t){t.webContents.setWindowOpenHandler(({url:e})=>{switch(e){case"about:blank":case"https://discord.com/popout":case"https://ptb.discord.com/popout":case"https://canary.discord.com/popout":return{action:"allow"}}try{var{protocol:r}=new URL(e)}catch{return{action:"deny"}}switch(r){case"http:":case"https:":case"mailto:":case"steam:":case"spotify:":sn.shell.openExternal(e)}return{action:"deny"}})}(0,_e.mkdirSync)(de,{recursive:!0});rn();function Yt(t,e){let r=(0,Se.normalize)(t+"/"),n=(0,Se.join)(t,e),o=(0,Se.normalize)(n);return o.startsWith(r)?o:null}function So(){return(0,Re.readFile)(Ge,"utf-8").catch(()=>"")}async function Ro(){let t=await(0,Re.readdir)(de).catch(()=>[]),e=[];for(let r of t){if(!r.endsWith(".css"))continue;let n=await ln(r).then(nn).catch(()=>null);n!=null&&e.push(on(n,r))}return e}function ln(t){t=t.replace(/\?v=\d+$/,"");let e=Yt(de,t);return e?(0,Re.readFile)(e,"utf-8"):Promise.reject(`Unsafe path ${t}`)}B.ipcMain.handle("VencordOpenQuickCss",()=>B.shell.openPath(Ge));B.ipcMain.handle("VencordOpenExternal",(t,e)=>{try{var{protocol:r}=new URL(e)}catch{throw"Malformed URL"}if(!dr.includes(r))throw"Disallowed protocol.";B.shell.openExternal(e)});B.ipcMain.handle("VencordGetQuickCss",()=>So());B.ipcMain.handle("VencordSetQuickCss",(t,e)=>(0,_e.writeFileSync)(Ge,e));B.ipcMain.handle("VencordGetThemesList",()=>Ro());B.ipcMain.handle("VencordGetThemeData",(t,e)=>ln(e));B.ipcMain.handle("VencordGetThemeSystemValues",()=>({"os-accent-color":`#${B.systemPreferences.getAccentColor?.()||""}`}));B.ipcMain.handle("VencordOpenThemesFolder",()=>B.shell.openPath(de));B.ipcMain.handle("VencordOpenSettingsFolder",()=>B.shell.openPath(pe));B.ipcMain.handle("VencordOpenMonacoEditor",async()=>{let t="Vencord QuickCSS Editor",e=B.BrowserWindow.getAllWindows().find(n=>n.title===t);if(e&&!e.isDestroyed()){e.focus();return}let r=new B.BrowserWindow({title:t,autoHideMenuBar:!0,darkTheme:!0,webPreferences:{preload:(0,Se.join)(__dirname,"vencordDesktopPreload.js"),contextIsolation:!0,nodeIntegration:!1,sandbox:!1}});an(r),await r.loadURL(`data:text/html;base64,${tn}`)});f();var Fn=require("electron");f();var fn=require("module"),Co=(0,fn.createRequire)("/"),tt,Fo=";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global";try{tt=Co("worker_threads").Worker}catch{}var Lo=tt?function(t,e,r,n,o){var i=!1,a=new tt(t+Fo,{eval:!0}).on("error",function(s){return o(s,null)}).on("message",function(s){return o(null,s)}).on("exit",function(s){s&&!i&&o(new Error("exited with code "+s),null)});return a.postMessage(r,n),a.terminate=function(){return i=!0,tt.prototype.terminate.call(a)},a}:function(t,e,r,n,o){setImmediate(function(){return o(new Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var i=function(){};return{terminate:i,postMessage:i}},q=Uint8Array,me=Uint16Array,pn=Int32Array,Xt=new q([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Qt=new q([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),dn=new q([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hn=function(t,e){for(var r=new me(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var o=new pn(r[30]),n=1;n<30;++n)for(var i=r[n];i<r[n+1];++i)o[i]=i-r[n]<<5|n;return{b:r,r:o}},gn=hn(Xt,2),er=gn.b,Do=gn.r;er[28]=258,Do[258]=28;var mn=hn(Qt,0),vn=mn.b,As=mn.r,ot=new me(32768);for($=0;$<32768;++$)ce=($&43690)>>1|($&21845)<<1,ce=(ce&52428)>>2|(ce&13107)<<2,ce=(ce&61680)>>4|(ce&3855)<<4,ot[$]=((ce&65280)>>8|(ce&255)<<8)>>1;var ce,$,Ce=(function(t,e,r){for(var n=t.length,o=0,i=new me(e);o<n;++o)t[o]&&++i[t[o]-1];var a=new me(e);for(o=1;o<e;++o)a[o]=a[o-1]+i[o-1]<<1;var s;if(r){s=new me(1<<e);var l=15-e;for(o=0;o<n;++o)if(t[o])for(var c=o<<4|t[o],d=e-t[o],u=a[t[o]-1]++<<d,w=u|(1<<d)-1;u<=w;++u)s[ot[u]>>l]=c}else for(s=new me(n),o=0;o<n;++o)t[o]&&(s[o]=ot[a[t[o]-1]++]>>15-t[o]);return s}),Be=new q(288);for($=0;$<144;++$)Be[$]=8;var $;for($=144;$<256;++$)Be[$]=9;var $;for($=256;$<280;++$)Be[$]=7;var $;for($=280;$<288;++$)Be[$]=8;var $,yn=new q(32);for($=0;$<32;++$)yn[$]=5;var $;var wn=Ce(Be,9,1);var Tn=Ce(yn,5,1),rt=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},K=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},nt=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},xn=function(t){return(t+7)/8|0},it=function(t,e,r){return(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length),new q(t.subarray(e,r))};var bn=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Z=function(t,e,r){var n=new Error(e||bn[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,Z),!r)throw n;return n},En=function(t,e,r,n){var o=t.length,i=n?n.length:0;if(!o||e.f&&!e.l)return r||new q(0);var a=!r,s=a||e.i!=2,l=e.i;a&&(r=new q(o*3));var c=function(ar){var lr=r.length;if(ar>lr){var cr=new q(Math.max(lr*2,ar));cr.set(r),r=cr}},d=e.f||0,u=e.p||0,w=e.b||0,A=e.l,R=e.d,U=e.m,T=e.n,C=o*8;do{if(!A){d=K(t,u,1);var p=K(t,u+1,3);if(u+=3,p)if(p==1)A=wn,R=Tn,U=9,T=5;else if(p==2){var F=K(t,u,31)+257,x=K(t,u+10,15)+4,y=F+K(t,u+5,31)+1;u+=14;for(var E=new q(y),P=new q(19),h=0;h<x;++h)P[dn[h]]=K(t,u+h*3,7);u+=x*3;for(var I=rt(P),H=(1<<I)-1,_=Ce(P,I,1),h=0;h<y;){var Le=_[K(t,u,H)];u+=Le&15;var v=Le>>4;if(v<16)E[h++]=v;else{var X=0,S=0;for(v==16?(S=3+K(t,u,3),u+=2,X=E[h-1]):v==17?(S=3+K(t,u,7),u+=3):v==18&&(S=11+K(t,u,127),u+=7);S--;)E[h++]=X}}var O=E.subarray(0,F),M=E.subarray(F);U=rt(O),T=rt(M),A=Ce(O,U,1),R=Ce(M,T,1)}else Z(1);else{var v=xn(u)+4,m=t[v-4]|t[v-3]<<8,b=v+m;if(b>o){l&&Z(0);break}s&&c(w+m),r.set(t.subarray(v,b),w),e.b=w+=m,e.p=u=b*8,e.f=d;continue}if(u>C){l&&Z(0);break}}s&&c(w+131072);for(var V=(1<<U)-1,nr=(1<<T)-1,st=u;;st=u){var X=A[nt(t,u)&V],ye=X>>4;if(u+=X&15,u>C){l&&Z(0);break}if(X||Z(2),ye<256)r[w++]=ye;else if(ye==256){st=u,A=null;break}else{var or=ye-254;if(ye>264){var h=ye-257,De=Xt[h];or=K(t,u,(1<<De)-1)+er[h],u+=De}var at=R[nt(t,u)&nr],lt=at>>4;at||Z(3),u+=at&15;var M=vn[lt];if(lt>3){var De=Qt[lt];M+=nt(t,u)&(1<<De)-1,u+=De}if(u>C){l&&Z(0);break}s&&c(w+131072);var ir=w+or;if(w<M){var sr=i-M,In=Math.min(M,ir);for(sr+w<0&&Z(3);w<In;++w)r[w]=n[sr+w]}for(;w<ir;++w)r[w]=r[w-M]}}e.l=A,e.p=st,e.b=w,e.f=d,A&&(d=1,e.m=U,e.d=R,e.n=T)}while(!d);return w!=r.length&&a?it(r,0,w):r.subarray(0,w)};var Po=new q(0);var Io=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},cn=function(t,e,r){for(var n=t(),o=t.toString(),i=o.slice(o.indexOf("[")+1,o.lastIndexOf("]")).replace(/\s+/g,"").split(","),a=0;a<n.length;++a){var s=n[a],l=i[a];if(typeof s=="function"){e+=";"+l+"=";var c=s.toString();if(s.prototype)if(c.indexOf("[native code]")!=-1){var d=c.indexOf(" ",8)+1;e+=c.slice(d,c.indexOf("(",d))}else{e+=c;for(var u in s.prototype)e+=";"+l+".prototype."+u+"="+s.prototype[u].toString()}else e+=c}else r[l]=s}return e},et=[],Ao=function(t){var e=[];for(var r in t)t[r].buffer&&e.push((t[r]=new t[r].constructor(t[r])).buffer);return e},$o=function(t,e,r,n){if(!et[r]){for(var o="",i={},a=t.length-1,s=0;s<a;++s)o=cn(t[s],o,i);et[r]={c:cn(t[a],o,i),e:i}}var l=Io({},et[r].e);return Lo(et[r].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",r,l,Ao(l),n)},ko=function(){return[q,me,pn,Xt,Qt,dn,er,vn,wn,Tn,ot,bn,Ce,rt,K,nt,xn,it,Z,En,tr,Un,Sn]};var Un=function(t){return postMessage(t,[t.buffer])},Sn=function(t){return t&&{out:t.size&&new q(t.size),dictionary:t.dictionary}},Oo=function(t,e,r,n,o,i){var a=$o(r,n,o,function(s,l){a.terminate(),i(s,l)});return a.postMessage([t,e],e.consume?[t.buffer]:[]),function(){a.terminate()}};var oe=function(t,e){return t[e]|t[e+1]<<8},te=function(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0},jt=function(t,e){return te(t,e)+te(t,e+4)*4294967296};function Mo(t,e,r){return r||(r=e,e={}),typeof r!="function"&&Z(7),Oo(t,e,[ko],function(n){return Un(tr(n.data[0],Sn(n.data[1])))},1,r)}function tr(t,e){return En(t,{i:2},e&&e.out,e&&e.dictionary)}var Kt=typeof TextDecoder<"u"&&new TextDecoder,zo=0;try{Kt.decode(Po,{stream:!0}),zo=1}catch{}var _o=function(t){for(var e="",r=0;;){var n=t[r++],o=(n>127)+(n>223)+(n>239);if(r+o>t.length)return{s:e,r:it(t,r-1)};o?o==3?(n=((n&15)<<18|(t[r++]&63)<<12|(t[r++]&63)<<6|t[r++]&63)-65536,e+=String.fromCharCode(55296|n>>10,56320|n&1023)):o&1?e+=String.fromCharCode((n&31)<<6|t[r++]&63):e+=String.fromCharCode((n&15)<<12|(t[r++]&63)<<6|t[r++]&63):e+=String.fromCharCode(n)}};function Bo(t,e){if(e){for(var r="",n=0;n<t.length;n+=16384)r+=String.fromCharCode.apply(null,t.subarray(n,n+16384));return r}else{if(Kt)return Kt.decode(t);var o=_o(t),i=o.s,r=o.r;return r.length&&Z(8),i}}var No=function(t,e){return e+30+oe(t,e+26)+oe(t,e+28)},Vo=function(t,e,r){var n=oe(t,e+28),o=Bo(t.subarray(e+46,e+46+n),!(oe(t,e+8)&2048)),i=e+46+n,a=te(t,e+20),s=r&&a==4294967295?Go(t,i):[a,te(t,e+24),te(t,e+42)],l=s[0],c=s[1],d=s[2];return[oe(t,e+10),l,c,o,i+oe(t,e+30)+oe(t,e+32),d]},Go=function(t,e){for(;oe(t,e)!=1;e+=4+oe(t,e+2));return[jt(t,e+12),jt(t,e+4),jt(t,e+20)]};var un=typeof queueMicrotask=="function"?queueMicrotask:typeof setTimeout=="function"?setTimeout:function(t){t()};function Rn(t,e,r){r||(r=e,e={}),typeof r!="function"&&Z(7);var n=[],o=function(){for(var T=0;T<n.length;++T)n[T]()},i={},a=function(T,C){un(function(){r(T,C)})};un(function(){a=r});for(var s=t.length-22;te(t,s)!=101010256;--s)if(!s||t.length-s>65558)return a(Z(13,0,1),null),o;var l=oe(t,s+8);if(l){var c=l,d=te(t,s+16),u=d==4294967295||c==65535;if(u){var w=te(t,s-12);u=te(t,w)==101075792,u&&(c=l=te(t,w+32),d=te(t,w+48))}for(var A=e&&e.filter,R=function(T){var C=Vo(t,d,u),p=C[0],v=C[1],m=C[2],b=C[3],F=C[4],x=C[5],y=No(t,x);d=F;var E=function(h,I){h?(o(),a(h,null)):(I&&(i[b]=I),--l||a(null,i))};if(!A||A({name:b,size:v,originalSize:m,compression:p}))if(!p)E(null,it(t,y,y+v));else if(p==8){var P=t.subarray(y,y+v);if(m<524288||v>.8*m)try{E(null,tr(P,{out:new q(m)}))}catch(h){E(h,null)}else n.push(Mo(P,{size:m},E))}else E(Z(14,"unknown compression type "+p,1),null);else E(null,null)},U=0;U<c;++U)R(U)}else a(null,{});return o}var Ln=require("fs"),ie=require("fs/promises"),Fe=require("path");f();function Cn(t){function e(a,s,l,c){let d=0;return d+=a<<0,d+=s<<8,d+=l<<16,d+=c<<24>>>0,d}if(t[0]===80&&t[1]===75&&t[2]===3&&t[3]===4)return t;if(t[0]!==67||t[1]!==114||t[2]!==50||t[3]!==52)throw new Error("Invalid header: Does not start with Cr24");let r=t[4]===3,n=t[4]===2;if(!n&&!r||t[5]||t[6]||t[7])throw new Error("Unexpected crx format version number.");if(n){let a=e(t[8],t[9],t[10],t[11]),s=e(t[12],t[13],t[14],t[15]),l=16+a+s;return t.subarray(l,t.length)}let i=12+e(t[8],t[9],t[10],t[11]);return t.subarray(i,t.length)}vt();var Wo=(0,Fe.join)(Ve,"ExtensionCache");async function Ho(t,e){return await(0,ie.mkdir)(e,{recursive:!0}),new Promise((r,n)=>{Rn(t,(o,i)=>{if(o)return void n(o);Promise.all(Object.keys(i).map(async a=>{if(a.startsWith("_metadata/"))return;if(a.endsWith("/"))return void(0,ie.mkdir)((0,Fe.join)(e,a),{recursive:!0});let s=a.split("/"),l=s.pop(),c=s.join("/"),d=(0,Fe.join)(e,c);c&&await(0,ie.mkdir)(d,{recursive:!0}),await(0,ie.writeFile)((0,Fe.join)(d,l),i[a])})).then(()=>r()).catch(a=>{(0,ie.rm)(e,{recursive:!0,force:!0}),n(a)})})})}async function Dn(t){let e=(0,Fe.join)(Wo,`${t}`);try{await(0,ie.access)(e,Ln.constants.F_OK)}catch{let n=`https://clients2.google.com/service/update2/crx?response=redirect&acceptformat=crx2,crx3&x=id%3D${t}%26uc&prodversion=${process.versions.chrome}`,o=await He(n,{headers:{"User-Agent":`Electron ${process.versions.electron} ~ Vencord (https://github.com/Vendicated/Vencord)`}});await Ho(Cn(o),e).catch(i=>console.error(`Failed to extract extension ${t}`,i))}Fn.session.defaultSession.loadExtension(e)}ve.app.whenReady().then(()=>{ve.protocol.handle("vencord",({url:t})=>{let e=decodeURI(t).slice(10).replace(/\?v=\d+$/,"");if(e.endsWith("/")&&(e=e.slice(0,-1)),e.startsWith("/themes/")){let r=e.slice(8),n=Yt(de,r);return n?ve.net.fetch((0,rr.pathToFileURL)(n).toString()):new Response(null,{status:404})}switch(e){case"renderer.js.map":case"vencordDesktopRenderer.js.map":case"preload.js.map":case"vencordDesktopPreload.js.map":case"patcher.js.map":case"vencordDesktopMain.js.map":return ve.net.fetch((0,rr.pathToFileURL)((0,Pn.join)(__dirname,e)).toString());default:return new Response(null,{status:404})}});try{Y.store.enableReactDevtools&&Dn("fmkadmapgofadopljbjfkapdkoienihi").then(()=>console.info("[Vencord] Installed React Developer Tools")).catch(t=>console.error("[Vencord] Failed to install React Developer Tools",t))}catch{}yr()});
//# sourceURL=file:///VencordDesktopMain
//# sourceMappingURL=vencord://vencordDesktopMain.js.map
/*! For license information please see vencordDesktopMain.js.LEGAL.txt */
